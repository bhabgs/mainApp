!function(v){"use strict";var a=v.ht,P=a.Default,D=P.getInternal(),f=D.ui(),T=null,J="__segmentLengths",j="__lineTotalLength",w="__linePoints",s="__distance0",E="flow.count",Q="flow.step",c="flow.element.max",p="flow.element.count",L="flow.element.min",K="flow.element.space",m="flow.element.autorotate",k="flow.element.background",X="flow.element.shadow.max",n="flow.element.shadow.min",O="flow.element.shadow.begincolor",$="flow.element.shadow.endcolor",F="flow.element.shadow.visible",I="flow.element.image",o="flow",M=a.Math.Vector2,d=new M;new M,new M,a.List;var u=a.Default._edgeProtectMethod,y=u.getStraightLinePoints,H=function(U,t){for(var z=[],Z=U.length,N=0;Z>N;N++){var F=U[N];F._as&&(F=F._as);for(var o=F[0],S=1;S<F.length;S++)z.push([o,F[S]]),o=F[S]}for(var D=[],N=0;N<z.length;N++){var A=i(z[N][0],z[N][1],t);D.push(A)}return{distance:D,segments:z}},z=function(B,N,m){if(B){for(var u,S=H(B,N),o=S.distance,s=S.segments,$=1/0,V=null,U=0,Z=o.length;Z>U;U++){var q=o[U];q.z<$&&(u=U,$=q.z,V=q)}if(null==m&&(m=.1),V.z<m){for(var x=0,b=0;u>=b;b++)x+=P.getDistance(s[b][0],u>b?s[b][1]:V);return x}}},i=function(I,V,W){var l=I.x,Z=I.y,i=V.x,j=V.y,K=W.x,Q=W.y,L=i-l,D=j-Z,d=Math.sqrt(L*L+D*D),y=L/d,n=D/d,h=(-l+K)*y+(-Z+Q)*n,U={x:l+h*y,y:Z+h*n};return U.x>=Math.min(I.x,V.x)&&U.x<=Math.max(I.x,V.x)&&U.y>=Math.min(I.y,V.y)&&U.y<=Math.max(I.y,V.y)||(U.x=Math.abs(U.x-I.x)<Math.abs(U.x-V.x)?I.x:V.x,U.y=Math.abs(U.y-I.y)<Math.abs(U.y-V.y)?I.y:V.y),L=K-U.x,D=Q-U.y,U.z=Math.sqrt(L*L+D*D),U},t=function(I,J){if(I){var g=H(I,J).distance,e=1/0,z=null;return g.forEach(function(s){s.z<e&&(e=s.z,z=s)}),z}},r=u.calculateLineLength,V=u.calcSegmentIndexByDistance,U=u.calculatePointAlongLine,W=function(G,m,h){if(!G)return h;if(0===m){var z=G[0][0],R=G[0][1];return h+Math.atan2(R.y-z.y,R.x-z.x)}if(100===m){G=G[G.length-1];var z=G[G.length-2],R=G[G.length-1];return h+Math.atan2(R.y-z.y,R.x-z.x)}for(var J=0,v=[],S=G.length,T=0;S>T;T++){var n=G[T],c=r(n);J+=c,v.push(c)}for(var p=J*m/100,t=V(p,v),W=0,u=0;t>u;u++)W+=v[u];p-=W;for(var K=U(G[t],p),C=G[t],H=0,E=0,D=0;D<C.length-1;D++){var L=C[D],s=C[D+1],P=s.x-L.x,f=s.y-L.y,x=Math.sqrt(P*P+f*f);if(H+=x,H>p){E=D;break}}var X=C[E];return h+Math.atan2(K.y-X.y,K.x-X.x)},S=function(h){var U=0;if(h)if(Array.isArray(h[0]))for(var J=h.length,e=0;J>e;e++){var A=h[e],S=r(A);U+=S}else U=r(h);return U},x=function(n,X,l,N){return d.set(X,l).rotateAround(null,N),n?{x:n.x+d.x,y:n.y+d.y}:{x:d.x,y:d.y}},g=function(s){var A=s._data,c=y(s);if(c){A.s("flow.reverse")&&(c.reverse(),c.forEach(function(r){r.reverse()}));for(var F=0,Y=[],S=c.length,N=0;S>N;N++){var b=c[N],_=r(b);F+=_,Y.push(_)}if(A[J]=Y,A[j]=F,A[w]=c,A instanceof a.Edge){var R=P.unionPoint(c),D=R.x+R.width/2,z=R.y+R.height/2;A.$10e={x:D,y:z}}Z(s,!0)}},A=u.getPercentPosition,Z=function(R,f){var H=R._data,C=H[j],$=H.s(E),M=H.s(Q),A=0,V=H[J],u=H.s(c),o=H.s(L),d=H.s(p),n=(u-o)/(d-1),r=[];if(V){if(1===d)r.push(u);else if(2===d)r.push(u),r.push(o);else{if(!(d>2))return;r.push(u);for(var y=d-2;y>0;y--)r.push(o+n*y);r.push(o)}var i=0,O=0;r.forEach(function(W){d-1>i&&(O+=H.getFlowElementSpace(W)),i++}),O+=(u+o)/2,A=(C-$*O+O)/$;var I=R[s];for(null==I&&(I=0),f||(I+=M);I>C+O;){var q=R._overCount;q?q++:q=1,q>=$&&(q=null),R._overCount=q,H.s("flow.autoreverse")?q?I-=A+O:(I=0,H.s("flow.reverse",!H.s("flow.reverse"))):I-=A+O}R[s]=I}},Y="prototype",C=a.graph.GraphView[Y],N=a.Data[Y],b=f.DataUI[Y],l=f.ShapeUI[Y],G=f.EdgeUI[Y],B=a.DataModel[Y],q=a.Style;q[c]==T&&(q[c]=7),q[L]==T&&(q[L]=0),q[E]==T&&(q[E]=1),q[Q]==T&&(q[Q]=3),q[p]==T&&(q[p]=10),q[K]==T&&(q[K]=3.5),q[m]==T&&(q[m]=!1),q[k]==T&&(q[k]="rgba(255, 255, 114, 0.4)"),q[O]==T&&(q[O]="rgba(255, 255, 0, 0.3)"),q[$]==T&&(q[$]="rgba(255, 255, 0, 0)"),q[F]==T&&(q[F]=1),q[X]==T&&(q[X]=22),q[n]==T&&(q[n]=4),C.calculatePointLength=function(U,J,l){var B=this.getDataUI(U),w=y(B);return z(w,J,l)},P.calculatePointLength=function(L,S,v,V){var t=y(T,L,S);return z(t,v,V)},P.calculateClosestPointOnLine=i,C.calculateClosestPoint=function(S,r){var v=this.getDataUI(S),z=y(v);return t(z,r)},P.calculateClosestPoint=function(p,e,S){var L=y(T,p,e);return t(L,S)},C.getPercentAngle=function(T,r){var J=this.getDataUI(T),x=y(J);return T.getRotation?T.getRotation():0,W(x,r,T.getRotation?T.getRotation():0)},P.getPercentAngle=function(x,n,$){var l=y(T,x,n);return W(l,$,0)},C.calculateLength=function(z){var U=this.getDataUI(z),W=y(U);return S(W)},P.calculateLength=function(R,c){var q=y(T,R,c);return S(q)},C.getPercentPosition=function(i,g){var Q=this.getDataUI(i),r=y(Q);return A(r,g)},P.getPercentPositionOnPoints=function(I,S,m){var t=y(T,I,S);return A(t,m)};var R=function(V){var A=V.data,w=this.dm();if(A&&"add"===V.kind){var u=w.$3e;u&&A.s(o)&&u.indexOf(A)<0&&u.push(A)}"clear"===V.kind&&(w.$3e=[])},_=function(H){var R=H.property,k=H.data,f=H.newValue,F=this.dm().$3e;if(F&&"s:flow"===R)if(f)F.indexOf(k)<0&&F.push(k);else for(var j=F.length,e=0;j>e;e++)if(F[e]===k){F.splice(e,1);break}},h=C.setDataModel;C.setDataModel=function(M){var S=this,Z=S._dataModel;if(Z!==M){Z&&(Z.umm(R,S),Z.umd(_,S),Z.$3e=[]),M.mm(R,S),M.md(_,S);var W=M.$3e=[];M.each(function(x){x.s(o)&&W.indexOf(x)<0&&W.push(x)}),h.call(S,M)}},N.getFlowElementSpace=function(){return this.s(K)};var e=function(r){var W=this,Z=W._data,O=Z[j],H=Z[J],z=Z[w],P=Z.s(E),o=0,C=W[s],A=Z.s(c),B=Z.s(L),F=Z.s(p),d=Z.s(n),K=Z.s(X),a=Z.s(m),M=(K-d)/(F-1),k=(A-B)/(F-1),S=Z.getRotation?Z.getRotation():0,R=Z.getPosition?Z.p():Z.$10e,i=[],f=[];if(C!=T){if(1===F)i.push(A);else if(2===F)i.push(A),i.push(B);else{if(!(F>2))return;i.push(A);for(var h=F-2;h>0;h--)i.push(B+k*h);i.push(B)}if(1===F)f.push(K);else if(2===F)f.push(K),f.push(d);else{if(!(F>2))return;f.push(K);for(var h=F-2;h>0;h--)f.push(d+M*h);f.push(d)}var G=0,u=0;i.forEach(function(p){F-1>G&&(u+=Z.getFlowElementSpace(p)),G++}),u+=(A+B)/2,o=(O-P*u+u)/P,r.save();for(var h=0;P>h;h++){var _=C,Q=0,$=W._overCount,D=0;Z.s("flow.autoreverse")&&$&&$>P-(h+1)||(_-=h*(o+u),G=0,i.forEach(function(h){var v=_-Q;if(v>=0&&O>v){var s=!0,F=V(v,H);D=0;for(var t=0;F>t;t++)D+=H[t];if(v-=D,s){var I=U(z[F],v),k=S;if(a){for(var d=z[F],N=0,K=0,o=0;o<d.length-1;o++){var l=d[o],J=d[o+1],u=J.x-l.x,c=J.y-l.y,j=Math.sqrt(u*u+c*c);if(N+=j,N>v){K=o;break}}var q=d[K];k+=Math.atan2(I.y-q.y,I.x-q.x)}S&&(I=x(R,I.x-R.x,I.y-R.y,S)),W.$5e(r,I,h,f[G],k)}}Q+=Z.getFlowElementSpace(i[G]),G++}))}r.restore()}},Db=G._80o;G._80o=function(C){Db.call(this,C);var V=this,R=V._data,K=V.gv;R.s(o)&&K.$7e!=T&&e.call(V,C)};var rl=l._80o;l._80o=function(H){rl.call(this,H);var q=this,v=q._data,J=q.gv;v.s(o)&&J.$7e!=T&&e.call(q,H)};var ch=G._79o,qg=l._79o,Yb=function(){var E=this,m=E._data,I=m.s(c),_=!1,R=T;if(E._6I||(_=!0),R=m instanceof a.Edge?ch.call(E):qg.call(E),m.s(o)&&_){var h=m.s(X),O=m.s(F);O&&h>I&&(I=h),I>0&&P.grow(R,Math.ceil(I/2)),g(E)}return!m.s(o)&&_&&(m[J]=m[j]=m[w]=E[s]=T),R};l._79o=Yb,G._79o=Yb,b.$5e=function(g,Q,b,h,J){var f=this,c=f._data,l=f.gv,o=c.s(k),x=c.s(O),Z=c.s($),s=c.s(F),y=l.$8e,M=c.s(I);if(y==T&&(y=l.$8e={}),g.beginPath(),M!=T){var B=P.getImage(M),u=b/2;g.translate(Q.x,Q.y),g.rotate(J),g.translate(-Q.x,-Q.y),P.drawImage(g,B,Q.x-u,Q.y-u,b,b,c),g.translate(Q.x,Q.y),g.rotate(-J),g.translate(-Q.x,-Q.y)}else if(l.__flowBatch){var m=l.__flowBatchGroup;m||(m=l.__flowBatchGroup={});var w=[Q.x,Q.y,b/2];m[o]?m[o].push(w):m[o]=[w]}else g.fillStyle=o,g.arc(Q.x,Q.y,b/2,0,2*Math.PI,!0),g.fill();if(s){var n=22,H=n+"_"+x+"_"+Z,v=y[H];if(v==T){var L=document.createElement("canvas");D.setCanvas(L,n,n);var K=L.getContext("2d"),W=n/2,e=W,r=W;D.translateAndScale(K,0,0,1),K.beginPath();var E=K.createRadialGradient(e,r,0,e,e,W);E.addColorStop(0,x),E.addColorStop(1,Z),K.fillStyle=E,K.arc(e,r,W,0,2*Math.PI,!0),K.fill(),v=y[H]=L}var u=h/2;P.drawImage(g,v,Q.x-u,Q.y-u,h,h,c)}},C.$9e=function(){var g=this,s=g.dm().$3e;g._24I,s.forEach(function(A){g._24I[A._id]=A}),g.iv()};var Jd=B.prepareRemove;B.prepareRemove=function(h){Jd.call(this,h);var A=h._dataModel,B=A.$3e;if(B)for(var P=B.length,G=0;P>G;G++)if(B[G]===h){B.splice(G,1);break}},C.setFlowInterval=function(I){var O=this,G=O.$11e;O.$11e=I,O.fp("flowInterval",G,I),O.$7e!=T&&(clearInterval(O.$7e),delete O.$7e,O.enableFlow(I))},C.getFlowInterval=function(){return this.$11e},C.enableFlow=function(H){var s=this,y=s.dm(),F=y.$3e;s.$7e==T&&(F.forEach(function(w){var K=s.getDataUI(w);g(K)}),s.$7e=setInterval(function(){y.$3e.forEach(function(A){Z(s.getDataUI(A))}),s.$9e()},H||s.$11e||50))},C.disableFlow=function(){var F=this;clearInterval(F.$7e),delete F.$7e;var h=F.dm().$3e;h&&F.$9e()};var Al=function(){this.__flowBatchGroup={}},jn=function(k){var I=this.__flowBatchGroup;if(I){k.save();for(var L in I){k.fillStyle=L,k.beginPath();var l=I[L];l.forEach(function(D){k.moveTo(D[0],D[1]),k.arc(D[0],D[1],D[2],0,2*Math.PI,!0)}),k.fill()}k.restore()}};C.setFlowBatch=function(B){var _=this;!!_.__flowBatch!=!!B&&(_.__flowBatch=B,B?(_.addBottomPainter(Al),_.addTopPainter(jn)):(_.removeBottomPainter(Al),_.removeTopPainter(jn)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);