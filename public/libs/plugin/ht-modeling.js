!function(D,L,Z){"use strict";function Y(y,e){this.position=y,this.$22n=e}var N="ht",c=D[N],f=null,T=Math,R=T.PI,u=T.cos,o=T.sin,X=T.abs,K=T.max,S=T.sqrt,F=1e-5,C=c.Default,k=C.def,e=C.startAnim,d=C.createMatrix,W=C.transformVec,z=C.getInternal(),E=z.addMethod,j=z.superCall,B=z.toPointsArray,G=z.createNormals,V=z.toFloatArray,v=z.glMV,p=(z.glPop,c.graph3d.Graph3dView,c.Math),b=p.Vector3,M=p.Matrix4,q=p.Euler,r=(p.Quaternion,z.batchShape),l=z.createNodeMatrix,n=z.getFaceInfo,U=z.transformAppend,t=z.drawFaceInfo,i=z.createAnim,w=z.cube(),A=w.is,Q=w.vs,h=w.uv,a=z.ui(),$=c.Node,I=c.Shape,O="h",H="v",s="front",y="back",_="left",J="right",x="top",g="bottom",m="dw.expanded",P=".expanded",kq="dw.angle",Xj=".angle",Xe=function(n,$,b){k(N+"."+n,$,b)},Oe=function(L,f,n){n?L.push(f.x,f.y):L.push(f.x,f.y,f.z)},Lh=function(){var k=new c.Math.Vector3,y=new c.Math.Vector3,L=new c.Math.Vector3;return function(A,Q,g,t,S){if(k.copy(Q.$24n),y.copy(g.$24n),L.copy(t.$24n),!(L.equals(k)||y.equals(k)||y.equals(L))){if(!Q.$22n||!g.$22n||!t.$22n){var e=y.sub(k).cross(L.sub(k)).normalize().multiplyScalar(1).toArray();Q.$22n||(Q.$22n=new hn(e)),g.$22n||(g.$22n=new hn(e)),t.$22n||(t.$22n=new hn(e))}A.push(new Ck([Q,g,t],S))}}}(),$q=function(S,a,U,T){var y,t,I,l,B=0,z=[];if(T)for(y=T.length;y>B;B+=3)t=T[B],I=T[B+1],l=T[B+2],Lh(z,new Ui([a[3*t],a[3*t+1],a[3*t+2]],null,U?[U[2*t],U[2*t+1],0]:f),new Ui([a[3*I],a[3*I+1],a[3*I+2]],null,U?[U[2*I],U[2*I+1],0]:f),new Ui([a[3*l],a[3*l+1],a[3*l+2]],null,U?[U[2*l],U[2*l+1],0]:f),S);else for(y=a.length/3;y>B;B+=3)t=B,I=B+1,l=B+2,Lh(z,new Ui([a[3*t],a[3*t+1],a[3*t+2]],null,U?[U[2*t],U[2*t+1],0]:f),new Ui([a[3*I],a[3*I+1],a[3*I+2]],null,U?[U[2*I],U[2*I+1],0]:f),new Ui([a[3*l],a[3*l+1],a[3*l+2]],null,U?[U[2*l],U[2*l+1],0]:f),S);return z},lc=[_,s,J,y,x,g],Rd=["",x,g],Un=lc.concat("csg"),hi=[0,6,12,18,24,30],Jc=function(k,w,Y){var r=l(k),$=[];k.appendAnchorMatrix3d(r);var F,J=w?w.getData3dUI(k):null;if(J&&J.s("shape3d")&&!J.s("csg.cull.box")&&(F=J.shapeModel,J.shapeModel||(F=z.getShapeModel(J,J.s("shape3d"))),F))for(var U=z.createNormalMatrix(r),P=0,D=Rd.length;D>P;P++){var E=Rd[P],g=E.length?E+"_":E,u=F[g+"vs"],T=F[g+"uv"],m=F[g+"is"],o=F[g+"ns"];if(u&&u.length)for(var R,O,a,M=0,Z=m?m.length:u.length/3;Z>M;M+=3)m?(R=m[M],O=m[M+1],a=m[M+2]):(R=M,O=M+1,a=M+2),Lh($,new Ui(W([u[3*R],u[3*R+1],u[3*R+2]],r),o?W([o[3*R],o[3*R+1],o[3*R+2]],U):null,[T[2*R],T[2*R+1],0]),new Ui(W([u[3*O],u[3*O+1],u[3*O+2]],r),o?W([o[3*O],o[3*O+1],o[3*O+2]],U):null,[T[2*O],T[2*O+1],0]),new Ui(W([u[3*a],u[3*a+1],u[3*a+2]],r),o?W([o[3*a],o[3*a+1],o[3*a+2]],U):null,[T[2*a],T[2*a+1],0]),k)}if(!F)for(var P=0;6>P;P++)for(var E=lc[P],K=hi[P],T=Y?w.getFaceUv(k,E):f,v=Y?w.getFaceUvScale(k,E):f,d=Y?w.getFaceUvOffset(k,E):f,C=0;2>C;C++){var p,t,s,N=A[K+3*C],y=A[K+3*C+1],I=A[K+3*C+2];if(Y){if(T){var j=8*P;p=[T[2*N-j],T[2*N+1-j],0],t=[T[2*y-j],T[2*y+1-j],0],s=[T[2*I-j],T[2*I+1-j],0]}else p=[h[2*N],h[2*N+1],0],t=[h[2*y],h[2*y+1],0],s=[h[2*I],h[2*I+1],0];v&&(p[0]*=v[0],p[1]*=v[1],t[0]*=v[0],t[1]*=v[1],s[0]*=v[0],s[1]*=v[1]),d&&(p[0]+=d[0],p[1]+=d[1],t[0]+=d[0],t[1]+=d[1],s[0]+=d[0],s[1]+=d[1])}Lh($,new Ui(W([Q[3*N],Q[3*N+1],Q[3*N+2]],r),null,p),new Ui(W([Q[3*y],Q[3*y+1],Q[3*y+2]],r),null,t),new Ui(W([Q[3*I],Q[3*I+1],Q[3*I+2]],r),null,s),k)}return zf.$15n($)},of=function(U,u){var E,n=U.data.getAttaches();if(n&&n.each(function(b){b instanceof wk&&b.s("attach.operation")&&(E||(E=[]),E.push(b))}),E){var O;lc.forEach(function(c){var K=$q(c,U[c].vs,U[c].tuv);O=O?O.concat(K):K}),O=zf.$15n(O),E.forEach(function(r){var p=r.s("attach.operation");O[p]&&(O=O[p](Jc(r,U.gv,U.csg.tuv)))}),lc.forEach(function(l){l=U[l],l.vs=[],l.ns=[],l.tuv&&(l.tuv=[])}),U.csg&&!U.csg.ns&&(U.csg.ns=[]);var X=[];if(O.$19n().forEach(function(Y){var e,$=Y.$10n;if($ instanceof wk){if($.s("attach.cull"))return;e=$.s("csg.cull.color"),e&&(e=z.toColorArray(e)),$="csg"}for(var o=U[$],n=o.vs,N=o.ns,K=o.tuv,p=Y.$9n,H=2;H<p.length;H++)if(Oe(n,p[0].$24n),Oe(n,p[H-1].$24n),Oe(n,p[H].$24n),N&&(Oe(N,p[0].$22n),Oe(N,p[H-1].$22n),Oe(N,p[H].$22n)),K&&(Oe(K,p[0].uv,!0),Oe(K,p[H-1].uv,!0),Oe(K,p[H].uv,!0)),e)for(var g=4*(n.length/3),P=0;3>P;P++)X[--g]=e[3],X[--g]=e[2],X[--g]=e[1],X[--g]=e[0]}),X.length){for(var Y=z.toColorArray(U.csg.color),H=0,K=4*(U.csg.vs.length/3);K>H;H+=4)X[H]==Z&&(X[H]=Y[0],X[H+1]=Y[1],X[H+2]=Y[2],X[H+3]=Y[3]);U.csg.cs=X}}Un.forEach(function(Y){var c=U[Y];c.visible&&c.vs.length?(c.ns&&c.ns.length?V(c,"ns"):c.ns=G(c.vs),V(c,"vs"),V(c,"tuv"),c.cs&&V(c,"cs")):delete U[Y]}),u&&(r(U,f,u),U.clear())};E(C,{createFrameModel:function(M,p,G,q){M=M==f?.07:M,p=p==f?M:p,G=G==f?M:G,q=q?q:{};var $=q.top,b=q.bottom,F=q.left,s=q.right,e=q.front,Z=q.back,j=[],z=[];return e===!0?(j.push(-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5),z.push(0,0,0,1,1,1,1,1,1,0,0,0)):e===!1||(j.push(-.5,.5,.5,-.5,-.5,.5,-.5+M,-.5,.5,-.5+M,-.5,.5,-.5+M,.5,.5,-.5,.5,.5,.5-M,.5,.5,.5-M,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5-M,.5,.5,-.5+M,.5,.5,-.5+M,.5-p,.5,.5-M,.5-p,.5,.5-M,.5-p,.5,.5-M,.5,.5,-.5+M,.5,.5,-.5+M,-.5+p,.5,-.5+M,-.5,.5,.5-M,-.5,.5,.5-M,-.5,.5,.5-M,-.5+p,.5,-.5+M,-.5+p,.5),z.push(0,0,0,1,M,1,M,1,M,0,0,0,1-M,0,1-M,1,1,1,1,1,1,0,1-M,0,M,0,M,p,1-M,p,1-M,p,1-M,0,M,0,M,1-p,M,1,1-M,1,1-M,1,1-M,1-p,M,1-p)),Z===!0?(j.push(-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5),z.push(1,0,0,1,1,1,0,1,1,0,0,0)):Z===!1||(j.push(-.5,.5,-.5,-.5+M,-.5,-.5,-.5,-.5,-.5,-.5+M,-.5,-.5,-.5,.5,-.5,-.5+M,.5,-.5,.5-M,.5,-.5,.5,-.5,-.5,.5-M,-.5,-.5,.5,-.5,-.5,.5-M,.5,-.5,.5,.5,-.5,-.5+M,.5,-.5,.5-M,.5-p,-.5,-.5+M,.5-p,-.5,.5-M,.5-p,-.5,-.5+M,.5,-.5,.5-M,.5,-.5,-.5+M,-.5+p,-.5,.5-M,-.5,-.5,-.5+M,-.5,-.5,.5-M,-.5,-.5,-.5+M,-.5+p,-.5,.5-M,-.5+p,-.5),z.push(1,0,1-M,1,1,1,1-M,1,1,0,1-M,0,M,0,0,1,M,1,0,1,M,0,0,0,1-M,0,M,p,1-M,p,M,p,1-M,0,M,0,1-M,1-p,M,1,1-M,1,M,1,1-M,1-p,M,1-p)),F===!0?(j.push(-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5),z.push(0,0,0,1,1,1,1,1,1,0,0,0)):F===!1||(j.push(-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5+G,-.5,-.5,-.5+G,-.5,.5,-.5+G,-.5,.5,-.5,-.5,.5,.5-G,-.5,-.5,.5-G,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5-G,-.5,.5,-.5+G,-.5,.5-p,-.5+G,-.5,.5-p,.5-G,-.5,.5-p,.5-G,-.5,.5,.5-G,-.5,.5,-.5+G,-.5,-.5+p,-.5+G,-.5,-.5,-.5+G,-.5,-.5,.5-G,-.5,-.5,.5-G,-.5,-.5+p,.5-G,-.5,-.5+p,-.5+G),z.push(0,0,0,1,G,1,G,1,G,0,0,0,1-G,0,1-G,1,1,1,1,1,1,0,1-G,0,G,0,G,p,1-G,p,1-G,p,1-G,0,G,0,G,1-p,G,1,1-G,1,1-G,1,1-G,1-p,G,1-p)),s===!0?(j.push(.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5),z.push(1,0,0,1,1,1,0,1,1,0,0,0)):s===!1||(j.push(.5,.5,-.5,.5,-.5,-.5+G,.5,-.5,-.5,.5,-.5,-.5+G,.5,.5,-.5,.5,.5,-.5+G,.5,.5,.5-G,.5,-.5,.5,.5,-.5,.5-G,.5,-.5,.5,.5,.5,.5-G,.5,.5,.5,.5,.5,-.5+G,.5,.5-p,.5-G,.5,.5-p,-.5+G,.5,.5-p,.5-G,.5,.5,-.5+G,.5,.5,.5-G,.5,-.5+p,-.5+G,.5,-.5,.5-G,.5,-.5,-.5+G,.5,-.5,.5-G,.5,-.5+p,-.5+G,.5,-.5+p,.5-G),z.push(1,0,1-G,1,1,1,1-G,1,1,0,1-G,0,G,0,0,1,G,1,0,1,G,0,0,0,1-G,0,G,p,1-G,p,G,p,1-G,0,G,0,1-G,1-p,G,1,1-G,1,G,1,1-G,1-p,G,1-p)),$===!0?(j.push(.5,.5,.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5),z.push(1,1,1,0,0,0,0,0,0,1,1,1)):$===!1||(j.push(.5,.5,.5,.5,.5,-.5,.5-M,.5,-.5,.5-M,.5,-.5,.5-M,.5,.5,.5,.5,.5,-.5+M,.5,.5,-.5+M,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5+M,.5,.5,.5-M,.5,.5,.5-M,.5,.5-G,-.5+M,.5,.5-G,-.5+M,.5,.5-G,-.5+M,.5,.5,.5-M,.5,.5,.5-M,.5,-.5+G,.5-M,.5,-.5,-.5+M,.5,-.5,-.5+M,.5,-.5,-.5+M,.5,-.5+G,.5-M,.5,-.5+G),z.push(1,1,1,0,1-M,0,1-M,0,1-M,1,1,1,M,1,M,0,0,0,0,0,0,1,M,1,1-M,1,1-M,1-G,M,1-G,M,1-G,M,1,1-M,1,1-M,G,1-M,0,M,0,M,0,M,G,1-M,G)),b===!0?(j.push(.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5),z.push(1,0,0,1,1,1,0,1,1,0,0,0)):b===!1||(j.push(.5,-.5,.5,.5-M,-.5,-.5,.5,-.5,-.5,.5-M,-.5,-.5,.5,-.5,.5,.5-M,-.5,.5,-.5+M,-.5,.5,-.5,-.5,-.5,-.5+M,-.5,-.5,-.5,-.5,-.5,-.5+M,-.5,.5,-.5,-.5,.5,.5-M,-.5,.5,-.5+M,-.5,.5-G,.5-M,-.5,.5-G,-.5+M,-.5,.5-G,.5-M,-.5,.5,-.5+M,-.5,.5,.5-M,-.5,-.5+G,-.5+M,-.5,-.5,.5-M,-.5,-.5,-.5+M,-.5,-.5,.5-M,-.5,-.5+G,-.5+M,-.5,-.5+G),z.push(1,0,1-M,1,1,1,1-M,1,1,0,1-M,0,M,0,0,1,M,1,0,1,M,0,0,0,1-M,0,M,G,1-M,G,M,G,1-M,0,M,0,1-M,1-G,M,1,1-M,1,M,1,1-M,1-G,M,1-G)),{vs:j,uv:z}}}),E(c.Style,{"csg.cull.color":Z,"csg.cull.box":!0,"dw.flip":!1,"dw.s3":[.999,.999,.5],"dw.t3":Z,"dw.expanded":!1,"dw.toggleable":!0,"dw.axis":"left","dw.start":0,"dw.end":R/2,"dw.angle":0,"attach.cull":!1,"attach.operation":"subtract"},!0),lc.forEach(function(Q){var H={};H[Q+P]=!1,H[Q+".toggleable"]=!1,H[Q+".axis"]=_,H[Q+".start"]=0,H[Q+".end"]=R/2,H[Q+Xj]=0,E(c.Style,H,!0)});var zf=function(){this.$4n=[]};zf.$15n=function(g){var w=new zf;return w.$4n=g,w},zf.prototype={clone:function(){var G=new zf;return G.$4n=this.$4n.map(function(x){return x.clone()}),G},$19n:function(){return this.$4n},union:function(c){var j=new nk(this.clone().$4n),C=new nk(c.clone().$4n);return j.$3n(C),C.$3n(j),C.$6n(),C.$3n(j),C.$6n(),j.$7n(C.$2n()),zf.$15n(j.$2n())},subtract:function(j){var h=new nk(this.clone().$4n),r=new nk(j.clone().$4n);return h.$6n(),h.$3n(r),r.$3n(h),r.$6n(),r.$3n(h),r.$6n(),h.$7n(r.$2n()),h.$6n(),zf.$15n(h.$2n())},intersect:function(M){var j=new nk(this.clone().$4n),u=new nk(M.clone().$4n);return j.$6n(),u.$3n(j),u.$6n(),j.$3n(u),u.$3n(j),j.$7n(u.$2n()),j.$6n(),zf.$15n(j.$2n())},inverse:function(){var E=this.clone();return E.$4n.map(function(S){S.flip()}),E}},zf.cube=function(M){M=M||{};var E=new hn(M.center||[0,0,0]),L=M.radius?M.radius.length?M.radius:[M.radius,M.radius,M.radius]:[1,1,1];return zf.$15n([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(function(z){return new Ck(z[0].map(function(V){var u=new hn(E.x+L[0]*(2*!!(1&V)-1),E.y+L[1]*(2*!!(2&V)-1),E.z+L[2]*(2*!!(4&V)-1));return new Ui(u,new hn(z[1]))}))}))},zf.sphere=function(y){function Z(c,x){c*=2*R,x*=R;var d=new hn(u(c)*o(x),u(x),o(c)*o(x));j.push(new Ui(U.$20n(d.$21n(B)),d))}y=y||{};for(var j,U=new hn(y.center||[0,0,0]),B=y.radius||1,N=y.slices||16,D=y.stacks||8,h=[],m=0;N>m;m++)for(var g=0;D>g;g++)j=[],Z(m/N,g/D),g>0&&Z((m+1)/N,g/D),D-1>g&&Z((m+1)/N,(g+1)/D),Z(m/N,(g+1)/D),h.push(new Ck(j));return zf.$15n(h)},zf.cylinder=function(S){function j(F,z,S){var P=2*z*R,Z=x.$21n(u(P)).$20n(I.$21n(o(P))),s=G.$20n(r.$21n(F)).$20n(Z.$21n(y)),C=Z.$21n(1-X(S)).$20n(t.$21n(S));return new Ui(s,C)}S=S||{};for(var G=new hn(S.start||[0,-1,0]),C=new hn(S.end||[0,1,0]),r=C.$13n(G),y=S.radius||1,H=S.slices||16,t=r.$14n(),b=X(t.y)>.5,x=new hn(b,!b,0).cross(t).$14n(),I=x.cross(t).$14n(),c=new Ui(G,t.$11n()),J=new Ui(C,t.$14n()),K=[],s=0;H>s;s++){var m=s/H,p=(s+1)/H;K.push(new Ck([c,j(0,m,-1),j(0,p,-1)])),K.push(new Ck([j(0,p,0),j(0,m,0),j(1,m,0),j(1,p,0)])),K.push(new Ck([J,j(1,p,1),j(1,m,1)]))}return zf.$15n(K)};var hn=function(T,L,t){var d=this;3==arguments.length?(d.x=T,d.y=L,d.z=t):"x"in T?(d.x=T.x,d.y=T.y,d.z=T.z):(d.x=T[0],d.y=T[1],d.z=T[2])};hn.prototype={clone:function(){return new hn(this.x,this.y,this.z)},$11n:function(){return new hn(-this.x,-this.y,-this.z)},$20n:function(j){return new hn(this.x+j.x,this.y+j.y,this.z+j.z)},$13n:function(N){return new hn(this.x-N.x,this.y-N.y,this.z-N.z)},$21n:function(r){return new hn(this.x*r,this.y*r,this.z*r)},$16n:function(q){return new hn(this.x/q,this.y/q,this.z/q)},dot:function(K){return this.x*K.x+this.y*K.y+this.z*K.z},lerp:function(s,I){return this.$20n(s.$13n(this).$21n(I))},length:function(){return S(this.dot(this))},$14n:function(){return this.$16n(this.length())},cross:function(b){var h=this;return new hn(h.y*b.z-h.z*b.y,h.z*b.x-h.x*b.z,h.x*b.y-h.y*b.x)}};var Ui=function(r,x,z){var D=this;D.$24n=new hn(r),D.$22n=x?new hn(x):null,D.uv=z?new hn(z):null};Ui.prototype={clone:function(){var f=this;return new Ui(f.$24n.clone(),f.$22n.clone(),f.uv?f.uv.clone():null)},flip:function(){this.$22n=this.$22n.$11n()},$18n:function(W,Z){var B=this;return new Ui(B.$24n.lerp(W.$24n,Z),B.$22n.lerp(W.$22n,Z),B.uv?B.uv.lerp(W.uv,Z):null)}};var _n=function(y,r){this.$22n=y,this.w=r};_n.$17n=function(X,y,w){var H=y.$13n(X).cross(w.$13n(X)).$14n();return new _n(H,H.dot(X))},_n.prototype={clone:function(){return new _n(this.$22n.clone(),this.w)},flip:function(){var H=this;H.$22n=H.$22n.$11n(),H.w=-H.w},$5n:function(t,J,x,q,o){for(var z=this,O=0,Y=1,R=2,C=3,A=0,e=[],U=0;U<t.$9n.length;U++){var i=z.$22n.dot(t.$9n[U].$24n)-z.w,p=-F>i?R:i>F?Y:O;A|=p,e.push(p)}switch(A){case O:(z.$22n.dot(t.$8n.$22n)>0?J:x).push(t);break;case Y:q.push(t);break;case R:o.push(t);break;case C:for(var _=[],B=[],U=0;U<t.$9n.length;U++){var M=(U+1)%t.$9n.length,W=e[U],u=e[M],Z=t.$9n[U],P=t.$9n[M];if(W!=R&&_.push(Z),W!=Y&&B.push(W!=R?Z.clone():Z),(W|u)==C){var i=(z.w-this.$22n.dot(Z.$24n))/z.$22n.dot(P.$24n.$13n(Z.$24n)),D=Z.$18n(P,i);_.push(D),B.push(D.clone())}}_.length>=3&&q.push(new Ck(_,t.$10n)),B.length>=3&&o.push(new Ck(B,t.$10n))}}};var Ck=function(f,x){var u=this;u.$9n=f,u.$10n=x,u.$8n=_n.$17n(f[0].$24n,f[1].$24n,f[2].$24n)};Ck.prototype={clone:function(){var u=this.$9n.map(function(W){return W.clone()});return new Ck(u,this.$10n)},flip:function(){this.$9n.reverse().map(function(J){J.flip()}),this.$8n.flip()}};var nk=function(_){var Z=this;Z.$8n=null,Z.front=null,Z.back=null,Z.$4n=[],_&&Z.$7n(_)};nk.prototype={clone:function(){var b=this,L=new nk;return L.$8n=b.$8n&&b.$8n.clone(),L.front=b.front&&b.front.clone(),L.back=b.back&&b.back.clone(),L.$4n=b.$4n.map(function(F){return F.clone()}),L},$6n:function(){for(var r=this,O=0;O<r.$4n.length;O++)r.$4n[O].flip();r.$8n&&r.$8n.flip(),r.front&&r.front.$6n(),r.back&&r.back.$6n();var w=r.front;r.front=r.back,r.back=w},$1n:function(m){var e=this;if(!e.$8n)return m.slice();for(var x=[],B=[],j=0;j<m.length;j++)e.$8n.$5n(m[j],x,B,x,B);return e.front&&(x=e.front.$1n(x)),B=e.back?e.back.$1n(B):[],x.concat(B)},$3n:function(Q){var J=this;J.$4n=Q.$1n(J.$4n),J.front&&J.front.$3n(Q),J.back&&J.back.$3n(Q)},$2n:function(){var I=this,l=I.$4n.slice();return I.front&&(l=l.concat(I.front.$2n())),I.back&&(l=l.concat(I.back.$2n())),l},$7n:function(o){var U=this;if(o.length){U.$8n||(U.$8n=o[0].$8n.clone());for(var $=[],E=[],M=0;M<o.length;M++)this.$8n.$5n(o[M],U.$4n,U.$4n,$,E);$.length&&(U.front||(U.front=new nk),this.front.$7n($)),E.length&&(U.back||(U.back=new nk),U.back.$7n(E))}}};var Mm="symbol",ar=c.Symbol=function(A,_,s){var N=this;j(ar,N),N.s3(20,20,20),N.s({"all.visible":!1,shape:"rect"}),N.setIcon(A,_,s)};Xe("Symbol",$,{setIcon:function($,y,F){var d,U=this;return ar.superClass.setIcon.call(U,$),$?(d={for3d:!0,face:"center",position:44,names:[$]},F&&(d.transaprent=!0),y&&(d.autorotate=y),U.addStyleIcon(Mm,d)):U.removeStyleIcon(Mm),U.setWidth(z.getImageWidth(C.getImage($),U)||20),d}});var wk=c.CSGNode=function(){j(wk,this),this.s({shape:"rect","attach.thickness":1.001,"2d.attachable":!0})},fm={position:1,width:1,height:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,tall:1,elevation:1,anchor:1,anchorElevation:1,"s:attach.cull":1,"s:attach.operation":1};Xe("CSGNode",$,{_22Q:function(){return ge},onPropertyChanged:function(c){var p=this,A=p.getHost();wk.superClass.onPropertyChanged.call(p,c),fm[c.property]&&(A instanceof Je||A instanceof wk)&&A.fp("csgNodeChange",!0,!1)}});var ge=function(s,l){j(ge,this,[s,l])};k(ge,a.Node3dUI,{_80o:function(R,k,S){var b=this;b._shape3d?ge.superClass._80o.call(b,R,k,S):(v(b.gv),Un.forEach(function(e){t(b,R,k,e,S)}))},validate:function($,X){var S=this,y=S.gv,G=S.data;if(G.s("shape3d"))return ge.superClass.validate.call(S,$,X),S._shape3d=!0,void 0;S._shape3d=!1;var R=l(G,y.getMat(G));G.appendAnchorMatrix3d(R);var N=$&&$.uv;S.vf2("csg",N);for(var g=0;6>g;g++)for(var m=lc[g],u=hi[g],e=S.vf2(m,N,X),L=e.mat||R,E=e.vs,P=e.uv,D=e.tuv,k=0;2>k;k++){var v=A[u+3*k],t=A[u+3*k+1],C=A[u+3*k+2];if(U(E,L,[Q[3*v],Q[3*v+1],Q[3*v+2]]),U(E,L,[Q[3*t],Q[3*t+1],Q[3*t+2]]),U(E,L,[Q[3*C],Q[3*C+1],Q[3*C+2]]),D)if(P){var w=8*g;D.push(P[2*v-w],P[2*v+1-w],P[2*t-w],P[2*t+1-w],P[2*C-w],P[2*C+1-w])}else D.push(h[2*v],h[2*v+1],h[2*t],h[2*t+1],h[2*C],h[2*C+1])}of(S,$,X)},vf2:function(e,J,q){var c,k=this,b=k.gv.getFaceVisible(k.data,e);return c=n(k,e,q),c.vs=[],c.tuv=b&&(c.texture||J)?[]:f,c.visible=b,c}});var Je=c.CSGShape=function(){var n=this;j(Je,n),n.s({"shape.background":f,"2d.hostable":!0,"shape.border.width":8}),n.setTall(240),n.setElevation(120),n.setThickness(14)};Xe("CSGShape",I,{IRotatable:!1,_22Q:function(){return Hn},setRotationX:function(){},setRotation:function(){},setRotationZ:function(){},setSegments:function(){}});var Hn=function(v,f){j(Hn,this,[v,f])};k(Hn,a.Shape3dUI,{_80o:function(f,n,D){var i=this;i.undrawable||(v(i.gv),Un.forEach(function(v){t(i,f,n,v,D)}))},validate:function(M,r){var e=this,q=e.data,E=q.getPoints();if(e.undrawable=E.size()<2)return e.clear(),void 0;var s=q.isClosePath(),z=K(q._thickness/2,F),g=B(E,f,f,s);Un.forEach(function(b){e.vf(b,M&&M.uv,!0,r)}),s&&(e.left.visible=!1,e.right.visible=!1),e._12O(g,z),e._20Q(g);var I=q.getPointsMatrix3d(),V=c.Math.requestVector3();lc.forEach(function(p){if(e[p])for(var S=e[p].vs,d=0,D=S.length;D>d;d+=3)V.set(S[d],S[d+1],S[d+2]).applyMatrix4(I),S[d]=V.x,S[d+1]=V.y,S[d+2]=V.z}),c.Math.releaseVector3(V),of(e,M,r)}});var Hm=c.DoorWindow=function(){var A=this;j(Hm,A),A.setElevation(100),A.s3(100,200,14)};Xe("DoorWindow",wk,{IDoorWindow:!0,toggle:function(d){this.setExpanded(!this.s(m),d)},isExpanded:function(){return this.s(m)},setExpanded:function(d,o){var n=this,t=n.$25n,E=n.getDataModel(),Z=n.s(m);if(t&&(t.stop(!0),delete n.$25n),Z!==d){E&&E.beginTransaction();var J=d?n.s("dw.end"):n.s("dw.start");n.s(m,d),o=i(o),o?(Z=n.s(kq),o.action=function(d){n.s(kq,Z+(J-Z)*d)},o.finishFunc=function(){E&&E.endTransaction()},n.$25n=e(o)):(n.s(kq,J),E&&E.endTransaction())}},getMat:function(){var h=this,k=h.s("dw.s3"),X=h.s("dw.t3"),Y=h.s("dw.flip"),V=h.s(kq);if(k||V||X||Y){var I=[];if(Y&&I.push({r3:[0,R,0]}),k&&I.push({s3:k}),V){k=h.getFinalScale3d();var w=h.s("dw.axis"),n=k[0]/2,M=k[1]/2;k[2]/2,w===_?I.push({t3:[n,0,0]},{r3:[0,-V,0]},{t3:[-n,0,0]}):w===J?I.push({t3:[-n,0,0]},{r3:[0,V,0]},{t3:[n,0,0]}):w===x?I.push({t3:[0,-M,0]},{r3:[-V,0,0]},{t3:[0,M,0]}):w===g?I.push({t3:[0,M,0]},{r3:[V,0,0]},{t3:[0,-M,0]}):w===H?I.push({r3:[0,V,0]}):w===O&&I.push({r3:[V,0,0]})}return X&&I.push({t3:X}),d(I)}return f}});var Te=c.CSGBox=function(){var O=this;j(Te,O),O.setElevation(100),O.s3(100,200,100)};Xe("CSGBox",wk,{ICSGBox:!0,toggleFace:function(Y,j){this.setFaceExpanded(Y,!this.s(Y+P),j)},isFaceExpanded:function(V){return this.s(V+P)},setFaceExpanded:function(O,f,z){var Q=this,_=Q.$25n,b=Q.s(O+P);if(_&&(_.stop(!0),delete Q.$25n),b!==f){var N=f?Q.s(O+".end"):Q.s(O+".start");Q.s(O+P,f),z=i(z),z?(b=Q.s(O+Xj),z.action=function(Y){Q.s(O+Xj,b+(N-b)*Y)},Q.$25n=e(z)):Q.s(O+Xj,N)}},getFaceMat:function(y){var r=this,j=r.s(y+Xj);if(!j)return f;var C,h,T,F,O,B,x=r.s(y+".axis"),z=r.getFinalScale3d(),u=r.getAnchor3d(),E=z[0]*u.x,n=z[1]*u.y,s=z[2]*u.z,H=z[0]-E,o=z[1]-n,_=z[2]-s,v=y+"_"+x;switch(v){case"front_left":C=-E,h=0,T=_,F=0,O=-j,B=0;break;case"front_right":C=H,h=0,T=_,F=0,O=j,B=0;break;case"front_top":C=0,h=o,T=_,F=-j,O=0,B=0;break;case"front_bottom":C=0,h=-n,T=_,F=j,O=0,B=0;break;case"front_h":C=0,h=0,T=_,F=j,O=0,B=0;break;case"front_v":C=0,h=0,T=_,F=0,O=j,B=0;break;case"back_left":C=H,h=0,T=-s,F=0,O=-j,B=0;break;case"back_right":C=-E,h=0,T=-s,F=0,O=j,B=0;break;case"back_top":C=0,h=o,T=-s,F=j,O=0,B=0;break;case"back_bottom":C=0,h=-n,T=-s,F=-j,O=0,B=0;break;case"back_h":C=0,h=0,T=-s,F=j,O=0,B=0;break;case"back_v":C=0,h=0,T=-s,F=0,O=j,B=0;break;case"left_left":C=-E,h=0,T=-s,F=0,O=-j,B=0;break;case"left_right":C=-E,h=0,T=_,F=0,O=j,B=0;break;case"left_top":C=-E,h=o,T=0,F=0,O=0,B=-j;break;case"left_bottom":C=-E,h=-n,T=0,F=0,O=0,B=j;break;case"left_h":C=-E,h=0,T=0,F=0,O=0,B=j;break;case"left_v":C=-E,h=0,T=0,F=0,O=j,B=0;break;case"right_left":C=H,h=0,T=_,F=0,O=-j,B=0;break;case"right_right":C=H,h=0,T=-s,F=0,O=j,B=0;break;case"right_top":C=H,h=o,T=0,F=0,O=0,B=j;break;case"right_bottom":C=H,h=-n,T=0,F=0,O=0,B=-j;break;case"right_h":C=H,h=0,T=0,F=0,O=0,B=j;break;case"right_v":C=H,h=0,T=0,F=0,O=j,B=0;break;case"top_left":C=-E,h=o,T=0,F=0,O=0,B=j;break;case"top_right":C=H,h=o,T=0,F=0,O=0,B=-j;break;case"top_top":C=0,h=o,T=-s,F=-j,O=0,B=0;break;case"top_bottom":C=0,h=o,T=_,F=j,O=0,B=0;break;case"top_h":C=0,h=o,T=0,F=j,O=0,B=0;break;case"top_v":C=0,h=o,T=0,F=0,O=0,B=j;break;case"bottom_left":C=-E,h=-n,T=0,F=0,O=0,B=-j;break;case"bottom_right":C=H,h=-n,T=0,F=0,O=0,B=j;break;case"bottom_top":C=0,h=-n,T=_,F=-j,O=0,B=0;break;case"bottom_bottom":C=0,h=-n,T=-s,F=j,O=0,B=0;break;case"bottom_h":C=0,h=-n,T=0,F=j,O=0,B=0;break;case"bottom_v":C=0,h=-n,T=0,F=0,O=0,B=j}return d([{t3:[-C,-h,-T]},{r3:[F,O,B]},{t3:[C,h,T]}])}});var Wr=function(L,V,E,A,m){function c(){var H,f=[],D=new b,E=new b;for(R.eachShapeModel(function(H,r,w){for(var U=0,Y=r?r.length:H.length/3;Y>U;U++)r?(D.fromArray(H,3*r[U]),E.fromArray(w,3*r[U])):(D.fromArray(H,3*U),E.fromArray(w,3*U)),N(f,D,E)}),f=C(f,B.set(1,0,0)),f=C(f,B.set(-1,0,0)),f=C(f,B.set(0,1,0)),f=C(f,B.set(0,-1,0)),f=C(f,B.set(0,0,1)),f=C(f,B.set(0,0,-1)),H=0;H<f.length;H++){var O=f[H];X.push(.5+O.position.x/m.x,.5-O.position.y/m.y),O.position.applyMatrix4($),F.push(O.position.x,O.position.y,O.position.z),Z.push(O.$22n.x,O.$22n.y,O.$22n.z)}}function N(Z,e,X){e.applyMatrix4(r),e.applyMatrix4(S),X.transformDirection(r),X.transformDirection(S),Z.push(new Y(e.clone(),X.clone()))}function C(x,c){for(var D=[],s=.5*Math.abs(m.dot(c)),l=0;l<x.length;l+=3){var A,O,Z,F,B,Y,T,g=0,i=x[l+0].position.dot(c)-s,L=x[l+1].position.dot(c)-s,M=x[l+2].position.dot(c)-s;switch(A=i>0,O=L>0,Z=M>0,g=(A?1:0)+(O?1:0)+(Z?1:0)){case 0:D.push(x[l]),D.push(x[l+1]),D.push(x[l+2]);break;case 1:if(A&&(F=x[l+1],B=x[l+2],Y=n(x[l],F,c,s),T=n(x[l],B,c,s)),O){F=x[l],B=x[l+2],Y=n(x[l+1],F,c,s),T=n(x[l+1],B,c,s),D.push(Y),D.push(B.clone()),D.push(F.clone()),D.push(B.clone()),D.push(Y.clone()),D.push(T);break}Z&&(F=x[l],B=x[l+1],Y=n(x[l+2],F,c,s),T=n(x[l+2],B,c,s)),D.push(F.clone()),D.push(B.clone()),D.push(Y),D.push(T),D.push(Y.clone()),D.push(B.clone());break;case 2:A||(F=x[l].clone(),B=n(F,x[l+1],c,s),Y=n(F,x[l+2],c,s),D.push(F),D.push(B),D.push(Y)),O||(F=x[l+1].clone(),B=n(F,x[l+2],c,s),Y=n(F,x[l],c,s),D.push(F),D.push(B),D.push(Y)),Z||(F=x[l+2].clone(),B=n(F,x[l],c,s),Y=n(F,x[l+1],c,s),D.push(F),D.push(B),D.push(Y));break;case 3:}}return D}function n(x,H,l,z){var p=x.position.dot(l)-z,i=H.position.dot(l)-z,R=p/(p-i),Z=new Y(new b(x.position.x+R*(H.position.x-x.position.x),x.position.y+R*(H.position.y-x.position.y),x.position.z+R*(H.position.z-x.position.z)),new b(x.$22n.x+R*(H.$22n.x-x.$22n.x),x.$22n.y+R*(H.$22n.y-x.$22n.y),x.$22n.z+R*(H.$22n.z-x.$22n.z)));return Z}var F=[],Z=[],X=[],B=new b,R=L.getData3dUI(V);if(R.mat){var r=(new M).fromArray(R.mat),j=new M;j.makeRotationFromEuler(A),j.setPosition(E);var S=(new M).getInverse(j),$=(new M).scale({x:1/m.x,y:1/m.y,z:1/m.z});return c(),{vs:F,ns:Z,uv:X}}};Y.prototype.clone=function(){return new Y(this.position.clone(),this.$22n.clone())};var pj=function(C,J,G,K){var e=this,V=e.getDataAt(C);if(V){var w=e.intersectObject(C,V);if(w){"object"==typeof J?J=J.x?new b(J.x,J.y,J.z):new b(J[0],J[1],J[2]):(J=J||20,J=new b(J,J,J)),G=G===Z?.1:G;var S=new b(e.getUp()),Y=new b(e.getCenter()).sub(new b(e.getEye())).normalize(),B="cross",o=Y.clone()[B](S).normalize();S.copy(o)[B](Y).normalize(),K&&S.applyAxisAngle(w.worldNormal,-K);var U=new c.Node,D=w.worldNormal.clone().setLength(G).add(w.world),u=(new M).lookAt(w.worldNormal.clone(),new b(0,0,0),S),x=(new q).setFromRotationMatrix(u),a=Wr(e,V,w.world.clone(),x,J);return U.p3(D.x,D.y,D.z),U.setEuler(x),U.s3(J.x,J.y,J.z),U.s({shape3d:a,"shape3d.reverse.flip":!0}),U}}};E(c.graph3d.Graph3dView,{createDecal:pj})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);