/*
 * client3d.js - v0.3.9
 * Compiled Mon Jun 07 2021 16:36:32 GMT+0800 (中国标准时间)
 * Copyright (c) 2021 www.hightopo.com
 */

var hteditor3d=function(){"use strict";function C(C){return/^scenes/.test(C)}function e(C){return/^models/.test(C)}function l(C){return/^symbols/.test(C)}function d(C){return/^assets/.test(C)}function N(C){return/\.obj$/i.test(C)}function T(C){return/\.mtl$/i.test(C)}function M(C){return/\.(png|jpg|gif|jpeg|bmp|svg)$/i.test(C)}function _(C){return/\.json$/i.test(C)}function K(C){return C&&"object"==typeof C}function h(C){return"string"==typeof C||C instanceof String}function X(C){return ht.Default.getImageMap()[C]?(delete ht.Default.getImageMap()[C],!0):ht.Default.getCompTypeMap()[C]?(delete ht.Default.getCompTypeMap()[C],!0):(void 0!==ht.Default.getShape3dModel(C)&&ht.Default.setShape3dModel(C,void 0),!1)}function J(C,e,l,d){var N=new ht.Tab;return N.setName(e),N.setView(l),C.getTabModel().add(N),d&&C.getTabModel().sm().ss(N),N}function t(C){var e=new RegExp("(^|&)"+C+"=([^&]*)(&|$)"),l=window.location.search.substr(1).match(e);return null!=l?decodeURIComponent(l[2]):null}function F(C,e,l){if(C instanceof Array)for(var d=0,N=C.length;d<N;d++)F(C[d],e,l);else if(C instanceof Object)for(var T in C)if(C.hasOwnProperty(T)){var M=C[T];if(!K(M))continue;if(h(M.func)&&z.test(M.func)){var _=M.func.slice(5);e&&void 0===e[_]&&(e[_]=T),l&&void 0===l[_]&&(l[_]=M.value)}else F(M,e,l)}}var Q=hteditor;Q.getString;Q.createTablePane=function(){var C=new ht.widget.TablePane;return C.getView().style.border=hteditor.config.color_line+" solid 1px",C};var A=function(){},z=/^attr@/,q=ht.Default,D=Q.config;!function(C){for(var e in C)void 0===D[e]&&(D[e]=C[e])}({texureImage3D:!0,modelDialogClasses:{},objViewSize:{width:800,height:500},imageViewSize:{width:600,height:500},sceneGridEnabled:!0,sceneGridBlockCount:50,sceneGridBlockSize:40,sceneGridColor:"rgb(191, 191, 191)",sceneEye:q.graph3dViewEye,sceneCenter:q.graph3dViewCenter,sceneNear:q.graph3dViewNear,sceneFar:q.graph3dViewFar,sceneBloom:!1,sceneBloomStrength:1.5,sceneBloomThreshold:.55,sceneBloomRadius:.4,sceneDof:!1,sceneDofAperture:.025,sceneDofImage:null,sceneHighlightMode:"style",sceneHighlightColor:ht.Style["highlight.color"],sceneHighlightWidth:ht.Style["highlight.width"],sceneDashEnable:!1,sceneHeadlightEnable:!q.graph3dViewHeadlightDisabled,sceneHeadlightRange:q.graph3dViewHeadlightRange,sceneHeadlightColor:"rgb(255,255,255)",sceneHeadlightIntensity:q.graph3dViewHeadlightIntensity,sceneHeadlightAmbientIntensity:q.graph3dViewHeadlightAmbientIntensity,sceneFogEnable:!q.graph3dViewFogDisabled,sceneFogColor:q.graph3dViewFogColor,sceneFogNear:q.graph3dViewFogNear,sceneFogFar:q.graph3dViewFogFar,sceneBatchBrightnessDisabled:q.graph3dViewBatchBrightnessDisabled,sceneBatchBlendDisabled:q.graph3dViewBatchBlendDisabled,sceneBatchColorDisabled:q.graph3dViewBatchColorDisabled,sceneShadowEnabled:!1,sceneShadowDegreeX:ht.Default.graph3dViewShadowDegreeX,sceneShadowDegreeZ:ht.Default.graph3dViewShadowDegreeZ,sceneShadowIntensity:ht.Default.graph3dViewShadowIntensity,sceneShadowQuality:ht.Default.graph3dViewShadowQuality,sceneShadowType:ht.Default.graph3dViewShadowType,sceneShadowRadius:ht.Default.graph3dViewShadowRadius,sceneShadowBias:ht.Default.graph3dViewShadowBias,sceneEditHelperDisabled:!1,sceneOrthographic:!1}),["TitleScenes"].forEach(function(C){null==D.expandedTitles[C]&&(D.expandedTitles[C]=!0)});ht.Default.setImage("editor.axis",{background:"rgb(179,179,179)",width:16,height:16,blendMode:"override",comps:[{type:"shape",borderWidth:1,borderColor:"rgb(138,138,138)",borderCap:"round",shadowColor:"#1ABC9C",points:[8,2.48536,8,9,1.08734,12.01256,8,9,14,13]}]}),ht.Default.setImage("editor.cube.image",{width:100,height:100,comps:[{type:"rect",background:"rgba(156,156,156,0.4)",rect:[0,0,100,100]}]}),ht.Default.setImage("editor.sphere.image",{width:100,height:100,comps:[{type:"oval",background:"rgba(156,156,156,0.4)",rect:[0,0,100,100]}]}),ht.Default.setImage("editor.floor",{background:"rgb(0,0,0)",width:16,height:16,comps:[{type:"parallelogram",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.5056,9.71598,12.98879,3.75]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",opacity:.2,points:[14.49439,9.71598,14.49439,1.61266,4.70858,1.61266,4.70858,9.71598]}]}),ht.Default.setImage("editor.wall",{background:"rgb(0,0,0)",width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.2,points:[2,15,10,15,14,11]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",points:[6,2,14,2,14,11,6,11,2,15,2,6,6,2,6,11]}]}),ht.Default.setImage("editor.cancel",{background:"red",width:16,height:16,comps:[{type:"circle",borderWidth:1,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[1,1,14,14]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[10.94702,4.96729,4.99893,11.04194]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[5,4.96729,11.29505,11.29505]}]}),ht.Default.setImage("editor.pipeline",{background:"rgb(82,82,82)",width:16,height:16,blendMode:"override",comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",points:[14.11524,6.61831,14.11524,6.61831,9.30492,12.81031,8.07676,10.14929,6.8486,7.48826,9.56079,4.00846,6.33686,4.00846,3.11293,4.00846,.86129,8.92112,.86129,8.92112],segments:[1,4,4,4]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[15.28357,7.93382,15.28357,7.93382,10.47326,14.12582,9.24509,11.46479,8.01693,8.80377,10.72913,5.32397,7.50519,5.32397,4.28126,5.32397,2.02963,10.23663,2.02963,10.23663],segments:[1,4,4,4]}]}),ht.Default.setImage("editor.doorWindow",{width:16,height:16,comps:[{type:"rect",borderWidth:1,borderColor:"#979797",rect:[4.5,.5,7,15]},{type:"shape",borderWidth:1,borderColor:"#979797",points:[8.5469,8,10.42756,8]}]}),ht.Default.setImage("editor.cube",{background:"rgb(82,82,82)",width:16,height:16,blendMode:"override",comps:[{type:"rect",borderWidth:1,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[2.48996,3.51341,9.97783,10.97318]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[15,1,12.39369,3.59417,12.39369,14.44,15,11.41017,15,1,5.46231,1,2.50972,3.59417]}]}),ht.Default.setImage("editor.sphere",{background:"rgb(179,179,179)",width:16,height:16,comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.49999,1.5,13,13]},{type:"arc",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",arcFrom:3.22886,arcTo:5.96903,arcClose:!1,arcOval:!0,opacity:.4,rotation:2.4578,rect:[.10993,1.43114,12.94079,10.68594]}]}),ht.Default.setImage("editor.cylinder",{background:"rgb(179,179,179)",width:16,height:16,comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.5,1.5,13,9.5]},{type:"arc",borderWidth:1,borderColor:"rgb(255,255,255)",arcClose:!1,arcOval:!0,opacity:.4,rotation:3.14159,rect:[1.49362,6,13,9.5]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[1.49362,10.75,1.48724,6.35177]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[14.5,10.75,14.5,6.10177]}]}),ht.Default.setImage("editor.scene.cone",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[3,10,10,3.48659]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[3,12,8,2,13,12]}]}),ht.Default.setImage("editor.scene.torus",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1,4,14,10]},{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[2,2,12,10]}]}),ht.Default.setImage("editor.scene.triangle",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"triangle",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1.53493,5,13.1269,9.05393]},{type:"triangle",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[2.09838,2,12,10]}]}),ht.Default.setImage("editor.scene.rightTriangle",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"rightTriangle",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1.53493,5,13.1269,9.05393]},{type:"rightTriangle",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[3.09838,2,10.90162,10]}]}),ht.Default.setImage("editor.scene.parallelogram",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"parallelogram",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1,5,14,8]},{type:"parallelogram",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1,2,13,8]}]}),ht.Default.setImage("editor.scene.trapezoid",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"trapezoid",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[.90479,6,14,8]},{type:"trapezoid",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.40479,2.5,13,9]}]}),ht.Default.setImage("editor.scene.rect",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"rect",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1.53493,5,13.1269,9.05393]},{type:"rect",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[3.2894,2.39375,9.61796,9.2125]}]}),ht.Default.setImage("editor.scene.roundRect",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"roundRect",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1.53493,5,13.1269,9.05393]},{type:"roundRect",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[3.2894,2.39375,9.61796,9.2125]}]}),ht.Default.setImage("editor.scene.star",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"star",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,rect:[1.59838,2,13,13]},{type:"star",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[2,1,12,12]}]}),ht.Default.setImage("editor.scene.box",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"rect",borderWidth:1,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",opacity:.4,rect:[2.48996,3.51341,9.97783,10.97318]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[15,1,12.39369,3.59417,12.39369,14.44,15,11.41017,15,1,5.46231,1,2.50972,3.59417]}]}),ht.Default.setImage("editor.scene.billboard",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[8,13,6,10,3,10,3,3,13,3,13,10,10,10,8,13]}]}),ht.Default.setImage("editor.scene.plane",{background:"rgb(82,82,82)",width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[1.5,12.5,5.5,7.5,14.5,7.5,10.5,12.5,1.5,12.5]}]});var R=(function(){function C(C){this.value=C}function e(e){function l(C,e){return new Promise(function(l,N){var _={key:C,arg:e,resolve:l,reject:N,next:null};M?M=M.next=_:(T=M=_,d(C,e))})}function d(l,T){try{var M=e[l](T),_=M.value;_ instanceof C?Promise.resolve(_.value).then(function(C){d("next",C)},function(C){d("throw",C)}):N(M.done?"return":"normal",M.value)}catch(C){N("throw",C)}}function N(C,e){switch(C){case"return":T.resolve({value:e,done:!0});break;case"throw":T.reject(e);break;default:T.resolve({value:e,done:!1})}T=T.next,T?d(T.key,T.arg):M=null}var T,M;this._invoke=l,"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(C){return this._invoke("next",C)},e.prototype.throw=function(C){return this._invoke("throw",C)},e.prototype.return=function(C){return this._invoke("return",C)}}(),function(C,e){if(!(C instanceof e))throw new TypeError("Cannot call a class as a function")}),m=function(){function C(C,e){for(var l=0;l<e.length;l++){var d=e[l];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(C,d.key,d)}}return function(e,l,d){return l&&C(e.prototype,l),d&&C(e,d),e}}(),Y=function(C,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);C.prototype=Object.create(e&&e.prototype,{constructor:{value:C,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(C,e):C.__proto__=e)},$=function(C,e){if(!C)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?C:e},g=function(){function C(e,l){var d=this;R(this,C),this.handler=e,this.editor=l,this.cookie=0,this.callbacks={},this.cmds={};var N=hteditor.config.host||window.location.hostname,T=hteditor.config.port||window.location.port,M=window.location.protocol+"//"+N+":"+T;this.socket=io.connect(M),this.socket.on("connect",function(){d.handler({type:"connected",message:M})}),this.socket.on("disconnect",function(){d.handler({type:"disconnected",message:M})}),this.socket.on("fileChanged",function(C){d.handler({type:"fileChanged",path:C.path,event:C.event})}),this.socket.on("operationDone",function(C,e){d.handleRespone(C,e)}),this.socket.on("download",function(C){d.handler({type:"download",path:C})}),this.socket.on("confirm",function(C,e){d.handler({type:"confirm",path:C,datas:e})})}return C.prototype.request=function(C,e,l){var d=++this.cookie;this.callbacks[d]=l,this.cmds[d]=C;var N=this.editor.sid;this.socket.emit(C,d,e,N?{sid:N}:null);var T=C;e&&(ht.Default.isString(e)?T=C+": "+e:e.path&&(T=C+": "+e.path)),this.handler({type:"request",message:T,cmd:C,data:e})},C.prototype.handleRespone=function(C,e){var l=this.callbacks[C],d=this.cmds[C];delete this.callbacks[C],delete this.cmds[C],l&&l(e),this.handler({type:"response",message:d,cmd:d,data:e})},C}(),W=function(C){function e(l){return R(this,e),$(this,C.call(this,l,"scenes"))}return Y(e,C),e.prototype.initTreeMenu=function(C,e){this.addLocateTreeFileItem(e),this.addNewFolderItem(e,this.tree),this.addRenameItem(e,this.tree),this.addDeleteItem(e,this.tree)},e.prototype.initListMenu=function(C,e){this.addLocateListFileItem(e),this.addNewFolderItem(e,this.list),this.addCopyItem(e),this.addPasteItem(e),this.addRenameItem(e,this.list),this.addDeleteItem(e,this.list),this.addExportItem(e)},e}(hteditor.Explorer),w=function(C){function e(l){return R(this,e),$(this,C.call(this,l,"models"))}return Y(e,C),e.prototype.initTreeMenu=function(C,e){this.addLocateTreeFileItem(e),this.addNewFolderItem(e,this.tree),this.addRenameItem(e,this.tree),this.addDeleteItem(e,this.tree)},e.prototype.initListMenu=function(C,e){this.addLocateListFileItem(e),this.addNewFolderItem(e,this.list),this.addCopyItem(e),this.addPasteItem(e),this.addRenameItem(e,this.list),this.addDeleteItem(e,this.list),this.addExportItem(e)},e}(hteditor.Explorer),n=function(C){function e(l){return R(this,e),$(this,C.call(this,l,"symbols"))}return Y(e,C),e.prototype.initTreeMenu=function(C,e){this.addLocateTreeFileItem(e),this.addNewFolderItem(e,this.tree),this.addRenameItem(e,this.tree),this.addDeleteItem(e,this.tree)},e.prototype.initListMenu=function(C,e){this.addLocateListFileItem(e),this.addNewFolderItem(e,this.list),this.addCopyItem(e),this.addPasteItem(e),this.addRenameItem(e,this.list),this.addDeleteItem(e,this.list),this.addExportItem(e)},e}(hteditor.Explorer),E=function(C){function e(l){return R(this,e),$(this,C.call(this,l,"assets"))}return Y(e,C),e.prototype.initTreeMenu=function(C,e){this.addLocateTreeFileItem(e),this.addNewFolderItem(e,this.tree),this.addRenameItem(e,this.tree),this.addDeleteItem(e,this.tree)},e.prototype.initListMenu=function(C,e){this.addLocateListFileItem(e),this.addNewFolderItem(e,this.list),this.addCopyItem(e),this.addPasteItem(e),this.addRenameItem(e,this.list),this.addDeleteItem(e,this.list)},e}(hteditor.Explorer),U=hteditor.getString,x=function(C){function e(l){R(this,e);var d=$(this,C.call(this));d.editor=l,d.editor.menus.push(d);var N=[{label:U("editor.newsceneview"),action:function(){d.editor.newScene()}},{label:U("editor.newmodel"),items:[{label:U("editor.obj"),action:function(){d.editor.newOBJModel()}}]}];return d.setItems(N),d}return Y(e,C),e}(ht.widget.ContextMenu),H=function(C){function e(l){R(this,e);var d=$(this,C.call(this,l.gv));return d.editor=l,d}return Y(e,C),e.prototype.beginTransaction=function(){this._isBeginTransaction||(this._isBeginTransaction=!0,this.dm.beginTransaction())},e.prototype.endTransaction=function(){this._isBeginTransaction&&(this._isBeginTransaction=!1,this.dm.endTransaction())},e.prototype.getDataAt=function(C){return this.gv.getDataAt(C)},e.prototype.getNodeAt=function(C){var e=this.getDataAt(C);return e instanceof ht.Node?e:null},e.prototype.setUp=function(){C.prototype.setUp.call(this),this.sm.cs()},e.prototype.$0$=function(C){},e.prototype.drawRect=function(C,e,l,d){e=this.toRect(e),d&&(C.fillStyle=d),l&&(C.strokeStyle=l),C.lineWidth=1,C.beginPath(),C.rect(e.x,e.y,e.width,e.height),C.stroke(),d&&C.fill(),l&&C.stroke()},e.prototype.drawPoint=function(C,e,l,d,N){e=this.toPoint(e),N&&(C.fillStyle=N),d&&(C.strokeStyle=d),C.lineWidth=1,C.beginPath(),C.arc(e.x,e.y,l,0,2*Math.PI,!0),N&&C.fill(),d&&C.stroke()},e.prototype.drawPoints=function(C,e,l,d,N){for(var T=0;T<e.length;T++)this.drawPoint(C,e[T],l,d,N)},e.prototype.drawLine=function(C,e,l,d){e=this.toPoint(e),l=this.toPoint(l),C.lineWidth=1,C.strokeStyle=d,C.beginPath(),C.moveTo(e.x,e.y),C.lineTo(l.x,l.y),C.stroke()},e.prototype.toRect=function(C){var e=this.zoom;return{x:C.x*e+this.tx,y:C.y*e+this.ty,width:C.width*e,height:C.height*e}},e.prototype.toPoint=function(C){return{x:C.x*this.zoom+this.tx,y:C.y*this.zoom+this.ty}},e.prototype.addData=function(C){this.editor.dm.add(C),this.editor.sm.ss(C),this.editor.gv.setFocus()},e.prototype.remove=function(C){this.dm.remove(C)},e.prototype.lp=function(C){return this.gv.lp(C)},m(e,[{key:"dm",get:function(){return this.gv.dm()}},{key:"sm",get:function(){return this.gv.dm().sm()}},{key:"zoom",get:function(){return this.gv.getZoom()}},{key:"tx",get:function(){return this.gv.tx()}},{key:"ty",get:function(){return this.gv.ty()}}]),e}(ht.graph.Interactor),P=function(C){function e(l,d,N){R(this,e);var T=$(this,C.call(this,l));return T.createFunc=d,T.points=[],T.segments=[],T.nextPoint=null,T.fill=N,T}return Y(e,C),e.prototype.tearDown=function(){C.prototype.tearDown.call(this),this.points=[],this.segments=[],this.nextPoint=null},e.prototype.$48$=function(C){this.nextPoint?(this.nextPoint=null,this.editor.rulerView.validateCanvas()):this.createShape()},e.prototype.createShape=function(){if(this.points.length>1){var C=this.createFunc(this.points,this.segments);this.addData(C)}this.editor.resetInteractionState(),this.editor.pointsEditingMode=!0},e.prototype.handle_mousedown=function(C){this.handle_touchstart(C)},e.prototype.handle_touchstart=function(C){if(ht.Default.preventDefault(C),ht.Default.isLeftButton(C))if(this.gv.setFocus(C),ht.Default.isDoubleClick(C))this.createShape();else{var e=this.lp(C);if(this.points.length){var l=this.points[this.points.length-1];if(Math.abs(l.x-e.x)<.01&&Math.abs(l.y-e.y)<.01)return}this.points.push(e),this.segments.push(this.nextPoint?2:1),this.nextPoint=this.lp(C),this.editor.rulerView.validateCanvas()}},e.prototype.handle_mousemove=function(C){this.nextPoint&&(this.nextPoint=this.lp(C),this.editor.rulerView.validateCanvas())},e.prototype.$0$=function(C){C.beginPath();for(var e=0,l=void 0,d=void 0,N=void 0,T=0;T<this.segments.length;T++){var M=this.segments[T];1===M?(l=this.toPoint(this.points[e++]),C.moveTo(l.x,l.y)):2===M?(l=this.toPoint(this.points[e++]),C.lineTo(l.x,l.y)):3===M?(l=this.toPoint(this.points[e++]),d=this.toPoint(this.points[e++]),C.quadraticCurveTo(l.x,l.y,d.x,d.y)):4===M?(l=this.toPoint(this.points[e++]),d=this.toPoint(this.points[e++]),N=this.toPoint(this.points[e++]),C.bezierCurveTo(l.x,po,y,d.x,d.y,N.x,N.y)):5===M&&C.closePath()}if(this.nextPoint){var _=this.toPoint(this.nextPoint);C.lineTo(_.x,_.y)}C.strokeStyle=hteditor.config.color_data_border,C.lineWidth=1,C.stroke(),this.fill&&(C.fillStyle=hteditor.config.color_transparent,C.fill()),this.drawPoints(C,this.points,4,hteditor.config.color_data_border,hteditor.config.color_data_background)},e}(H),c=function(C){function e(l,d){R(this,e);var N=$(this,C.call(this,l));return N.createFunc=d,N}return Y(e,C),e.prototype.tearDown=function(){C.prototype.tearDown.call(this),this.node=this.p1=this.p2=null},e.prototype.handle_mousedown=function(C){this.handle_touchstart(C)},e.prototype.handle_touchstart=function(C){ht.Default.preventDefault(C),ht.Default.isLeftButton(C)&&(this.gv.setFocus(C),this.p1=this.lp(C),this.startDragging(C))},e.prototype.handleWindowMouseMove=function(C){this.handleWindowTouchMove(C)},e.prototype.handleWindowMouseUp=function(C){this.handleWindowTouchEnd(C)},e.prototype.handleWindowTouchMove=function(C){if(ht.Default.preventDefault(C),this.p1){this.p2=this.lp(C);var e=ht.Default.unionPoint(this.p1,this.p2);if(this.node)this.node.setRect(e);else{if(!e.width||!e.height)return;this.beginTransaction(),this.createNode(e,!1)}}},e.prototype.handleWindowTouchEnd=function(C){ht.Default.preventDefault(C),this.endTransaction(),!this.node&&this.p1&&this.createNode({x:this.p1.x-25,y:this.p1.y-25,width:50,height:50},!0),hteditor.config.continuousCreating?this.node=this.p1=this.p2=null:this.editor.resetInteractionState()},e.prototype.createNode=function(C,e){this.node=this.createFunc(C,e),this.node.s3(50,50,50),e?this.node.setPosition(C.x+C.width/2,C.y+C.height/2):this.node.setRect(C),this.addData(this.node)},e.prototype.$0$=function(C){this.node&&this.drawRect(C,this.node.getRect(),hteditor.config.color_data_border)},e}(H),f=hteditor.getString,k=function(C){function e(l){R(this,e);var d=$(this,C.call(this));return d.editor=l,d.initMenu(),d.$68$(),d.enableToolTip(),d}return Y(e,C),e.prototype.initMenu=function(){var C=this.editor.mainMenu=new x(this.editor),e=function(e){C.isShowing()&&!C.getView().contains(e.target)&&C.hide()};window.addEventListener("touchstart",e,!1),window.addEventListener("mousedown",e,!1)},e.prototype.$68$=function(){var C=[];C.push(this.$67$()),C.push(this.createEditItem()),C.push(this.createCubeItem()),C.push(this.createCylinderItem()),C.push(this.createSphereItem()),C.push(this.createWallItem()),C.push(this.createDoorWindowItem()),C.push(this.createFloorItem()),C.push(this.createPipelineItem()),this.setItems(C)},e.prototype.$67$=function(){var C=this,e=hteditor.createItem("menu",f("editor.menu"),"editor.menu");return e.action=function(e,l,d){C.editor.mainMenu.isShowing()||(C.editor.mainMenu.showOnView(C,4,20),d.preventDefault(),d.stopPropagation())},e},e.prototype.createEditItem=function(){return this.editor.createSceneItem("edit",f("editor.edit"),"editor.edit")},e.prototype.createWallItem=function(){var C=Q.config.color_data_background,e=Q.config.color_transparent;return this.editor.createSceneItem("wall",f("editor.wall"),"editor.wall",new P(this.editor,function(l,d){var N=new ht.Shape;return N.setTall(280),N.setThickness(14),N.setElevation(N.getTall()/2),N.setPoints(l),N.setSegments(d),N.s({"all.color":C,"shape.background":null,"shape.border.width":N.getThickness(),"shape.border.color":e}),N}))},e.prototype.createDoorWindowItem=function(){return this.editor.createSceneItem("doorWindow",f("editor.doorWindow"),"editor.doorWindow",new c(this.editor,function(){var C=new ht.DoorWindow;return C.s({"all.color":Q.config.color_data_background}),C},!0))},e.prototype.createFloorItem=function(){var C=Q.config.color_data_background,e=Q.config.color_transparent;return this.editor.createSceneItem("floor",f("editor.floor"),"editor.floor",new P(this.editor,function(l,d){var N=new ht.Shape;return N.setTall(10),N.setThickness(-1),N.setElevation(-N.getTall()/2),N.setPoints(l),N.setSegments(d),N.s({"shape3d.color":C,"shape3d.top.color":C,"shape3d.bottom.color":C,"shape.background":e}),N.setAnchor3d(.5,0,.5),N},!0))},e.prototype.createPipelineItem=function(){var C=Q.config.color_data_background,e=Q.config.color_transparent;return this.editor.createSceneItem("pipeline",f("editor.pipeline"),"editor.pipeline",new P(this.editor,function(l,d){var N=new ht.Polyline;return N.setPoints(l),N.setSegments(d),N.setThickness(10),N.s({shape3d:"cylinder","shape3d.color":C,"shape3d.top.color":C,"shape3d.bottom.color":C,"shape.background":null,"shape.border.width":N.getThickness(),"shape.border.color":e}),N}))},e.prototype.createCubeItem=function(){return this.editor.createSceneItem("cube",f("editor.cube"),"editor.cube",new c(this.editor,function(){var C=new ht.Node;return C.s({"all.color":Q.config.color_data_background}),C.setAnchor3d(.5,0,.5),C},!0))},e.prototype.createCylinderItem=function(){return this.editor.createSceneItem("cylinder",f("editor.cylinder"),"editor.cylinder",new c(this.editor,function(){var C=new ht.Node;return C.s({shape3d:"cylinder","shape3d.color":Q.config.color_data_background}),C.setAnchor3d(.5,0,.5),C},!0))},e.prototype.createSphereItem=function(){return this.editor.createSceneItem("sphere",f("editor.sphere"),"editor.sphere",new c(this.editor,function(){var C=new ht.Node;return C.s({shape3d:"sphere","shape3d.color":Q.config.color_data_background}),C.setAnchor3d(.5,0,.5),C},!0))},e}(ht.widget.Toolbar),p=hteditor.getString,o=hteditor.createItem,j=function(C){function e(l){R(this,e);var d=$(this,C.call(this));return d.editor=l,d.$68$(),d.enableToolTip(),d.setStickToRight(!0),d.editor.gv.addPropertyChangeListener(d.handlePropertyChange,d),d.$69$(),d}return Y(e,C),e.prototype.handlePropertyChange=function(C){"zoom"===C.property&&this.$69$()},e.prototype.$69$=function(){this.label.innerHTML=parseInt(100*this.editor.gv.getZoom())+"%"},e.prototype.$68$=function(){var C=this,e=void 0,l=[];e=o("save",p("editor.save"),"editor.save"),e.action=function(){C.editor.save()},l.push(e),e=o("reload",p("editor.reload"),"editor.reload"),e.action=function(){C.editor.reload()},l.push(e),l.push({separator:!0}),e=o("rulers",p("editor.showrulers"),"editor.rulers",function(){return C.editor.isRulerEnabled()}),e.action=function(){C.editor.toggleRulerEnabled()},l.push(e),e=o("grid",p("editor.showaxis"),"editor.axis",function(){return!C.editor.dm.a("sceneEditHelperDisabled")}),e.action=function(){C.editor.dm.a("sceneEditHelperDisabled",!C.editor.dm.a("sceneEditHelperDisabled"))},l.push(e),e=o("grid",p("editor.showgrid"),"editor.grid",function(){return C.editor.dm.a("sceneGridEnabled")}),e.action=function(){C.editor.dm.a("sceneGridEnabled",!C.editor.dm.a("sceneGridEnabled"))},l.push(e),e=o("preview",p("editor.preview"),"editor.preview"),e.action=function(){C.editor.preview()},l.push(e),l.push({separator:!0}),l.push(this.createZoomItem()),e=o("zoomToFit",p("editor.zoomtofit"),"editor.zoomtofit"),e.action=function(){C.editor.zoomToFit()},l.push(e),l.push({separator:!0}),e=o("toggleLeft",p("editor.toggleleft"),"editor.toggleleft"),e.action=function(){C.editor.toggleLeft()},l.push(e),e=o("toggleRight",p("editor.toggleright"),"editor.toggleright"),e.action=function(){C.editor.toggleRight()},l.push(e),this.setItems(l)},e.prototype.createZoomItem=function(){var C=this,e=this.label=ht.Default.createDiv(!0);e.style.font=this.getLabelFont(),e.style.color=this.getLabelColor(),e.style.cursor="ew-resize",e.style.width="40px",e.style.height=ht.Default.widgetRowHeight+"px",e.style.lineHeight=ht.Default.widgetRowHeight+"px",e.style.whiteSpace="nowrap",e.style.textAlign="center";var l=function(e){e.preventDefault();var l=C.editor.gv;ht.Default.isDoubleClick(e)&&l.zoomReset();var d=l.getZoom(),N=ht.Default.getClientPoint(e).x,T=function(C){C.preventDefault();var e=ht.Default.getClientPoint(C).x-N;l.setZoom(d*(1+.005*e))};window.addEventListener("mousemove",T,!1),window.addEventListener("touchmove",T,!1);var M=function(C){C.preventDefault(),window.removeEventListener("mousemove",T,!1),window.removeEventListener("touchmove",T,!1),window.removeEventListener("mouseup",M,!1),window.removeEventListener("touchend",M,!1)};window.addEventListener("mouseup",M,!1),window.addEventListener("touchend",M,!1)};return e.addEventListener("mousedown",l,!1),e.addEventListener("touchstart",l,!1),{id:"zoom",unfocusable:!0,element:e}},e}(ht.widget.Toolbar),V=function(C){function e(l){R(this,e);var d=$(this,C.call(this,l.dm));return d.editor=l,d.setEditable(!0),d.topDiv=ht.Default.createDiv(),d.getPostProcessing().setSerializable(!1),d}return Y(e,C),e.prototype.isInteractive=function(){return!1},e.prototype.handleDelete=function(){this.removeSelection()},e.prototype.getBrightness=function(C){return C.s("brightness")},e.prototype.isDroppable=function(C,e){return e.view===this.editor.models.list||(e.view===this.editor.symbols.list||e.view===this.editor.assets.list)},e.prototype.$58$=function(C){if(this.dragImage){var e=hteditor.config.dragImageSize,l=ht.Default.getPagePoint(C);this.dragImage.style.left=l.x-e/2+"px",this.dragImage.style.top=l.y-e/2+"px"}},e.prototype.removeDragImage=function(){this.dragImage&&(ht.Default.removeHTML(this.dragImage),this.dragImage=null)},e.prototype.handleCrossDrag=function(C,e,l){var d=this,N=l.view,T=N.draggingData;if("enter"===e){if(this._view.insertBefore(this.topDiv,this._scrollBarDiv),ht.Default.layout(this.topDiv,0,0,this.getWidth(),this.getHeight()),this.topDiv.style.border="solid "+hteditor.config.color_select_dark+" 2px",!this.dragImage&&T&&("model"===T.fileType||"symbol"===T.fileType||"image"===T.fileType)&&ht.Default.getImage(T.getImage())!==ht.Default.getImage("editor.unknown")){var M=hteditor.config.dragImageSize;this.dragImage=ht.Default.toCanvas(T.getImage(),M,M,"centerUniform",T,l.view,null,ht.Default.devicePixelRatio),this.$58$(C),this.dragImage.style.opacity=hteditor.config.dragImageOpacity,ht.Default.appendToScreen(this.dragImage)}}else if("exit"===e||"cancel"===e)ht.Default.removeHTML(this.topDiv),this.removeDragImage();else if("over"===e)this.$58$(C);else if("drop"===e&&(ht.Default.removeHTML(this.topDiv),T)){this.removeDragImage();var _=this.getHitPosition(C);N.isSelected(T)?N.sm().toSelection().each(function(e){N.handleDropToEditView?N.handleDropToEditView(d,e,_,C):d.$98$(e,_)}):N.handleDropToEditView?N.handleDropToEditView(this,T,_,C):this.$98$(T,_)}},e.prototype.$98$=function(C,e){if(C){var l=C.getFileUUID(),d=C.fileType;if("model"===d||"symbol"===d||M(l)){var N=new ht.Node;"model"===d?N.s({shape3d:l}):("symbol"===d||M(l))&&(N.s({shape3d:"billboard","shape3d.image":l,"texture.cache":!1,autorotate:!0,fixSizeOnScreen:[-1,-1]}),N.setImage(l)),N.setAnchor3d(.5,0,.5),N.p3(e),N.s("wf.visible","selected"),this.dm().add(N),this.sm().ss(N)}}},e.prototype.toImage=function(C){var e=Q.config.imageSize||400,l=this.getWidth(),d=this.getHeight(),N=Math.max(l,d),T=e/N;return l=Math.floor(l*T),d=Math.floor(d*T),this.toCanvas(C,l,d).toDataURL("image/png",1)},e.prototype.invalidateAll=function(e,l){if("imageLoaded"===l||"modelLoaded"===l){var d=this.editor.inspector;d&&("modelLoaded"===l?d.filterPropertiesLater():d.$34$(),d.$85$&&d.$85$())}C.prototype.invalidateAll.call(this,e,l)},e}(ht.graph3d.Graph3dView),L={width:!0,height:!0,position:!0,rotation:!0,anchor:!0,scale:!0,expanded:!0},v=function(){function C(e,l){var d=this;R(this,C),this.editor=e,this.gv=this.graphView=l,this._rulerEnabled=!0,this._view=ht.Default.createView(!0,this),this.graphView.addViewListener(function(C){"validate"===C.kind&&d.validateCanvas()}),this._hRuler=ht.Default.createCanvas(),this._vRuler=ht.Default.createCanvas(),this._view.appendChild(this._hRuler),this._view.appendChild(this._vRuler),this._view.appendChild(this.graphView.getView()),this.graphView.addPropertyChangeListener(function(){d.iv()}),this.dm.sm().addSelectionChangeListener(function(C){d.iv()}),this.dm.addDataModelChangeListener(function(C){d.iv()}),this.dm.addDataPropertyChangeListener(function(C){d.handleDataPropertyChanged(C)}),this.dm.addPropertyChangeListener(function(C){d.handleDataModelPropertyChanged(C)}),this.dm.addHierarchyChangeListener(function(C){d.iv()}),this.dm.layout=function(C){d._autoLayout||(d._autoLayout=new ht.layout.AutoLayout(d.graphView)),d._autoLayout.layout(C,function(){d.graphView.fitContent(!0)})},this.graphView.setEditable(!0),this.graphView.getInteractors().each(function(C){C.keep=!0}),l.getEditInteractor().alignmentGuideEnabled=!0,
hteditor.EditView.prototype.initRuler.call(this)}return C.prototype.handleDataPropertyChanged=function(C){L[C.property]&&this.iv()},C.prototype.handleDataModelPropertyChanged=function(){hteditor.EditView.prototype.redraw.apply(this,arguments)},C.prototype.onPropertyChanged=function(C){this.iv()},C.prototype.addData=function(C){this.dm.add(C),this.dm.sm().ss(C),this.graphView.setFocus()},C.prototype.validateCanvas=function(){var C=this.graphView._topCanvas;if(C){var e=hteditor.initContext(C);e.clearRect(0,0,C.clientWidth,C.clientHeight),this.graphView.getInteractors().each(function(C){C.$0$&&C.$0$(e)}),e.restore()}},C.prototype.redraw=function(){hteditor.EditView.prototype.redraw.apply(this,arguments)},C.prototype.validateImpl=function(){hteditor.EditView.prototype.validateImpl.apply(this,arguments)},C.prototype.drawVerticalText=function(){hteditor.EditView.prototype.drawVerticalText.apply(this,arguments)},C.prototype.drawRuler=function(){hteditor.EditView.prototype.drawRuler.apply(this,arguments)},C.prototype.updateAlignGuide=function(){hteditor.EditView.prototype.updateAlignGuide.apply(this,arguments)},C.prototype.getGridGuide=function(){return hteditor.EditView.prototype.getGridGuide.apply(this,arguments)},C.prototype.setRulerEnabled=function(C){this.dm.a("rulerEnabled",C)},C.prototype.isRulerEnabled=function(){return this.dm.a("rulerEnabled")},m(C,[{key:"dm",get:function(){return this.graphView.dm()}}]),C}();hteditor.msClass(v,{ms_v:1,ms_fire:1,ms_ac:["rulerBackground","rulerFont","rulerColor","rulerSize","guideColor"],_rulerFont:hteditor.config.smallFont,_rulerBackground:hteditor.config.color_pane,_rulerColor:hteditor.config.color_dark,_rulerSize:hteditor.config.rulerSize,_guideColor:hteditor.config.color_transparent,_interactionState:void 0});var r=Q.getString,u=function(C){function e(l){R(this,e);var d=$(this,C.call(this,l.dm));return d.editor=l,d._topCanvas=ht.Default.createCanvas(),d._topDiv=ht.Default.createDiv(),d._view.insertBefore(d._topCanvas,d._scrollBarDiv),d._view.insertBefore(d._topDiv,d._scrollBarDiv),d.initMenu(),d.mi(function(C){"prepareMove"!==C.kind&&"prepareEdit"!==C.kind||!C.event.altKey||(d.editor.copy(),d.editor.paste(),d.validate())}),d.editable=!0,d}return Y(e,C),e.prototype.isInteractive=function(){return!1},e.prototype.initMenu=function(){var C=this,e=[];this.menu=new ht.widget.ContextMenu(e),e.push({id:"copy",label:r("editor.copy"),action:function(){C.editor.copy()},visible:function(){return!!C.editor.ld}}),e.push({id:"paste",label:r("editor.paste"),action:function(){C.editor.paste()},visible:function(){return C.editable&&C.editor.hasCopyInfo()}});var l=function(){return C.sm().size()>0},d=function(){for(var e=0;e<C.sm().size();e++){var l=C.sm().getSelection().get(e);if(l instanceof ht.Block&&!(l instanceof ht.RefGraph))return!0}return!1};e.push({separator:!0,visible:function(){return C.editable&&(l()||d())}}),e.push({id:"block",label:r("editor.block"),action:function(){C.editor.block()},visible:function(){return C.editable&&l()}}),e.push({id:"unblock",label:r("editor.unblock"),action:function(){C.editor.unblock()},visible:function(){return C.editable&&d()}}),this.menu.addTo(this.getView()),this.editor.menus.push(this.menu)},e.prototype.getUnionNodeRect=function(C){var e=this,l=void 0;return C=C._as||C,C.forEach(function(C){C instanceof ht.Node&&(l=ht.Default.unionRect(l,e.getNodeRect(C)))}),l},e.prototype.getImage=function(C){var e=C.s("shape3d");if(e){var l=ht.Default.getShape3dModel(e);if(l&&l.json&&l.json.image)return l.json.image;if("sphere"===e||"cylinder"===e)return"editor.sphere.image"}var d=C.getImage();return d&&"node_image"!==d?d:C.s("shape3d.image")?C.s("shape3d.image"):"editor.cube.image"},e.prototype.getSelectWidth=function(C){return!this.isEditable(C)||C instanceof ht.Edge?C.s("select.width"):0},e.prototype.isDroppable=function(C,e){return e.view===this.editor.models.list||(e.view===this.editor.symbols.list||e.view===this.editor.assets.list)},e.prototype.$58$=function(C){if(this.dragImage){var e=hteditor.config.dragImageSize,l=ht.Default.getPagePoint(C);this.dragImage.style.left=l.x-e/2+"px",this.dragImage.style.top=l.y-e/2+"px"}},e.prototype.removeDragImage=function(){this.dragImage&&(ht.Default.removeHTML(this.dragImage),this.dragImage=null)},e.prototype.handleCrossDrag=function(C,e,l){var d=this,N=l.view,T=N.draggingData;if("enter"===e){if(this._topDiv.style.border="solid "+hteditor.config.color_select_dark+" 2px",!this.dragImage&&T&&("model"===T.fileType||"symbol"===T.fileType||"image"===T.fileType)&&ht.Default.getImage(T.getImage())!==ht.Default.getImage("editor.unknown")){var M=hteditor.config.dragImageSize;this.dragImage=ht.Default.toCanvas(T.getImage(),M,M,"centerUniform",T,l.view,null,ht.Default.devicePixelRatio),this.$58$(C),this.dragImage.style.opacity=hteditor.config.dragImageOpacity,ht.Default.appendToScreen(this.dragImage)}}else"exit"===e||"cancel"===e?(this._topDiv.style.border="",this.removeDragImage()):"over"===e?this.$58$(C):"drop"===e&&(this._topDiv.style.border="",T&&(this.removeDragImage(),this.sm().cs(),N.handleDropToEditView?N.handleDropToEditView(this,T,this.lp(C),C):N.isSelected(T)?N.sm().toSelection().each(function(e){d.$98$(e,C)}):this.$98$(T,C)))},e.prototype.$98$=function(C,e){var l=C.getFileUUID(),d=this.lp(e);if("model"===C.fileType){var N=new ht.Node;N.s({shape3d:l}),N.setAnchor3d(.5,0,.5),N.setPosition(d),this.dm().add(N),this.sm().ss(N)}else if("symbol"===C.fileType||"image"===C.fileType){var T=new ht.Node;T.s({shape3d:"billboard","shape3d.image":l,"texture.cache":!1,autorotate:!0,fixSizeOnScreen:[-1,-1]}),T.setAnchor3d(.5,0,.5),T.p(d),T.setImage(l),this.dm().add(T),this.sm().ss(T)}},e}(ht.graph.GraphView),i=function(C){function e(l){return R(this,e),$(this,C.call(this,l))}return Y(e,C),e.prototype.commit=function(){this.editor.reset(!0),this.editor.dm.disableHistoryManager(),this.editor.deserialize(this.content),this.editing=!1,this.editor.dm.enableHistoryManager(),this.editor.dm.clearHistoryManager()},e.prototype.updateContent=function(){this.visible&&!this.editing&&(this._updateContentLater=!1,this.content=this.editor.serialize())},e.prototype.updateUrl=function(){this.v("url",this.editor.url||"")},e.prototype.$5$=function(){},e}(hteditor.DataView),O=hteditor.getString,s=function(C){function e(l){R(this,e);var d=$(this,C.call(this));d.editor=l,d.buttons={};var N=[];N.push(d.createItem("cluster",O("editor.align.cluster"),[{type:"shape",points:[5,2,11,2,5,14,11,14],segments:[1,2,1,2],borderWidth:3,borderColor:hteditor.config.color_select},{type:"shape",points:[8,5,8,11,5,8,11,8],segments:[1,2,1,2],borderWidth:1,borderColor:hteditor.config.color_dark}])),N.push(d.createItem("distributeHorizontal",O("editor.align.distributehorizontal"),[{type:"shape",points:[2,2,2,14,14,2,14,14],segments:[1,2,1,2],borderWidth:1},{type:"shape",points:[8,5,8,11],borderWidth:3}])),N.push(d.createItem("distributeVertical",O("editor.align.distributevertical"),[{type:"shape",points:[2,2,14,2,2,14,14,14],segments:[1,2,1,2],borderWidth:1},{type:"shape",points:[5,8,11,8],borderWidth:3}])),N.push(d.createItem("alignLeft",O("editor.align.alignleft"),[{type:"shape",points:[2,2,2,14],segments:[1,2],borderWidth:1},{type:"shape",points:[5,5,13,5,5,11,8,11],segments:[1,2,1,2],borderWidth:3}])),N.push(d.createItem("alignHorizontal",O("editor.align.alignhorizontal"),[{type:"shape",points:[8,2,8,14],segments:[1,2],borderWidth:1},{type:"shape",points:[3,5,13,5,6,11,10,11],segments:[1,2,1,2],borderWidth:3}])),N.push(d.createItem("alignRight",O("editor.align.alignright"),[{type:"shape",points:[14,2,14,14],segments:[1,2],borderWidth:1},{type:"shape",points:[3,5,11,5,11,11,8,11],segments:[1,2,1,2],borderWidth:3}])),N.push(d.createItem("alignTop",O("editor.align.aligntop"),[{type:"shape",points:[2,2,14,2],segments:[1,2],borderWidth:1},{type:"shape",points:[5,5,5,13,11,5,11,8],segments:[1,2,1,2],borderWidth:3}])),N.push(d.createItem("alignVertical",O("editor.align.alignvertical"),[{type:"shape",points:[2,8,14,8],segments:[1,2],borderWidth:1},{type:"shape",points:[5,3,5,13,11,6,11,10],segments:[1,2,1,2],borderWidth:3}])),N.push(d.createItem("alignBottom",O("editor.align.alignbottom"),[{type:"shape",points:[2,14,14,14],segments:[1,2],borderWidth:1},{type:"shape",points:[5,3,5,11,11,11,11,8],segments:[1,2,1,2],borderWidth:3}]));var T=.1,M=[T,T,T,T,T,T,T,T,T];return d.addRow(N,M),d.updateItems(),d.editor.sm.ms(function(){return d.updateItems()}),d}return Y(e,C),e.prototype.createItem=function(C,e,l){var d=this;l.forEach(function(C){C.borderCap="round"}),l[0].borderColor=l[0].borderColor||hteditor.config.color_dark,l[1].borderColor=l[1].borderColor||hteditor.config.color_select;var N={width:16,height:16,fitSize:!0,comps:l};return this.buttons[C]=hteditor.createButton(null,e,N,function(){d[C]()})},e.prototype.updateItems=function(){var C=[];this.editor.sm.each(function(e){e instanceof ht.Node&&C.push(e)}),C.length>2?(this.buttons.cluster.setDisabled(!1),this.buttons.distributeHorizontal.setDisabled(!1),this.buttons.distributeVertical.setDisabled(!1),this.buttons.alignLeft.setDisabled(!1),this.buttons.alignHorizontal.setDisabled(!1),this.buttons.alignRight.setDisabled(!1),this.buttons.alignTop.setDisabled(!1),this.buttons.alignVertical.setDisabled(!1),this.buttons.alignBottom.setDisabled(!1)):C.length>1?(this.buttons.distributeHorizontal.setDisabled(!0),this.buttons.distributeVertical.setDisabled(!0),this.buttons.alignLeft.setDisabled(!1),this.buttons.alignHorizontal.setDisabled(!1),this.buttons.alignRight.setDisabled(!1),this.buttons.alignTop.setDisabled(!1),this.buttons.alignVertical.setDisabled(!1),this.buttons.alignBottom.setDisabled(!1)):(this.buttons.cluster.setDisabled(!0),this.buttons.distributeHorizontal.setDisabled(!0),this.buttons.distributeVertical.setDisabled(!0),this.buttons.alignLeft.setDisabled(!0),this.buttons.alignHorizontal.setDisabled(!0),this.buttons.alignRight.setDisabled(!0),this.buttons.alignTop.setDisabled(!0),this.buttons.alignVertical.setDisabled(!0),this.buttons.alignBottom.setDisabled(!0))},e.prototype.getUnionRect=function(C){return this.editor.gv?this.editor.gv.getUnionNodeRect(C):null},e.prototype.isSelected=function(C){return this.editor.sm.contains(C)},e.prototype.hasSelectedGroupParent=function(C){return hteditor.InspectorTool.prototype.hasSelectedGroupParent.apply(this,arguments)},e.prototype.hasSelectedHost=function(C){return hteditor.InspectorTool.prototype.hasSelectedHost.apply(this,arguments)},e.prototype.cluster=function(){var C=this.selection;if(C.length){this.editor.beginTransaction(),this.alignHorizontal(),this.alignVertical();var e=void 0,l=void 0;C.forEach(function(C){void 0===e?e=l=C.getElevation():(e>C.getElevation()&&(e=C.getElevation()),l<C.getElevation()&&(l=C.getElevation()))}),C.sort(function(C,e){return C.getElevation()-e.getElevation()});for(var d=(l-e)/(C.length-1),N=1;N<C.length-1;N++)C[N].setElevation(e+N*d);this.editor.endTransaction()}},e.prototype.distributeHorizontal=function(){hteditor.InspectorTool.prototype.distributeHorizontal.apply(this,arguments)},e.prototype.distributeVertical=function(){hteditor.InspectorTool.prototype.distributeVertical.apply(this,arguments)},e.prototype.alignLeft=function(){hteditor.InspectorTool.prototype.alignLeft.apply(this,arguments)},e.prototype.alignHorizontal=function(){hteditor.InspectorTool.prototype.alignHorizontal.apply(this,arguments)},e.prototype.alignRight=function(){hteditor.InspectorTool.prototype.alignRight.apply(this,arguments)},e.prototype.alignTop=function(){hteditor.InspectorTool.prototype.alignTop.apply(this,arguments)},e.prototype.alignVertical=function(){hteditor.InspectorTool.prototype.alignVertical.apply(this,arguments)},e.prototype.alignBottom=function(){hteditor.InspectorTool.prototype.alignBottom.apply(this,arguments)},m(e,[{key:"selection",get:function(){var C=this,e=[];return this.editor.sm.each(function(l){l instanceof ht.Node&&(C.hasSelectedGroupParent(l.getParent())||C.hasSelectedHost(l)||e.push(l))}),e}}]),e}(ht.widget.FormPane),I=function(C){function e(l,d,N){var T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];R(this,e);var M=$(this,C.call(this,l,d,N,T));return M.setHPadding(8),M.setVPadding(4),M.addUpdateHandler(function(){M.$85$()}),M._cacheImgObjects=[],M}return Y(e,C),e.prototype.initForm=function(){C.prototype.initForm.call(this),this.addCustomProperties()},e.prototype.addOneRow=function(C,e,l){for(var d=[this.indent,.1],N=2,T=C.length;N<T;N++)d.push(20);var M=this.addRow(C,d,e?this.getRowHeight()*e:null,l);return M.index=this.getRows().length-1,M},e.prototype.$85$=function(){var C=this;this._updateDataBindingsLater||(this._updateDataBindingsLater=!0,requestAnimationFrame(function(){C.initDataBindings()}))},e.prototype.initDataBindings=function(){var C=this;this._updateDataBindingsLater=!1;var e=this.data;if(e){for(var l=[e.s("all.image"),e.s("top.image"),e.s("bottom.image"),e.s("left.image"),e.s("right.image"),e.s("front.image"),e.s("back.image"),e.s("shape3d.image"),e.s("shape3d.top.image"),e.s("shape3d.bottom.image"),e.s("shape3d.from.image"),e.s("shape3d.to.image")],d=!1,N=[],T=0,M=l.length;T<M;T++){var K=l[T];if(K){if(!(K=ht.Default.getImage(K))){d=!0;break}N.push(K)}}if(d){var h=ht.Default.handleImageLoaded;return void(ht.Default.handleImageLoaded=function(){for(var e=arguments.length,l=Array(e),d=0;d<e;d++)l[d]=arguments[d];h.apply(ht.Default,l),ht.Default.handleImageLoaded=h,C.initDataBindings()})}if(0===N.length)return void(this.$44$&&this.$44$.length>0&&(this.clearDataBinding(),this.filterProperties()));var X=this._cacheImgObjects,J=X.length!==N.length;if(!J)for(var t=0,A=N.length;t<A;t++)if(X.indexOf(N[t])<0){J=!0;break}if(J){this.clearDataBinding(),this._cacheImgObjects=N;for(var z=[],q={},D={},R={},m=0,Y=N.length;m<Y;m++){var $=N[m];if($.comps){$.comps.forEach(function(C){if(_(C.type)){var e=ht.Default.getCompType(C.type);if(e)for(var l in e.properties)q[l]=e.properties[l].defaultValue}F(C,D,R)});for(var g in D)void 0===R[g]&&(R[g]=q[D[g]])}$.dataBindings&&z.push.apply(z,$.dataBindings)}if(z.length>0){var W=this.updateHandlers.length;this.$44$.push(this.addTitle("TitleDataBinding"));var w={};z.forEach(function(e){var l=e.attr;w[l]||(w[l]=1,Q.HTNodeInspector.prototype.$87$.call(C,e,void 0,R))}),this.dataBindingHandlers=this.updateHandlers.slice(W)}this.$46$=this._rows,this.filterProperties()}}},e.prototype.clearDataBinding=function(){var C=this;this._rows=this.$46$;var e=this.$44$;e&&e.length>0&&this.removeRows(e),this.$44$=[];var l=this.dataBindingHandlers;l&&l.length>0&&l.forEach(function(e){C.removeUpdateHandler(e)}),this.dataBindingHandlers=[],this._cacheImgObjects=[],this.$46$=this._rows},e.prototype.$87$=function(C,e){var l=[],d=C.attr,N=hteditor.config.valueTypes[C.valueType];if(!N)return this.editor.fireEvent("error",{message:"Wrong value type:"+C.valueType,dataBind:C}),!1;var T=hteditor.getString(C.name)||d,M=function(C){var l=C.a(d);return void 0===l&&(l=e[d]),l},_=function(C,e){return C.a(d,e)};return"int"===N.type||"number"===N.type?N.angle?this.addLabelRotation(l,T,M,_,N.min,N.max,N.step):this.addLabelRange(l,T,M,_,N.min,N.max,N.step,N.type):"color"===N.type?this.addLabelColor(l,T,M,_):"boolean"===N.type?this.addLabelCheckBox(l,T,M,_):"enum"===N.type?this.addLabelComboBox(l,T,M,_,N.values,N.labels,N.icons):"multiline"===N.type?this.addLabelMultiline(l,T,M,_):"font"===N.type?this.addLabelFont(l,T,M,_):"image"===N.type?this.addLabelImage(l,T,M,_):"url"===N.type?this.addLabelURL(l,T,M,_):"colorArray"===N.type?this.addLabelArray(l,T,M,_,"color"):"numberArray"===N.type?this.addLabelArray(l,T,M,_,"number"):"stringArray"===N.type?this.addLabelArray(l,T,M,_,"string"):"objectArray"===N.type?this.addLabelArray(l,T,M,_,"object"):"function"===N.type?this.addLabelFunction(l,T,M,_,d):"object"===N.type?this.addLabelObject(l,T,M,_,d):this.addLabelInput(l,T,M,_),l},e.prototype.addLabelData=function(C,e,l,d){var N=this,T=this.addLabelInput(C,e,function(C){var e=l(C);return e?e.toLabel()||e.getClassName():""}),M=T.getElement();T.isDroppable=function(C,e){return e.view.draggingData&&N.dataModel===e.view.draggingData.getDataModel()},T.handleCrossDrag=function(C,e,l){"enter"===e?M.style.border="solid "+Q.config.color_select_dark+" 2px":"exit"===e||"cancel"===e?M.style.border="":"over"===e||"drop"===e&&(M.style.border="",N.setValue(d,l.view.draggingData),T.setFocus())},M.onkeydown=function(C){ht.Default.isDelete(C)&&N.setValue(d,null)};var _=new ht.widget.Image;_.drawImage=function(C,e,l,d,T,M){var K=_.data,h=N.editor.list;K&&h&&h.dm().contains(K)&&(e=h.getIcon(K))&&drawStretchImage(C,ht.Default.getImage(e),"centerUniform",l,d,T,M,K,h)},this.updateHandlers.push(function(){if(!C.hidden){var e=_.data;_.data=N.getValue(l),_.fp("data",e,_.data)}}),C.push(_)},e.prototype.addImage=function(C,e,l,d,N){var T=this,M=new ht.widget.Image;M.vectorDataBindingDisabled=!0;var _=d||function(C){var e=ht.Default.getImage(C);return e&&e.snapshotURL?e.snapshotURL:C};this.updateHandlers.push(function(){if(!C.hidden){var l=T.getValue(e);M.rawIcon=l,M.setIcon(_(l))}});var K=M.getView();K.style.cursor="pointer";var h=function(C){C.preventDefault(),N&&!N(M)||(ht.Default.isDoubleClick(C)?T.editor.open(M.rawIcon):T.editor.selectFileNode(M.rawIcon))};return K.addEventListener("mousedown",h,!1),K.addEventListener("touchstart",h,!1),C.push(M),M},m(e,[{key:"type",set:function(C){this._type=C},get:function(){return this._type}},{key:"dataModel",get:function(){return this.editor.dm}}]),e}(hteditor.Inspector),Z=hteditor.getString,b=function(C){function e(l){return R(this,e),$(this,C.call(this,l,"scene","scene",!0))}return Y(e,C),e.prototype.initForm=function(){C.prototype.initForm.call(this),this.initSceneProperties(),this.addBloomProperties(),this.addDofProperties(),this.addHighlightProperties(),this.$77$(),this.editor.scene.shadowMap&&this.initShadowProperties()},e.prototype.initSceneProperties=function(){var C=this,e=void 0;this.addTitle("TitleScenes"),e=[],this.addLabelCheckBox(e,Z("editor.debugTip"),function(){return C.editor.scene.isDebugTipShowing()},function(e,l){var d=C.editor.scene;l?d.showDebugTip():d.hideDebugTip()}),this.addRow(e,[this.indent,.1]),e=[],this.addLabelInput(e,Z("editor.previewurl"),hteditor.getter("a","previewURL"),hteditor.setter("a","previewURL")),this.addRow(e,[this.indent,.1]),e=[],e.push(Z("editor.camera")),this.addButton(e,null,Z("editor.reset"),"editor.resetsize.state",function(){C.editor.scene.setEye(ht.Default.graph3dViewEye)}),this.addLabelInput(e,"X",function(e){return parseFloat(C.editor.scene.getEye()[0])},function(e,l){var d=C.editor.scene.getEye();C.editor.scene.setEye(l,d[1],d[2])},"int",1),this.addLabelInput(e,"Y",function(e){return parseFloat(C.editor.scene.getEye()[1])},function(e,l){var d=C.editor.scene.getEye();C.editor.scene.setEye(d[0],l,d[2])},"int",1),this.addLabelInput(e,"Z",function(e){return parseFloat(C.editor.scene.getEye()[2])},function(e,l){var d=C.editor.scene.getEye();C.editor.scene.setEye(d[0],d[1],l)},"int",1),this.addRow(e,[this.indent-40-8,20,20,.1,20,.1,20,.1]),e=[],e.push(Z("editor.center")),this.addButton(e,null,Z("editor.reset"),"editor.resetsize.state",function(){C.editor.scene.setCenter(ht.Default.graph3dViewCenter)}),this.addLabelInput(e,"X",function(e){return parseFloat(C.editor.scene.getCenter()[0])},function(e,l){var d=C.editor.scene.getCenter();C.editor.scene.setCenter(l,d[1],d[2])},"int",1),this.addLabelInput(e,"Y",function(e){return parseFloat(C.editor.scene.getCenter()[1])},function(e,l){var d=C.editor.scene.getCenter();C.editor.scene.setCenter(d[0],l,d[2])},"int",1),this.addLabelInput(e,"Z",function(e){return parseFloat(C.editor.scene.getCenter()[2])},function(e,l){var d=C.editor.scene.getCenter();C.editor.scene.setCenter(d[0],d[1],l)},"int",1),this.addRow(e,[this.indent-40-8,20,20,.1,20,.1,20,.1]),e=[],this.addLabelRange(e,Z("editor.near"),function(C){return C.a("sceneNear")},function(C,e){return C.a("sceneNear",e)},1,void 0,1,"int"),this.addLabelRange(e,Z("editor.far"),function(C){return C.a("sceneFar")},function(C,e){return C.a("sceneFar",e)},0,void 0,100,"int"),this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[],this.addLabelColor(e,Z("editor.backgroundcolor"),hteditor.getter("p","background"),hteditor.setter("p","background")),this.addRow(e,[this.indent,.1]),e=[],this.addLabelImage(e,Z("editor.envmapimage"),function(e){var l=e.getEnvmap(),d=C.editor.getFileNode(l);return d?d.url:l},function(C,e){return C.setEnvmap(e)}),this.addRow(e,[this.indent,.1,20]);this.editor.scene;e=[];var l=[["Obejct","json","editor.comment.json"],["ht.DataModel","dm","editor.comment.datamodel"],["ht.graph.Graph3dView","view","editor.comment.graph3dview"]];this.addLabelFunction(e,Z("editor.onpredeserialize"),function(C){return C.a("onPreDeserialize")},function(C,e){C.a("onPreDeserialize",e)},"onPreDeserialize",l),this.addOneRow(e),e=[],l=[["Obejct","json","editor.comment.json"],["ht.DataModel","dm","editor.comment.datamodel"],["ht.graph.Graph3dView","view","editor.comment.graph3dview"],["ht.List","datas","editor.comment.datas"]],this.addLabelFunction(e,Z("editor.onpostdeserialize"),function(C){return C.a("onPostDeserialize")},function(C,e){C.a("onPostDeserialize",e)},"onPostDeserialize",l),this.addOneRow(e),e=[],this.addLabelComboBox(e,Z("editor.orthographic"),function(C){return C.a("sceneOrthographic")},function(C,e){return C.a("sceneOrthographic",e)},[!1,"top","right","front"],[Z("editor.none"),Z("editor.viewtype.top"),Z("editor.viewtype.right"),Z("editor.viewtype.front")]),this.addOneRow(e)},e.prototype.addBloomProperties=function(){this.addTitle("TitleBloom");var C=[];this.addLabelCheckBox(C,Z("editor.bloom"),function(C){return C.a("sceneBloom")},function(C,e){return C.a("sceneBloom",e)}),this.addLabelRange(C,Z("editor.strength"),function(C){return C.a("sceneBloomStrength")},function(C,e){return C.a("sceneBloomStrength",e)},0,void 0,.01,"number"),this.addRow(C,[this.indent,.1,this.indent2,.1]),C=[],this.addLabelRange(C,Z("editor.radius"),function(C){return C.a("sceneBloomRadius")},function(C,e){return C.a("sceneBloomRadius",e)},0,void 0,.01,"number"),this.addLabelRange(C,Z("editor.threshold"),function(C){return C.a("sceneBloomThreshold")},function(C,e){return C.a("sceneBloomThreshold",e)},0,1,.01,"number"),this.addRow(C,[this.indent,.1,this.indent2,.1])},e.prototype.addDofProperties=function(){var C=this;this.addTitle("TitleDOF");var e=[];this.addLabelCheckBox(e,Z("editor.dof"),function(C){return C.a("sceneDof")},function(C,e){return C.a("sceneDof",e)}),this.addLabelRange(e,Z("editor.aperture"),function(C){return C.a("sceneDofAperture")},function(C,e){return C.a("sceneDofAperture",e)},0,1,.001,"number"),this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[],this.addLabelImage(e,Z("editor.image"),function(e){var l=e.a("sceneDofImage"),d=C.editor.getFileNode(l);return d?d.url:l},function(C,e){return C.a("sceneDofImage",e)}),this.addRow(e,[this.indent,.1,20])},e.prototype.addHighlightProperties=function(){this.addTitle("TitleHighlight");var C=[];this.addLabelRange(C,Z("editor.width"),function(C){return C.a("sceneHighlightWidth")},function(C,e){return C.a("sceneHighlightWidth",e)},0,void 0,.1,"number"),this.addLabelColor(C,Z("editor.color"),function(C){return C.a("sceneHighlightColor")},function(C,e){C.a("sceneHighlightColor",e)}),this.addRow(C,[this.indent,.1,this.indent2,.1]),C=[],this.addLabelComboBox(C,Z("editor.mode"),function(C){return C.a("sceneHighlightMode")},function(C,e){C.a("sceneHighlightMode",e)},["disabled","selected","hover","style"],[Z("editor.highlightmode.disabled"),Z("editor.highlightmode.selected"),Z("editor.highlightmode.hover"),Z("editor.highlightmode.style")]),this.addRow(C,[this.indent,.1])},e.prototype.$77$=function(){this.addTitle("TitleGridsGuides");var C=[];this.addLabelColor(C,Z("editor.gridcolor"),function(C){return C.a("sceneGridColor")},function(C,e){C.a("sceneGridColor",e)}),this.addRow(C,[this.indent,.1]),C=[],this.addLabelRange(C,Z("editor.gridsize"),function(C){return C.a("sceneGridBlockCount")},function(C,e){C.a("sceneGridBlockCount",e)},0,void 0,1,"int"),this.addLabelRange(C,Z("editor.gridgap"),function(C){return C.a("sceneGridBlockSize")},function(C,e){C.a("sceneGridBlockSize",e)},1,void 0,1,"int"),this.addRow(C,[this.indent,.1,this.indent2,.1])},e.prototype.initShadowProperties=function(){this.editor.scene,this.editor.scene.shadowMap;this.addTitle("TitleShadow");var C=[];this.addLabelCheckBox(C,Z("editor.shadow.enable"),function(C){return C.a("sceneShadowEnabled")},function(C,e){return C.a("sceneShadowEnabled",e)}),this.addRow(C,[this.indent,.1]),C=[],this.addLabelRange(C,Z("editor.shadow.degreeX"),function(C){return C.a("sceneShadowDegreeX")},function(C,e){return C.a("sceneShadowDegreeX",e)},0,360,.01,"number"),this.addRow(C,[this.indent,.1]),C=[],this.addLabelRange(C,Z("editor.shadow.degreeZ"),function(C){return C.a("sceneShadowDegreeZ")},function(C,e){return C.a("sceneShadowDegreeZ",e)},-90,90,.01,"number"),this.addRow(C,[this.indent,.1]),C=[],this.addLabelRange(C,Z("editor.shadow.intensity"),function(C){return C.a("sceneShadowIntensity")},function(C,e){return C.a("sceneShadowIntensity",e)},0,1,.01,"number"),this.addRow(C,[this.indent,.1]),C=[],this.addLabelComboBox(C,Z("editor.shadow.quality"),function(C){return C.a("sceneShadowQuality")},function(C,e){return C.a("sceneShadowQuality",e)},["low","medium","high","ultra"],[Z("editor.shadow.quality.low"),Z("editor.shadow.quality.medium"),Z("editor.shadow.quality.high"),Z("editor.shadow.quality.ultra")]),this.addRow(C,[this.indent,.1]),C=[],this.addLabelComboBox(C,Z("editor.shadow.type"),function(C){return C.a("sceneShadowType")},function(C,e){return C.a("sceneShadowType",e)},["none","hard","soft"],[Z("editor.shadow.type.none"),Z("editor.shadow.type.hard"),Z("editor.shadow.type.soft")]),this.addRow(C,[this.indent,.1]),C=[],this.addLabelRange(C,Z("editor.shadow.radius"),function(C){return C.a("sceneShadowRadius")},function(C,e){return C.a("sceneShadowRadius",e)},0,100,.1,"number"),this.addRow(C,[this.indent,.1]),C=[],this.addLabelRange(C,Z("editor.shadow.bias"),function(C){return C.a("sceneShadowBias")},function(C,e){return C.a("sceneShadowBias",e)},-.01,.01,1e-4,"number"),this.addRow(C,[this.indent,.1])},e}(I),G=hteditor.getString,a={undefined:"editor.cube",null:"editor.cube",sphere:"editor.sphere",cylinder:"editor.cylinder",cone:"editor.scene.cone",torus:"editor.scene.torus",triangle:"editor.scene.triangle",rightTriangle:"editor.scene.rightTriangle",parallelogram:"editor.scene.parallelogram",trapezoid:"editor.scene.trapezoid",rect:"editor.scene.rect",roundRect:"editor.scene.roundRect",star:"editor.scene.star",box:"editor.scene.box",billboard:"editor.scene.billboard",plane:"editor.scene.plane"},S=function(C){function e(l,d){return R(this,e),$(this,C.call(this,l,d,"data3d",!1))}return Y(e,C),e.prototype.initForm=function(){C.prototype.initForm.call(this),this.$11$(),this.addWireframeProperties(),this.addTransformProperties(),this.editor.scene.shadowMap&&this.$19$()},e.prototype.$11$=function(){var C=this;this.addTitle("TitleBasic"),this.addEventProperties();var e=[];this.addLabelInput(e,G("editor.name"),hteditor.getter("p","displayName"),hteditor.setter("p","displayName")),this.addLabelInput(e,G("editor.tag"),hteditor.getter("p","tag"),hteditor.setter("p","tag")),this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[],this.addLabelInput(e,G("editor.tooltip"),hteditor.getter("p","toolTip"),hteditor.setter("p","toolTip")),this.addRow(e,[this.indent,.1]);var l=[void 0,"billboard","plane","box","sphere","cone","torus","cylinder","star","rect","roundRect","triangle","rightTriangle","parallelogram","trapezoid"],d=[],N=[];l.forEach(function(C){d.push(G("editor."+(C?C.toLowerCase():"cube"))),N.push({width:16,height:16,comps:[{type:"image",stretch:"centerUniform",color:Q.config.color_dark,name:a[C],rect:[0,0,16,16]}]})}),e=[],this.addLabelComboBoxURL(e,G("editor.type"),function(e){var l=e.s("shape3d");if(_(l)){var d=C.editor.getFileNode(l);return d?d.url:l}return l},function(e,l){e.s("shape3d",l),C.editor.updateInspector()},l,d,N,function(C,e){return!!e.view.draggingData&&"model"===e.view.draggingData.fileType}),this.addImage(e,function(C){return C.s("shape3d")},void 0,function(C){return _(C)?C.substr(0,C.length-5)+".png":null},function(C){return hteditor.isJSON(C.rawIcon)}),this.addOneRow(e),e=[],this.addLabelCheckBox(e,G("editor.selectable"),function(C){return C.s("3d.selectable")},function(C,e){C.s("2d.selectable",e),C.s("3d.selectable",e)}),this.addLabelCheckBox(e,G("editor.movable"),function(C){return C.s("3d.movable")},function(C,e){C.s("2d.movable",e),C.s("3d.movable",e)}),this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[],this.addLabelCheckBox(e,G("editor.editable"),function(C){return C.s("3d.editable")},function(C,e){C.s("2d.editable",e),C.s("3d.editable",e)}),this.addLabelCheckBox(e,G("editor.visible"),function(C){return C.s("3d.visible")},function(C,e){C.s("2d.visible",e),C.s("3d.visible",e)}),this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[],this.addLabelCheckBox(e,G("editor.mask"),function(C){return C.s("transparent.mask")},function(C,e){return C.s("transparent.mask",e)}),this.addLabelCheckBox(e,G("editor.cache"),function(C){return C.s("texture.cache")},function(e,l){e.s("texture.cache",l),null!=e.s("shape3d.image.cache")&&e.s("shape3d.image.cache",void 0),C.editor.scene.invalidateShape3dCachedImage(e)}),this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[];var T=function(C){var e=C.s("fixSizeOnScreen");return null==e&&(e=C.s("shape3d.fixSizeOnScreen")),!!e};this.addLabelCheckBox(e,G("editor.fitsize"),T,function(C,e){C.s("fixSizeOnScreen",!!e&&[-1,-1]),null!=C.s("shape3d.fixSizeOnScreen")&&C.s("shape3d.fixSizeOnScreen",void 0),e&&C.s("autorotate",!0)});var M=this.addLabelCheckBox(e,G("editor.dynamic"),function(C){var e=C.s("vector.dynamic");return null==e&&(e=C.s("shape3d.vector.dynamic")),!!e},function(C,e){C.s("vector.dynamic",e),null!=C.s("shape3d.vector.dynamic")&&C.s("shape3d.vector.dynamic",void 0)});this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[],this.addLabelCheckBox(e,G("editor.alwaysontop"),function(C){if(C.getRenderLayer)return"top"===C.getRenderLayer();var e=C.s("alwaysOnTop");return null==e&&(e=C.s("shape3d.alwaysOnTop")),e},function(C,e){C.setRenderLayer?(C.setRenderLayer(e?"top":null),C.s("alwaysOnTop",void 0)):C.s("alwaysOnTop",e),C.s("shape3d.alwaysOnTop",void 0)});var K=function(C){var e=C.s("autorotate");return null==e&&(e=C.s("shape3d.autorotate")),e},h=this.addLabelComboBox(e,G("editor.autorotate"),K,function(C,e){C.s("autorotate",e),null!=C.s("shape3d.autorotate")&&C.s("shape3d.autorotate",void 0)},[!1,!0,"x","y","z"]);if(this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[],this.addLabelRange(e,G("editor.texturescale"),function(C){var e=void 0;return 1!==C.s("texture.scale")?e=C.s("texture.scale"):1!==C.s("shape3d.texture.scale")&&(e=C.s("shape3d.texture.scale")),e||1},function(C,e){C.s("texture.scale",e),C.s("shape3d.texture.scale",void 0)},0,10,.1,"number"),this.addRow(e,[this.indent,.1]),e=[],this.addLabelRange(e,G("editor.envmap"),function(C){return C.s("envmap")||0},hteditor.setter("s","envmap"),0,1,.01,"number"),this.addRow(e,[this.indent,.1]),e=[],this.addLabelRange(e,G("editor.brightness"),function(C){return C.s("select.brightness")},hteditor.setter("s","select.brightness"),0,1,.01,"number"),this.addRow(e,[this.indent,.1]),e=[],this.addLabelObject(e,G("editor.polygonoffset"),function(C){return C.s("polygonOffset")},hteditor.setter("s","polygonOffset"),"number"),this.addRow(e,[this.indent,.1]),e=[],this.addLabelComboBox(e,G("editor.clipdirection"),function(C){return C.s("3d.clip.direction")},function(C,e){C.s("3d.clip.direction",e)},[null,"left","right","top","bottom","front","back"],["",G("editor.clipdirection.left"),G("editor.clipdirection.right"),G("editor.clipdirection.top"),G("editor.clipdirection.bottom"),G("editor.clipdirection.front"),G("editor.clipdirection.back")]),this.addOneRow(e),e=[],this.addLabelRange(e,G("editor.clippercentage"),function(C){
return C.s("3d.clip.percentage")},function(C,e){C.s("3d.clip.percentage",e)},0,1,.01,"number"),this.addOneRow(e),Q.config.batchEditable){e=[];this.addLabelComboBox(e,G("editor.batch"),function(C){return C.s("batch")},function(C,e){return C.s("batch",e)},[],[]).getValues=function(){return C.editor.batchView.keys},this.addOneRow(e)}this.updateHandlers.push(function(){if(C.data){var e=T(C.data);h.setDisabled(e),M.setDisabled(e)}})},e.prototype.addTransformProperties=function(){this.addTitle("TitleTransform");var C=Q.config.numberPrecision,e=[];this.addLabelComboBox(e,G("editor.rotationMode"),function(C){return C.getRotationMode()},function(C,e){return C.setRotationMode(e)},["xyz","xzy","yxz","yzx","zxy","zyx"]),this.addRow(e,[this.indent,.1]);var l=C.rotation||0;N=0===l?"int":"number",T=1/Math.pow(10,l),e=[],e.push(G("editor.rotation")),this.addButton(e,null,G("editor.reset"),"editor.resetsize.state",function(C){C instanceof ht.Node&&C.r3(0,0,0)}),this.addLabelInput(e,"X",function(C){return Number((180/Math.PI*C.getRotationX()).toFixed(l))},function(C,e){C instanceof ht.Node&&C.setRotationX(e*Math.PI/180)},N,T),this.addLabelInput(e,"Y",function(C){return Number((180/Math.PI*C.getRotationY()).toFixed(l))},function(C,e){C instanceof ht.Node&&C.setRotationY(e*Math.PI/180)},N,T),this.addLabelInput(e,"Z",function(C){return Number((180/Math.PI*C.getRotationZ()).toFixed(l))},function(C,e){C instanceof ht.Node&&C.setRotationZ(e*Math.PI/180)},N,T),this.addRow(e,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var d=C.position||0,N=0===d?"int":"number",T=1/Math.pow(10,d);e=[],e.push(G("editor.position")),this.addButton(e,null,G("editor.reset"),"editor.resetsize.state",function(C){C instanceof ht.Node&&C.p3(0,0,0)}),this.addLabelInput(e,"X",function(C){return Number(C.getX().toFixed(d))},function(C,e){return C.setX(parseFloat(e))},N,T),this.addLabelInput(e,"Y",function(C){return Number(C.getElevation().toFixed(d))},function(C,e){return C.setElevation(parseFloat(e))},N,T),this.addLabelInput(e,"Z",function(C){return Number(C.getY().toFixed(d))},function(C,e){return C.setY(parseFloat(e))},N,T),this.addRow(e,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var M=C.size||0;N=0===M?"int":"number",T=1/Math.pow(10,M),e=[],e.push(G("editor.size")),this.addButton(e,null,G("editor.reset"),"editor.resetsize.state",function(C){C instanceof ht.Node&&C.s3(-1,-1,-1)}),this.addLabelInput(e,"X",function(C){return Number(C.getWidth().toFixed(M))},function(C,e){return C.setWidth(parseFloat(e))},N,T),this.addLabelInput(e,"Y",function(C){return Number(C.getTall().toFixed(M))},function(C,e){return C.setTall(parseFloat(e))},N,T),this.addLabelInput(e,"Z",function(C){return Number(C.getHeight().toFixed(M))},function(C,e){return C.setHeight(parseFloat(e))},N,T),this.addRow(e,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var _=C.anchor||0;N=0===_?"int":"number",T=1/Math.pow(10,_),e=[],e.push(G("editor.anchor")),this.addButton(e,null,G("editor.reset"),"editor.resetsize.state",function(C){C instanceof ht.Node&&C.setAnchor3d(.5,0,.5,!0)}),this.addLabelInput(e,"X",function(C){return Number(C.getAnchorX().toFixed(_))},function(C,e){C instanceof ht.Node&&C.setAnchor3d(parseFloat(e),C.getAnchorElevation(),C.getAnchorY(),!0)},N,T),this.addLabelInput(e,"Y",function(C){return Number(C.getAnchorElevation().toFixed(_))},function(C,e){C instanceof ht.Node&&C.setAnchor3d(C.getAnchorX(),parseFloat(e),C.getAnchorY(),!0)},N,T),this.addLabelInput(e,"Z",function(C){return Number(C.getAnchorY().toFixed(_))},function(C,e){C instanceof ht.Node&&C.setAnchor3d(C.getAnchorX(),C.getAnchorElevation(),parseFloat(e),!0)},N,T),this.addRow(e,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var K=C.scale||0;N=0===K?"int":"number",T=1/Math.pow(10,K),e=[],e.push(G("editor.scale")),this.addButton(e,null,G("editor.reset"),"editor.resetsize.state",function(C){C instanceof ht.Node&&C.setScale3d(1,1,1)}),this.addLabelInput(e,"X",function(C){return Number(C.getScaleX().toFixed(K))},function(C,e){C instanceof ht.Node&&C.setScaleX(parseFloat(e))},N,T),this.addLabelInput(e,"Y",function(C){return Number(C.getScaleTall().toFixed(K))},function(C,e){C instanceof ht.Node&&C.setScaleTall(parseFloat(e))},N,T),this.addLabelInput(e,"Z",function(C){return Number(C.getScaleY().toFixed(K))},function(C,e){C instanceof ht.Node&&C.setScaleY(parseFloat(e))},N,T),this.addRow(e,[this.indent-40-8,20,20,.1,20,.1,20,.1])},e.prototype.addWireframeProperties=function(){this.addTitle("TitleWireFrame");var C=[];this.addLabelComboBox(C,G("editor.visible"),hteditor.getter("s","wf.visible"),function(C,e){C.s("wf.visible",e)},[!1,!0,"selected"]),this.addLabelCheckBox(C,G("editor.wfshort"),hteditor.getter("s","wf.short"),hteditor.setter("s","wf.short")),this.addRow(C,[this.indent,.1,this.indent2,.1]),C=[],this.addLabelColor(C,G("editor.color"),hteditor.getter("s","wf.color"),hteditor.setter("s","wf.color")),this.addRow(C,[this.indent,.1]),C=[],this.addLabelCheckBox(C,G("editor.wfgeometry"),hteditor.getter("s","wf.geometry"),hteditor.setter("s","wf.geometry")),this.addLabelCheckBox(C,G("editor.wfloadQuadWireframe"),hteditor.getter("s","wf.loadQuadWireframe"),hteditor.setter("s","wf.loadQuadWireframe")),this.addRow(C,[this.indent,.1,this.indent2,.1]),C=[],this.addLabelComboBox(C,G("editor.wfcombineTriangle"),hteditor.getter("s","wf.combineTriangle"),hteditor.setter("s","wf.combineTriangle"),[!1,!0,2,3],[G("editor.wfdontcombine"),G("editor.wfcombineadjacent"),G("editor.wfcombinecommon"),G("editor.wfcombinesmooth")]),this.addRow(C,[this.indent,.1])},e.prototype.$19$=function(){this.addTitle("TitleShadow");var C=[];this.addLabelCheckBox(C,G("editor.shadow.cast"),hteditor.getter("s","shadow.cast"),hteditor.setter("s","shadow.cast")),this.addLabelCheckBox(C,G("editor.shadow.receive"),hteditor.getter("s","shadow.receive"),hteditor.setter("s","shadow.receive")),this.addRow(C,[this.indent,.1,this.indent2,.1])},e}(I),B=hteditor.getString,CC=["all","front","back","left","right","top","bottom"],eC=function(C,e,l){return function(d){var N=d.s(C+"."+e);return l&&void 0===N?d.s("all."+e):N}},lC=function(C){return function(e){var l=e.s(C);return l||(l=e.s("all.uv.scale")),l?l[0]:1}},dC=function(C){return function(e,l){var d=e.s(C);d||(d=e.s("all.uv.scale")),e.s(C,[l,d?d[1]:1])}},NC=function(C){return function(e){var l=e.s(C);return l||(l=e.s("all.uv.scale")),l?l[1]:1}},TC=function(C){return function(e,l){var d=e.s(C);d||(d=e.s("all.uv.scale")),e.s(C,[d?d[0]:1,l])}},MC=function(C){return function(e){e.s(C,null)}},_C=function(C){function e(l){return R(this,e),$(this,C.call(this,l,"Cube"))}return Y(e,C),e.prototype.initForm=function(){C.prototype.initForm.call(this),this.addCubeProperties()},e.prototype.addCubeProperties=function(){var C=this;this.addTitle("TitleFace");var e=void 0,l=void 0,d=0,N=new ht.widget.TabView;l=new ht.widget.FormPane;for(var T=0;T<CC.length;T++)!function(){var d=CC[T]+".image";e=[];var N=eC(CC[T],"image");C.addLabelImage(e,B("editor.face."+CC[T]),function(e){var l=N(e),d=C.editor.getFileNode(l);return d?d.url:l},hteditor.setter("s",d)),l.addRow(e,[C.indent,.1,20])}();J(N,B("editor.image"),l,!0),l.validateImpl(),d=Math.max(d,l.getScrollHeight()),l=new ht.widget.FormPane;for(var T=0;T<CC.length;T++){var M=CC[T]+".uv.scale";e=[],this.addLabel(e,B("editor.face."+CC[T])),this.addButton(e,null,B("editor.reset"),"editor.resetsize.state",MC(M)),this.addLabelInput(e,"U",lC(M),dC(M),"number",1),this.addLabelInput(e,"V",NC(M),TC(M),"number",1),l.addRow(e,[this.indent-20-8,20,20,.1,20,.1])}J(N,B("editor.repeat"),l,!0),l.validateImpl(),d=Math.max(d,l.getScrollHeight()),l=new ht.widget.FormPane;for(var T=0;T<CC.length;T++){var _=CC[T]+".color";e=[],this.addLabelColor(e,B("editor.face."+CC[T]),eC(CC[T],"color"),hteditor.setter("s",_)),l.addRow(e,[this.indent,.1])}J(N,B("editor.color"),l),l.validateImpl(),d=Math.max(d,l.getScrollHeight()),l=new ht.widget.FormPane;for(var T=0;T<CC.length;T++){var K=CC[T]+".transparent";e=[],this.addLabelCheckBox(e,B("editor.face."+CC[T]),eC(CC[T],"transparent"),hteditor.setter("s",K)),l.addRow(e,[this.indent,.1])}J(N,B("editor.transparent"),l),l.validateImpl(),d=Math.max(d,l.getScrollHeight()),l=new ht.widget.FormPane;for(var T=0;T<CC.length;T++){var h=CC[T]+".visible";e=[],this.addLabelCheckBox(e,B("editor.face."+CC[T]),eC(CC[T],"visible",!0),hteditor.setter("s",h)),l.addRow(e,[this.indent,.1])}J(N,B("editor.visible"),l),l.validateImpl(),d=Math.max(d,l.getScrollHeight()),l=new ht.widget.FormPane;for(var T=0;T<CC.length;T++){var X=CC[T]+".reverse.color";e=[],this.addLabelColor(e,B("editor.face."+CC[T]),eC(CC[T],"reverse.color"),hteditor.setter("s",X)),l.addRow(e,[this.indent,.1])}J(N,B("editor.reversecolor"),l),l.validateImpl(),d=Math.max(d,l.getScrollHeight()),l=new ht.widget.FormPane;for(var T=0;T<CC.length;T++){var t=CC[T]+".reverse.flip";e=[],this.addLabelCheckBox(e,B("editor.face."+CC[T]),eC(CC[T],"reverse.flip",!0),hteditor.setter("s",t)),l.addRow(e,[this.indent,.1])}J(N,B("editor.reverseflip"),l),l.validateImpl(),d=Math.max(d,l.getScrollHeight()),l=new ht.widget.FormPane;for(var T=0;T<CC.length;T++){var F=CC[T]+".reverse.cull";e=[],this.addLabelCheckBox(e,B("editor.face."+CC[T]),eC(CC[T],"reverse.cull",!0),hteditor.setter("s",F)),l.addRow(e,[this.indent,.1])}J(N,B("editor.reversecull"),l),l.validateImpl(),d=Math.max(d,l.getScrollHeight());var Q=N.getTabHeight()+d;e=[],e.push(N),this.addRow(e,[.1],Q)},e}(S),KC=function(C){function e(l){return R(this,e),$(this,C.call(this,l,"Cone"))}return Y(e,C),e}(S),hC=hteditor.getString,XC=["shape3d","shape3d.top","shape3d.bottom","shape3d.from","shape3d.to"],JC=["shape3d","shape3d.top","shape3d.bottom"],tC=function(C){return function(e){var l=e.s(C);return l?l[0]:1}},FC=function(C){return function(e,l){var d=e.s(C);e.s(C,[l,d?d[1]:1])}},QC=function(C){return function(e){var l=e.s(C);return l?l[1]:1}},AC=function(C){return function(e,l){var d=e.s(C);e.s(C,[d?d[0]:1,l])}},zC=function(C){return function(e){e.s(C,null)}},qC=function(C){function e(l,d){return R(this,e),$(this,C.call(this,l,d||"Shape3d"))}return Y(e,C),e.prototype.initForm=function(){C.prototype.initForm.call(this),this.addEffectProperties(),this.addTopBodyBottomProperties()},e.prototype.getCurrentPoint=function(C){return this.editor.currentPoint?this.editor.currentPoint[C]:0},e.prototype.setCurrentPoint=function(C,e){this.editor.gv.getEditInteractor().getSubModule("Curve").setCurrentPoint(C,e)},e.prototype.addTopBodyBottomProperties=function(){var C=this;this.addTitle("TitleFace");var e=void 0,l=void 0,d=0,N=new ht.widget.TabView,T=this.faces;l=new ht.widget.FormPane;for(var M=0;M<T.length;M++)!function(){var d=T[M]+".image";e=[];var N=hteditor.getter("s",d);C.addLabelImage(e,hC("editor.face."+T[M]),function(e){var l=N(e),d=C.editor.getFileNode(l);return d?d.url:l},hteditor.setter("s",d)),l.addRow(e,[C.indent,.1,20])}();J(N,hC("editor.image"),l,!0),l.validateImpl(),d=Math.max(d,l.getScrollHeight()),l=new ht.widget.FormPane;for(var M=0;M<T.length;M++){var _=T[M]+".uv.scale";e=[],this.addLabel(e,hC("editor.face."+T[M])),this.addButton(e,null,hC("editor.reset"),"editor.resetsize.state",zC(_)),this.addLabelInput(e,"U",tC(_),FC(_),"number",1),this.addLabelInput(e,"V",QC(_),AC(_),"number",1),l.addRow(e,[this.indent-20-8,20,20,.1,20,.1])}J(N,hC("editor.repeat"),l,!0),l.validateImpl(),d=Math.max(d,l.getScrollHeight()),l=new ht.widget.FormPane;for(var M=0;M<T.length;M++){var K=T[M]+".color";e=[],this.addLabelColor(e,hC("editor.face."+T[M]),hteditor.getter("s",K),hteditor.setter("s",K)),l.addRow(e,[this.indent,.1,20])}J(N,hC("editor.color"),l),l.validateImpl(),d=Math.max(d,l.getScrollHeight()),l=new ht.widget.FormPane;for(var M=0;M<T.length;M++){var h=T[M]+".visible";e=[],this.addLabelCheckBox(e,hC("editor.face."+T[M]),hteditor.getter("s",h),hteditor.setter("s",h)),l.addRow(e,[this.indent,.1,20])}J(N,hC("editor.visible"),l),l.validateImpl(),d=Math.max(d,l.getScrollHeight()),l=new ht.widget.FormPane,e=[],this.addLabelColor(e,hC("editor.color"),hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color")),l.addRow(e,[this.indent,.1]),e=[],this.addLabelCheckBox(e,hC("editor.flip"),hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip")),l.addRow(e,[this.indent,.1]),e=[],this.addLabelCheckBox(e,hC("editor.cull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),l.addRow(e,[this.indent,.1]),J(N,hC("editor.reverse"),l),l.validateImpl(),d=Math.max(d,l.getScrollHeight());var X=N.getTabHeight()+d;e=[],e.push(N),this.addRow(e,[.1],X)},e.prototype.addEffectProperties=function(){this.addTitle("TitleEffect");var C=[];this.addLabelCheckBox(C,hC("editor.transparent"),hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addRow(C,[this.indent,.1]),C=[],this.addLabelColor(C,hC("editor.blend"),hteditor.getter("s","shape3d.blend"),hteditor.setter("s","shape3d.blend")),this.addRow(C,[this.indent,.1]),C=[],this.addLabelRange(C,hC("editor.opacity"),hteditor.getter("s","shape3d.opacity"),hteditor.setter("s","shape3d.opacity"),0,1,.01,"number"),this.addRow(C,[this.indent,.1]),C=[],this.addLabelRange(C,hC("editor.side"),hteditor.getter("s","shape3d.side"),hteditor.setter("s","shape3d.side"),0,void 0,1,"int"),this.addRow(C,[this.indent,.1]),this.simple||(C=[],this.addLabelRange(C,hC("editor.side.from"),hteditor.getter("s","shape3d.side.from"),hteditor.setter("s","shape3d.side.from"),0,void 0,1,"int"),this.addRow(C,[this.indent,.1]),C=[],this.addLabelRange(C,hC("editor.side.to"),hteditor.getter("s","shape3d.side.to"),hteditor.setter("s","shape3d.side.to"),0,void 0,1,"int"),this.addRow(C,[this.indent,.1]))},e.prototype.addExtraProperties=function(C){},m(e,[{key:"simple",get:function(){return!1}},{key:"faces",get:function(){return this.simple?JC:XC}}]),e}(S),DC=hteditor.getString,RC=function(C){function e(l,d){return R(this,e),$(this,C.call(this,l,d||"Cylinder"))}return Y(e,C),e.prototype.addEffectProperties=function(){C.prototype.addEffectProperties.call(this);var e=[];this.addLabelCheckBox(e,DC("editor.smooth"),function(C){return C.s("shape3d.smooth")},function(C,e){return C.s("shape3d.smooth",e)}),this.addRow(e,[this.indent,.1])},e}(qC),mC=function(C){function e(l){return R(this,e),$(this,C.call(this,l,"RoundRect"))}return Y(e,C),e}(S),YC=hteditor.getString,$C=["shape3d","shape3d.from","shape3d.to"],gC=function(C){function e(l,d){return R(this,e),$(this,C.call(this,l,d||"Sphere"))}return Y(e,C),e.prototype.addEffectProperties=function(){C.prototype.addEffectProperties.call(this);var e=[];this.addLabelRange(e,YC("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(e,[this.indent,.1])},m(e,[{key:"faces",get:function(){return $C}}]),e}(RC),WC=function(C){function e(l,d){return R(this,e),$(this,C.call(this,l,d||"Torus"))}return Y(e,C),e}(gC),wC=function(C){function e(l){return R(this,e),$(this,C.call(this,l,"Triangle"))}return Y(e,C),e}(S),nC=hteditor.getString,EC=function(C){function e(l){return R(this,e),$(this,C.call(this,l,"Model"))}return Y(e,C),e.prototype.$11$=function(){var e=this;C.prototype.$11$.call(this);var l=[];this.addLabelColor(l,nC("editor.color"),hteditor.getter("s","shape3d.color"),hteditor.setter("s","shape3d.color")),this.addRow(l,[this.indent,.1]),l=[],this.addLabelColor(l,nC("editor.blend"),hteditor.getter("s","shape3d.blend"),hteditor.setter("s","shape3d.blend")),this.addRow(l,[this.indent,.1]),l=[],this.addLabelRange(l,nC("editor.opacity"),hteditor.getter("s","shape3d.opacity"),hteditor.setter("s","shape3d.opacity"),0,1,.01,"number"),this.addRow(l,[this.indent,.1]),l=[],this.addLabelCheckBox(l,nC("editor.transparent"),hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addLabelCheckBox(l,nC("editor.reversecull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),this.addRow(l,[this.indent,.1,this.indent2,.1]),l=[],this.addButton(l,nC("editor.resetposition"),null,null,function(C){var l=ht.Default.getShape3dModel(C.s("shape3d"));l&&l.center&&(e.editor.beginTransaction(),C.setAnchor3d(.5,.5,.5),C.p3(l.center),e.editor.endTransaction())}),this.addRow(l,[.1]).visible=function(){var C=e.editor.ld;if(!C)return!1;var l=ht.Default.getShape3dModel(C.s("shape3d"));return l&&l.center}},e}(S),UC=hteditor.getString,xC=hteditor.getter,HC=hteditor.setter,yC=function(C){function e(l){return R(this,e),$(this,C.call(this,l,"Billboard"))}return Y(e,C),e.prototype.initForm=function(){C.prototype.initForm.call(this),this.addReflectorProperties()},e.prototype.$11$=function(){var e=this;C.prototype.$11$.call(this),this.addTitle("TitlePanel");var l=[];this.addLabelImage(l,UC("editor.image"),function(C){var l=C.s("shape3d.image"),d=e.editor.getFileNode(l);return d?d.url:l},function(C,l){C.s("shape3d.image",l),C.s("texture.cache")&&e.editor.scene.invalidateShape3dCachedImage(C)}),this.addOneRow(l),l=[],this.addLabelCheckBox(l,UC("editor.transparent"),hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addRow(l,[this.indent,.1]),l=[],this.addLabelColor(l,UC("editor.color"),hteditor.getter("s","shape3d.color"),hteditor.setter("s","shape3d.color")),this.addRow(l,[this.indent,.1]),l=[],this.addLabelColor(l,UC("editor.reversecolor"),hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color")),this.addRow(l,[this.indent,.1]),l=[],this.addLabelCheckBox(l,UC("editor.reversecull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),this.addLabelCheckBox(l,UC("editor.reverseflip"),hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip")),this.addRow(l,[this.indent,.1,this.indent2,.1])},e.prototype.addReflectorProperties=function(){this.addTitle("TitleReflector");var C=[];this.addLabelCheckBox(C,UC("editor.reflector"),xC("s","shape3d.reflector"),HC("s","shape3d.reflector")),this.addRow(C,[this.indent,.1]),C=[],this.addLabelColor(C,UC("editor.reflectorcolor"),xC("s","shape3d.reflector.color"),HC("s","shape3d.reflector.color")),this.addRow(C,[this.indent,.1])},e}(S),PC=hteditor.getString,cC=function(C){function e(l){return R(this,e),$(this,C.call(this,l,"Wall"))}return Y(e,C),e.prototype.$11$=function(){C.prototype.$11$.call(this);var e=[];this.addLabelCheckBox(e,PC("editor.closepath"),hteditor.getter("p","closePath"),hteditor.setter("p","closePath")),this.addRow(e,[this.indent,.1])},e.prototype.addTransformProperties=function(){C.prototype.addTransformProperties.call(this);var e=[];this.addLabelRange(e,PC("editor.uvlength"),hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(e,PC("editor.thickness"),hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1,"number"),this.addLabelRange(e,PC("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(e,[this.indent,.1,30,.1,30,.1])},e}(_C),fC=function(C){function e(l){return R(this,e),$(this,C.call(this,l,"Floor"))}return Y(e,C),e}(RC),kC=hteditor.getString,pC=function(C){function e(l){return R(this,e),$(this,C.call(this,l,"Pipeline"))}return Y(e,C),e.prototype.addTransformProperties=function(){C.prototype.addTransformProperties.call(this);var e=[];this.addLabelRange(e,kC("editor.uvlength"),hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(e,kC("editor.thickness"),hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1),this.addLabelRange(e,kC("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(e,[this.indent,.1,30,.1,30,.1])},e.prototype.addExtraProperties=function(e){C.prototype.addExtraProperties.call(this);var l=[];this.addLabelInput(l,kC("editor.startangle"),function(C){return Math.round(180/Math.PI*C.s("shape3d.start.angle"))},function(C,e){C.s("shape3d.start.angle",e*Math.PI/180)},"int",1),e.addRow(l,[this.indent,.1]),l=[],this.addLabelInput(l,kC("editor.sweepangle"),function(C){return Math.round(180/Math.PI*C.s("shape3d.sweep.angle"))},function(C,e){C.s("shape3d.sweep.angle",e*Math.PI/180)},"int",1),e.addRow(l,[this.indent,.1])},m(e,[{key:"simple",get:function(){return!0}}]),e}(qC),oC=hteditor.getString,jC=function(C){function e(l){return R(this,e),$(this,C.call(this,l,"Polyline"))}return Y(e,C),e.prototype.addTransformProperties=function(){var e=this;C.prototype.addTransformProperties.call(this);var l=[];this.addLabelRange(l,oC("editor.uvlength"),hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(l,oC("editor.thickness"),hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1,"number"),this.addLabelRange(l,oC("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(l,[this.indent,.1,30,.1,30,.1]),l=[],l.push(oC("editor.point")),this.addButton(l,null,oC("editor.reset"),"editor.resetsize.state",function(C){e.setCurrentPoint("e",0)}),this.addLabelInput(l,"X",function(C){return e.getCurrentPoint("x")},function(C,l){e.setCurrentPoint("x",l)},"int",1),this.addLabelInput(l,"Y",function(C){return e.getCurrentPoint("e")},function(C,l){e.setCurrentPoint("e",l)},"int",1),this.addLabelInput(l,"Z",function(C){return e.getCurrentPoint("y")},function(C,l){e.setCurrentPoint("y",l)},"int",1),this.addRow(l,[this.indent-40-8,20,20,.1,20,.1,20,.1])},m(e,[{key:"simple",get:function(){return!0}}]),e}(qC),VC=hteditor.getString,LC=function(C){return function(e){var l=e.s(C);return l?l[0]:1}},vC=function(C){return function(e,l){var d=e.s(C);e.s(C,[l,d?d[1]:1])}},rC=function(C){return function(e){var l=e.s(C);return l?l[1]:1}},uC=function(C){return function(e,l){var d=e.s(C);e.s(C,[d?d[0]:1,l])}},iC=function(C){return function(e){e.s(C,null)}},OC=function(C){function e(l){return R(this,e),$(this,C.call(this,l,"Edge"))}return Y(e,C),e.prototype.initForm=function(){C.prototype.initForm.call(this),this.$88$(),this.$90$(),this.addEdgeSourceNodeProperties(),this.addEdgeTargetNodeProperties()},e.prototype.$11$=function(){var C=this;this.addTitle("TitleBasic");var e=[];this.addLabelInput(e,VC("editor.name"),hteditor.getter("p","displayName"),hteditor.setter("p","displayName")),this.addLabelInput(e,VC("editor.tag"),hteditor.getter("p","tag"),hteditor.setter("p","tag")),this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[],this.addLabelURL(e,VC("editor.navigate"),function(C){return C.a("navigate")||""},function(C,e){C.a("navigate",e)},function(C,e){var l=e.view.draggingData;return l&&("scene"===l.fileType||"display"===l.fileType)}),this.addLabelInput(e,VC("editor.tooltip"),hteditor.getter("p","toolTip"),hteditor.setter("p","toolTip")),this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[],this.addLabelComboBoxURL(e,VC("editor.type"),function(e){var l=e.s("shape3d");if(_(l)){var d=C.editor.getFileNode(l);return d?d.url:l}return l},function(e,l){e.s("shape3d",l),C.editor.updateInspector()},["","cylinder"],void 0,void 0,function(C,e){return!!e.view.draggingData&&"model"===e.view.draggingData.fileType}),this.addImage(e,function(C){return C.s("shape3d")},void 0,function(C){return hteditor.isJSON(C)?C.substr(0,C.length-5)+".png":null},function(C){return hteditor.isJSON(C.rawIcon)}),this.addOneRow(e),e=[],this.addLabelCheckBox(e,VC("editor.selectable"),function(C){return C.s("3d.selectable")},function(C,e){C.s("2d.selectable",e),C.s("3d.selectable",e)}),this.addLabelCheckBox(e,VC("editor.movable"),function(C){return C.s("3d.movable")},function(C,e){C.s("2d.movable",e),C.s("3d.movable",e)}),this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[],this.addLabelCheckBox(e,VC("editor.editable"),function(C){return C.s("3d.editable")},function(C,e){C.s("2d.editable",e),C.s("3d.editable",e)}),this.addLabelCheckBox(e,VC("editor.visible"),function(C){return C.s("3d.visible")},function(C,e){C.s("2d.visible",e),C.s("3d.visible",e)}),this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[],this.addLabelCheckBox(e,VC("editor.interactive"),function(C){return C.s("interactive")},function(C,e){return C.s("interactive",e)}),this.addRow(e,[this.indent,.1]),e=[],this.addLabelRange(e,VC("editor.envmap"),function(C){return C.s("envmap")||0},hteditor.setter("s","envmap"),0,1,.01,"number"),this.addRow(e,[this.indent,.1]),e=[],this.addLabelRange(e,VC("editor.brightness"),function(C){return C.s("select.brightness")},hteditor.setter("s","select.brightness"),0,1,.01,"number"),this.addRow(e,[this.indent,.1]),e=[],this.addLabelObject(e,VC("editor.polygonoffset"),function(C){return C.s("polygonOffset")},hteditor.setter("s","polygonOffset"),"number"),this.addRow(e,[this.indent,.1])},e.prototype.addTransformProperties=function(){},e.prototype.$88$=function(){var C=this;this.addTitle("TitleEdgeBasic");var e=[];this.addLabelComboBox(e,VC("editor.type"),hteditor.getter("s","edge.type"),hteditor.setter("s","edge.type"),[void 0,"points"]),this.addRow(e,[this.indent,.1]),e=[],this.addLabelInput(e,VC("editor.width"),hteditor.getter("s","edge.width"),hteditor.setter("s","edge.width"),"number",1),this.addLabelInput(e,VC("editor.offset"),hteditor.getter("s","edge.offset"),hteditor.setter("s","edge.offset"),"number",1),this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[],this.addLabelInput(e,VC("editor.side"),hteditor.getter("s","shape3d.side"),hteditor.setter("s","shape3d.side"),"number",1),this.addLabelInput(e,VC("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),"number",1),this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[],this.addLabelColor(e,VC("editor.color"),hteditor.getter("s","edge.color"),hteditor.setter("s","edge.color")),this.addLabelCheckBox(e,VC("editor.center"),hteditor.getter("s","edge.center"),hteditor.setter("s","edge.center")),this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[];var l=hteditor.getter("s","shape3d.image");this.addLabelImage(e,VC("editor.image"),function(e){var d=l(e),N=C.editor.getFileNode(d);return N?N.url:d},hteditor.setter("s","shape3d.image")),this.addRow(e,[this.indent,.1,20]),e=[],this.addLabel(e,"UV"),this.addButton(e,null,VC("editor.reset"),"editor.resetsize.state",iC("shape3d.uv.scale")),this.addLabelInput(e,"U",LC("shape3d.uv.scale"),vC("shape3d.uv.scale"),"number",1),this.addLabelInput(e,"V",rC("shape3d.uv.scale"),uC("shape3d.uv.scale"),"number",1),this.addRow(e,[this.indent-20-8,20,20,.1,20,.1]),e=[],this.addLabel(e,"UV "+VC("editor.offset")),this.addButton(e,null,VC("editor.reset"),"editor.resetsize.state",iC("shape3d.uv.offset")),this.addLabelInput(e,"U",function(C){return(C.s("shape3d.uv.offset")||[0,0])[0]},function(C,e){var l=C.s("shape3d.uv.offset")||[];C.s("shape3d.uv.offset",[e,l[1]])},"number",.1),this.addLabelInput(e,"V",function(C){return(C.s("shape3d.uv.offset")||[0,0])[1]},function(C,e){var l=C.s("shape3d.uv.offset")||[];C.s("shape3d.uv.offset",[l[0],e])},"number",.1),this.addRow(e,[this.indent-20-8,20,20,.1,20,.1])},e.prototype.$90$=function(){},e.prototype.addEdgeSourceNodeProperties=function(){var C=Q.config.numberPrecision;this.addTitle("TitleEdgeSourceNode");var e=[];this.addLabelData(e,VC("editor.node"),hteditor.getter("p","source"),function(C,e){C instanceof ht.Edge&&(null==e||e instanceof ht.Node||e instanceof ht.Edge)&&(C.setSource(e),C.s("edge.source.percent",.5))}),this.addRow(e,[this.indent,.1,20]);var l=C.anchor||0,d=0===l?"int":"number",N=1/Math.pow(10,l);e=[],e.push(VC("editor.anchor")),this.addButton(e,null,VC("editor.reset"),"editor.resetsize.state",function(C){C instanceof ht.Edge&&C.s({"edge.source.anchor.x":.5,"edge.source.anchor.elevation":.5,"edge.source.anchor.y":.5})}),this.addLabelInput(e,"X",function(C){var e=C.s("edge.source.anchor.x");return null==e&&(e=.5),Number(e.toFixed(l))},function(C,e){C instanceof ht.Edge&&C.s("edge.source.anchor.x",parseFloat(e))},d,N),this.addLabelInput(e,"Y",function(C){var e=C.s("edge.source.anchor.elevation");return null==e&&(e=.5),Number(e.toFixed(l))},function(C,e){C instanceof ht.Edge&&C.s("edge.source.anchor.elevation",parseFloat(e))},d,N),this.addLabelInput(e,"Z",function(C){var e=C.s("edge.source.anchor.y");return null==e&&(e=.5),Number(e.toFixed(l))},function(C,e){C instanceof ht.Edge&&C.s("edge.source.anchor.y",parseFloat(e))},d,N),this.addRow(e,[this.indent-40-8,20,20,.1,20,.1,20,.1])},e.prototype.addEdgeTargetNodeProperties=function(){var C=Q.config.numberPrecision;this.addTitle("TitleEdgeTargetNode");var e=[];this.addLabelData(e,VC("editor.node"),hteditor.getter("p","target"),function(C,e){C instanceof ht.Edge&&(null==e||e instanceof ht.Node||e instanceof ht.Edge)&&(C.setTarget(e),C.s("edge.target.percent",.5))}),this.addRow(e,[this.indent,.1,20]);var l=C.anchor||0,d=0===l?"int":"number",N=1/Math.pow(10,l);e=[],e.push(VC("editor.anchor")),this.addButton(e,null,VC("editor.reset"),"editor.resetsize.state",function(C){C instanceof ht.Edge&&C.s({"edge.target.anchor.x":.5,"edge.target.anchor.elevation":.5,"edge.target.anchor.y":.5})}),this.addLabelInput(e,"X",function(C){var e=C.s("edge.target.anchor.x");return null==e&&(e=.5),Number(e.toFixed(l))},function(C,e){C instanceof ht.Edge&&C.s("edge.target.anchor.x",parseFloat(e))},d,N),this.addLabelInput(e,"Y",function(C){var e=C.s("edge.target.anchor.elevation");return null==e&&(e=.5),Number(e.toFixed(l))},function(C,e){C instanceof ht.Edge&&C.s("edge.target.anchor.elevation",parseFloat(e))},d,N),this.addLabelInput(e,"Z",function(C){var e=C.s("edge.target.anchor.y");return null==e&&(e=.5),Number(e.toFixed(l))},function(C,e){C instanceof ht.Edge&&C.s("edge.target.anchor.y",parseFloat(e))},d,N),this.addRow(e,[this.indent-40-8,20,20,.1,20,.1,20,.1])},e}(S),sC=["edit_tx","edit_ty","edit_tz","edit_rx","edit_ry","edit_rz","edit_sx","edit_sy","edit_sz"],IC=function(C){function e(l){R(this,e);var d=$(this,C.call(this,l));return d.keep=!0,d}return Y(e,C),e.prototype.handle_touchstart=function(e){C.prototype.handle_touchstart.call(this,e);var l=this.getState();if(!("move"===l||sC.indexOf(l)>=0||"select"===l)){var d=ht.Default.isLeftButton(e),N=ht.Default.isMiddleButton(e),T=1===ht.Default.getTouchCount(e);(d||N)&&T&&this.setState("pan")}},e}(ht.graph3d.DefaultInteractor),ZC=hteditor.getString,bC=ht.Default.createBoxModel();ht.Default.handleUnfoundModel=function(){return bC};var GC=function(C){function e(l){R(this,e);var d=$(this,C.call(this));d.editor=l;var N=[];return N.push({label:ZC("editor.save"),action:function(){d.ok()}}),N.push({label:ZC("editor.save.import"),action:function(){d.ok(!0)}}),N.push({label:ZC("editor.cancel"),action:function(){d.hide()}}),d.dm=new ht.DataModel,d.node=new ht.Node,d.node.s({"wf.visible":"selected","select.brightness":1}),d.node.setAnchor3d(.5,0,.5),d.dm.add(d.node),d.g3d=new ht.graph3d.Graph3dView(d.dm),d.formPane=d.createFromPane(),d.splitView=new ht.widget.SplitView(d.g3d,d.formPane,"h",.55),d.setConfig({title:ZC("editor.objsetting"),closable:!0,draggable:!0,width:666,height:500,contentPadding:0,resizeMode:"wh",maximizable:!0,content:d.splitView,buttons:N,buttonsAlign:"right"}),d.setModal(!1),l.addEventListener(function(C){if("fileChanged"===C.type){var e=C.params.path,l=d.g3d;l.getTextureMap()[e]&&l.deleteTexture(e),document.body.contains(l.getView())&&l.invalidateAll()}}),d}return Y(e,C),e.prototype.toJSON=function(){var C={modelType:"obj"},e=C.obj=this.formPane.v("obj");if(!e||!N(e))return void this.showError("obj");var l=C.mtl=this.formPane.v("mtl");return l&&!T(l)?void this.showError("mtl"):(C.image=this.formPane.v("imageURL"),C.prefix=this.formPane.v("prefix"),C.center=this.formPane.v("center"),this.formPane.v("reverseFlipMtls")&&(C.reverseFlipMtls="*"),C.ignoreImage=!!this.formPane.v("ignoreImage"),C.ignoreColor=!!this.formPane.v("ignoreColor"),
C.s3=[Number(this.formPane.v("sX")),Number(this.formPane.v("sY")),Number(this.formPane.v("sZ"))],C.r3=[Number(this.formPane.v("rX")),Number(this.formPane.v("rY")),Number(this.formPane.v("rZ"))],C.image||delete C.image,C.prefix||delete C.prefix,C.center&&delete C.center,C.ignoreImage||delete C.ignoreImage,C.ignoreColor||delete C.ignoreColor,"1,1,1"===C.s3.toString()&&delete C.s3,"0,0,0"===C.r3.toString()&&delete C.r3,C)},e.prototype.ok=function(C){var e=this,l=this.toJSON();if(l){var d=this.formPane.v("url");if(!d)return void this.showError("name");d=this.editor.models.currentDir+"/"+d+".json",this.json=l;var N={path:d,content:ht.Default.stringify(this.json)};this.editor.request("upload",N,function(l){if(e.editor.saveImage(e.g3d,d.substr(0,d.length-5)+".png",function(){e.hide()}),C){var N=new ht.Node;N.s("shape3d",d),N.setAnchor3d([.5,0,.5]),e.editor.dm.add(N),e.editor.sm.ss(N)}var T=e.node,M=T.s("shape3d");M&&ht.Default.setShape3dModel(M.uuid,void 0),T.s("shape3d","box")})}},e.prototype.open=function(C,e){var l=this;this.isShowing()||(this.show(),this.__oldHandleModelLoadedFunc__=ht.Default.handleModelLoaded,ht.Default.handleModelLoaded=function(C,e){var d=l.node.s("shape3d");K(d)&&(d=d.uuid),C===d&&l.updateScene(e)}),this.url=C,this.json=e,this.node.s("shape3d",C),this.node.p3(0,0,0),this.g3d.reset(),this.update()},e.prototype.hide=function(){C.prototype.hide.call(this),ht.Default.handleModelLoaded=this.__oldHandleModelLoadedFunc__,this.__oldHandleModelLoadedFunc__=null},e.prototype.update=function(){var C=this.json;if(this.url){var e=this.editor.models.ld,l=e.s("label");this.formPane.getViewById("url").setEditable(!1),this.formPane.v("url",l);var d=ht.Default.getShape3dModel(this.url);d&&(this.updateScene(d),C=this.json=ht.Default.parse(ht.Default.stringify(d.json)))}else this.formPane.getViewById("url").setEditable(!0),this.formPane.v("url","");C||(C={}),this.formPane.v("obj",C.obj||""),this.formPane.v("mtl",C.mtl||""),this.formPane.v("imageURL",C.image||""),this.formPane.v("prefix",C.prefix||""),this.formPane.v("reverseFlipMtls",!!C.reverseFlipMtls),this.formPane.v("center",void 0==C.center),this.formPane.v("ignoreImage",!!C.ignoreImage),this.formPane.v("ignoreColor",!!C.ignoreColor);var N=C.s3||[1,1,1];this.formPane.v("sX",N[0]),this.formPane.v("sY",N[1]),this.formPane.v("sZ",N[2]);var T=C.r3||[0,0,0];this.formPane.v("rX",T[0]),this.formPane.v("rY",T[1]),this.formPane.v("rZ",T[2]),this.formPane.getItemById("image").element.setIcon(C.image)},e.prototype.createFromPane=function(){var C=this,e=new ht.widget.FormPane;e.addRow([{element:ZC("editor.name")},{id:"url",textField:{}}],[60,.1]),e.addRow([{element:"obj"},{id:"obj",textField:{handleChange:function(e){if(!e)return C.resetModel(),void C.clearInput();C.autoFillInput("obj",e)&&C.updateModel()}}},{image:{icon:"editor.obj",onClicked:function(l){C.editor.selectFileNode(e.v("obj"))}}}],[60,.1,20]);var l=e.getViewById("obj");this.handleDragAndDrop(l,function(C,e){return!!e.view.draggingData&&N(e.view.draggingData.getFileUUID())}),e.addRow([{element:"mtl"},{id:"mtl",textField:{handleChange:function(e){e&&!C.autoFillInput("mtl",e)||C.updateModel()}}},{image:{icon:"editor.mtl",onClicked:function(l){C.editor.selectFileNode(e.v("mtl"))}}}],[60,.1,20]);var d=e.getViewById("mtl");this.handleDragAndDrop(d,function(C,e){return!!e.view.draggingData&&T(e.view.draggingData.getFileUUID())}),e.addRow([{element:ZC("editor.imageprefix")},{id:"prefix",textField:{handleChange:function(){C.updateModel()}}}],[60,.1]),this.handleBlurAndKeydown(e.getViewById("prefix").getElement(),function(e){C.updateModel()}),e.addRow([{element:ZC("editor.reverseFlipMtls")},{id:"reverseFlipMtls",checkBox:{onClicked:function(){C.updateModel()}}},{element:ZC("editor.modelcenter"),align:"right"},{id:"center",checkBox:{onClicked:function(){C.updateModel()}}}],[60,.1,60,.1]),e.addRow([{element:ZC("editor.modelignoreImage")},{id:"ignoreImage",checkBox:{onClicked:function(){C.updateModel()}}},{element:ZC("editor.modelignoreColor"),align:"right"},{id:"ignoreColor",checkBox:{onClicked:function(){C.updateModel()}}}],[60,.1,60,.1]),e.addRow([],[.1],1.01,{background:"#E4E4E4"}),e.addRow([null,"X","Y","Z"],[60,.1,.1,.1]),e.addRow([ZC("editor.scale"),{id:"sX",textField:{type:"number"}},{id:"sY",textField:{type:"number"}},{id:"sZ",textField:{type:"number"}}],[60,.1,.1,.1]);var M=Q.config.numberPrecision,_=M.rotation||0;return e.addRow([ZC("editor.rotation"),{id:"rX",textField:{getValue:function(){return Number(this.getText())/180*Math.PI},setValue:function(C){this.setText((C/Math.PI*180).toFixed(_))},type:"number"}},{id:"rY",textField:{getValue:function(){return Number(this.getText())/180*Math.PI},setValue:function(C){this.setText((C/Math.PI*180).toFixed(_))},type:"number"}},{id:"rZ",textField:{getValue:function(){return Number(this.getText())/180*Math.PI},setValue:function(C){this.setText((C/Math.PI*180).toFixed(_))},type:"number"}}],[60,.1,.1,.1]),["s","r"].forEach(function(l){["X","Y","Z"].forEach(function(d){var N=e.getViewById(l+d).getElement();N.onblur=function(){return C.updateModel()},N.onkeydown=function(e){ht.Default.isEnter(e)&&C.updateModel()}})}),e.addRow([],[.1],1.01,{background:"#E4E4E4"}),e.addRow([{element:ZC("editor.image")},{id:"imageURL",textField:{}}],[60,.1]),e.addRow([{id:"image",image:{}}],[.1],70),this.handleBlurAndKeydown(e.getViewById("imageURL").getElement(),function(e){C.formPane.getItemById("image").element.setIcon(e)}),e},e.prototype.updateModel=function(){var C=this.toJSON();C&&(void 0==C.center&&(C.center=!0),this.setModel(C))},e.prototype.handleDragAndDrop=function(C,e){function l(){d.style.border=N,N=null}var d=C.getElement();C.isDroppable=e;var N=void 0;C.handleCrossDrag=function(e,T,M){if("enter"===T)N=d.style.border,d.style.border="solid "+Q.config.color_select_dark+" 2px";else if("exit"===T||"cancel"===T)l();else if("over"===T);else if("drop"===T){var _=d.value;d.value=M.view.draggingData.getFileUUID(),l(),C.setFocus(),C.handleChange(d.value,_)}},this.handleBlurAndKeydown(d,function(e){C.handleChange(e)})},e.prototype.handleBlurAndKeydown=function(C,e){C.onblur=function(l){e(C.value)},C.onkeydown=function(l){ht.Default.isEnter(l)&&e(C.value)}},e.prototype.autoFillInput=function(C,e){if(!this.__error__){if(e.length<=4)return this.showError(C),!1;var l=this.formPane,d=e.length,N=e.lastIndexOf("/")+1,T=e.substr(0,d-4).substr(N),M=l.v("url"),_=l.v("obj"),K=l.v("mtl"),h=l.v("prefix");return M||l.v("url",T),"obj"===C?K||l.v("mtl",e.substr(0,d-3)+"mtl"):"mtl"===C&&(_||l.v("obj",e.substr(0,d-3)+"obj")),h||l.v("prefix",e.substr(0,N)),!0}},e.prototype.showError=function(C){var e=this;if(!this.__error__){var l=void 0;"name"===C?l=ZC("editor.error.name"):"obj"!==C&&"mtl"!==C||(l=ZC("editor.error."+C+".file")),this.__error__=!0,hteditor.alert(ZC("editor.error.title"),l,function(){ht.Default.callLater(function(){return e.__error__=!1})})}},e.prototype.resetModel=function(){this.setModel("box")},e.prototype.setModel=function(C){var e=h(C)?C:JSON.stringify(C);if(this._currentJSON!==e){var l=this.node,d=l.s("shape3d");d&&K(d)&&ht.Default.setShape3dModel(d.uuid,void 0),l.s("shape3d",C),this._currentJSON=e}},e.prototype.clearInput=function(){var C=this.formPane;C.v("obj",""),C.v("mtl",""),C.v("prefix",""),C.getViewById("url").isEditable()&&C.v("url","")},e.prototype.updateScene=function(C){if(C&&C.rawS3){var e=this.g3d,l=C.rawS3[0],d=C.rawS3[1],N=C.rawS3[2],T=Math.max(d,l/(e.getAspect()||1)),M=T/2/Math.tan(e.getFovy()/2);M=2*Math.max(N/2,M),e.setEye(0,d/2,M),e.setCenter(0,d/2,0),e.setNear(Math.min(10,M/4)),e.setFar(Math.max(1e4,4*M))}},e}(ht.widget.Dialog),aC=hteditor.getString,SC=function(C){function e(l){return R(this,e),$(this,C.call(this,l,"Block"))}return Y(e,C),e.prototype.$19$=function(){},e.prototype.$11$=function(){this.addTitle("TitleBasic"),this.addEventProperties();var C=[];this.addLabelInput(C,aC("editor.name"),hteditor.getter("p","displayName"),hteditor.setter("p","displayName")),this.addLabelInput(C,aC("editor.tag"),hteditor.getter("p","tag"),hteditor.setter("p","tag")),this.addRow(C,[this.indent,.1,this.indent2,.1]),C=[],this.addLabelInput(C,aC("editor.tooltip"),hteditor.getter("p","toolTip"),hteditor.setter("p","toolTip")),this.addRow(C,[this.indent,.1]),C=[],this.addLabelCheckBox(C,aC("editor.selectable"),function(C){return C.s("3d.selectable")},function(C,e){C.s("2d.selectable",e),C.s("3d.selectable",e)}),this.addLabelCheckBox(C,aC("editor.movable"),function(C){return C.s("3d.movable")},function(C,e){C.s("2d.movable",e),C.s("3d.movable",e)}),this.addRow(C,[this.indent,.1,this.indent2,.1]),C=[],this.addLabelCheckBox(C,aC("editor.editable"),function(C){return C.s("3d.editable")},function(C,e){C.s("2d.editable",e),C.s("3d.editable",e)}),this.addLabelCheckBox(C,aC("editor.visible"),function(C){return C.s("3d.visible")},function(C,e){C.s("2d.visible",e),C.s("3d.visible",e)}),this.addRow(C,[this.indent,.1,this.indent2,.1]),C=[],this.addLabelCheckBox(C,aC("editor.clickthroughenabled"),function(C){return C.isClickThroughEnabled()},function(C,e){return C.setClickThroughEnabled(e)}),this.addLabelCheckBox(C,aC("editor.syncsize"),function(C){return C.isSyncSize()},function(C,e){return C.setSyncSize(e)}),this.addRow(C,[this.indent,.1,this.indent2,.1])},e}(S),BC={width:20,height:16,comps:[{type:"image",stretch:"uniform",color:{func:function(C,e){if(C instanceof ht.Block)return null;if(C instanceof ht.Node){var l=C.s("shape3d");if(ht.Default.isString(l)&&hteditor.isJSON(l))return null}return hteditor.config.color_dark}},name:{func:function(C,e){if(C instanceof ht.Block)return"editor.block";if(C instanceof ht.Shape)return C.getThickness()>0?"editor.wall":"editor.floor";if(C instanceof ht.Node){var l=C.s("shape3d");if(l){if(ht.Default.isString(l)&&hteditor.isJSON(l))return l.substr(0,l.length-4)+"png";if("sphere"===l)return"editor.sphere";if("cylinder"===l)return"editor.cylinder"}return"editor.cube"}return C.getIcon()}},rect:[0,0,20,16]}]},Ce=hteditor.getString,ee=function(C){function e(l){R(this,e);var d=$(this,C.call(this,l,l.dm));return d.initMenu(),d}return Y(e,C),e.prototype.handleDelete=function(){this.removeSelection()},e.prototype.onDataDoubleClicked=function(C,e){e.altKey?this.editor.gv.fitData(C,!0,hteditor.config.fitDataPadding):(this.editor.gv.makeCenter(C,!0),this.editor.scene.flyTo(C,{animation:!0}))},e.prototype.getLabel=function(e){var l=C.prototype.getLabel.call(this,e);if(!l){var d=e.s("shape3d");if(e instanceof ht.Block)l=Ce(e.getClassName());else if(e instanceof ht.Shape)l=Ce("cylinder"===d?"editor.pipeline":e.getThickness()>0?"editor.wall":"editor.floor");else if(e instanceof ht.Node){var N="editor."+(d||"cube");if(!(l=Ce(N))||N===l)if(hteditor.isJSON(d)){var T=this.editor.getFileNode(d),M=T?T.getName():d;l=hteditor.fileNameToDisplayName(M)}else l=d}l||(l=Ce("editor.cube"))}return l||""},e.prototype.getIcon=function(C){return BC},e.prototype._endDrag=function(C,e){var l=this,d=e.type,N=e.parent,T=e.refData;if(this.isSelected(this.draggingData)){var M=this.getTopRowOrderSelection();"down"===d&&M.reverse(),M.each(function(C){l._dropData(C,d,N,T)})}else this._dropData(this.draggingData,d,N,T),this.sm().ss(this.draggingData);N&&this.expand(N)},e.prototype._dropData=function(C,e,l,d){if(C.setParent(l),"down"===e||"up"===e){var N=l?l.getChildren():this.dm().getRoots(),T=N.indexOf(d);"down"===e&&T++,N.indexOf(C)<T&&T--,this.dm().moveTo(C,T)}else l||this.dm().moveToBottom(C)},e.prototype.isEditable=function(C){return!0},e.prototype.rename=function(C,e){C.setDisplayName(e)},e.prototype.initMenu=function(){this.menu=new ht.widget.ContextMenu;var C=[],e=this.editor;this.addSelectDescendantItems(C),this.addBlockItems(C),this.menu.setItems(C),this.menu.addTo(this.getView()),e.menus.push(this.menu)},e.prototype.onPropertyChanged=function(e){"filter"===e.property&&(this.visibleMap=null,this.ivm()),C.prototype.onPropertyChanged.call(this,e)},e.prototype.handleDataPropertyChange=function(e){!this._filter||"name"!==e.property&&"displayName"!==e.property?C.prototype.handleDataPropertyChange.call(this,e):(this.visibleMap=null,this.ivm())},e.prototype.checkVisible=function(C){if(!this._filter)return!0;if(Q.config.sceneTreeVisibleFunc)return Q.config.sceneTreeVisibleFunc(C,this._filter);var e=this.getLabel(C),l=(this._filter+"").toLowerCase();return null!=e&&(e=(e+"").toLowerCase(),e.indexOf(l)>=0)},e.prototype.validateModel=function(){var e=this;this._filter&&!this.visibleMap&&(this.visibleMap={},this.getDataModel().each(function(C){if(e.checkVisible(C)){e.visibleMap[C._id]=!0;for(var l=C.getParent();l&&!e.visibleMap[l._id];)e.visibleMap[l._id]=!0,l=l.getParent()}})),C.prototype.validateModel.call(this)},e.prototype.isVisible=function(C,e){if(!e&&C._refGraph)return!1;var l=this.getVisibleFunc();return!(l&&!l(C))&&(!this._filter||this.visibleMap&&this.visibleMap[C._id])},e}(hteditor.DNDTree);hteditor.msClass(ee,{ms_ac:["filter"]});var le=function(C){function e(l){R(this,e);var d=$(this,C.call(this));d.editor=l,d.tree=new ee(l),d.setCenterView(d.tree),d.controlPane=new ht.widget.FormPane,d.controlPane.addRow([{id:"filter",textField:{}}],[.1,ht.Default.isTouchable?32:18]),d.setBottomView(d.controlPane),d.setBottomHeight(ht.Default.widgetRowHeight+8);var N=!1,T=d.input=d.controlPane.getViewById("filter").getElement();return T.addEventListener("compositionstart",function(){return N=!0}),T.addEventListener("compositionend",function(){return N=!1}),T.addEventListener("keyup",function(C){N||(ht.Default.isEsc(C)&&(T.value=""),d.tree.setFilter(T.value))}),d}return Y(e,C),e}(ht.widget.BorderPane),de=hteditor.getString,Ne=hteditor.getter,Te=hteditor.setter,Me=hteditor.createCodeEditor,_e=ht.Default.clone,Ke=function(C){function e(l){R(this,e);var d=$(this,C.call(this));d.editor=l,d._updateHandles=[],(d.batchInfoDialog=new Xe(l)).handleComplete=function(C){var e=d.sm.ld();e&&e.a("batchInfo",C)};var N=d._tablePane=new ht.widget.TablePane;return d.initTable(),d.addRow([de("editor.batchbrightness"),d.addChickBox(function(){return!d.editor.dm.a("sceneBatchBrightnessDisabled")},function(C){return d.editor.dm.a("sceneBatchBrightnessDisabled",!C)}),de("editor.batchblend"),d.addChickBox(function(){return!d.editor.dm.a("sceneBatchBlendDisabled")},function(C){return d.editor.dm.a("sceneBatchBlendDisabled",!C)})],[80,.1,80,.1]),d.addRow([N],[.1],.1),d.addRow([{button:{icon:"editor.add",toolTip:de("editor.add"),onClicked:function(){d.addData()}}},{button:{icon:"editor.delete",toolTip:de("editor.delete"),onClicked:function(){d.sm.size()&&d.sm.removeSelection()}}}],[20,20]),d}return Y(e,C),e.prototype.isNameExist=function(C,e){for(var l=!1,d=this.dm.getDatas(),N=0,T=d.size();N<T;N++){var M=d.get(N);if(M!==e&&(l=M.a("name")===C))break}return l},e.prototype.onDataPropertyChanged=function(C){if(!this._parsing){var e=C.property,l=C.data,d=C.newValue,N=C.oldValue;if("a:name"===e){if(this.isNameExist(d,l))return void l.a("name",N);if(N){delete ht.Default.getBatchInfoMap()[N]}var T=l.a("batchInfo");if(T&&ht.Default.getBatchInfo(d)===T)return;ht.Default.setBatchInfo(d,T),this.editor.scene.invalidateBatch(d)}else if("a:batchInfo"===e){var M=l.a("name");if(!M)return;ht.Default.setBatchInfo(M,d),this.editor.scene.invalidateBatch(M)}}},e.prototype.onDataModelChanged=function(C){this._parsing||ht.Default.setBatchInfoMap(this.toBatchInfoMap())},e.prototype.initTable=function(){var C=this,e=this._tablePane;return e.getTableView().setEditable(!0),e.addColumns([this.$73$("name",de("editor.name"),80),this.$73$("batchInfo",de("editor.batchInfo"),200)]),e.getColumnModel().getDataByTag("batchInfo").isCellEditable=function(e,l,d,N){return C.batchInfoDialog.parseBatchInfo(e.a("batchInfo")),C.batchInfoDialog.show(),!1},this.dm.md(this.onDataPropertyChanged,this),this.dm.mm(this.onDataModelChanged,this),e},e.prototype.$73$=function(C,e,l){return{name:C,tag:C,width:l,displayName:e,align:"center",editable:!0,accessType:"attr"}},e.prototype.toBatchInfoMap=function(){var C={};return this.dm.each(function(e){var l=e.a("name");l&&(C[l]=e.a("batchInfo"))}),C},e.prototype.addData=function(C){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=new ht.Data;l.a({name:C,batchInfo:e}),this.dm.add(l)},e.prototype.parseBatchInfoMap=function(C){this._parsing=!0;for(var e in C)this.addData(e,C[e]);this._parsing=!1},e.prototype.clearBatchInfo=function(){this.dm.clear(),this.updateProperties()},e.prototype.addChickBox=function(C,e){var l=this,d=new ht.widget.CheckBox;return d.getValue=C,d.setValue(C()),d.onValueChanged=function(C,d){l._updatting||e(d)},this._updateHandles.push(function(){d.setValue(C())}),d},e.prototype.updateProperties=function(){this._updatting=!0,this._updateHandles.forEach(function(C){return C()}),this._updatting=!1},m(e,[{key:"dm",get:function(){return this._tablePane.getDataModel()}},{key:"sm",get:function(){return this.dm.sm()}},{key:"keys",get:function(){var C=[void 0];return this.dm.each(function(e){return C.push(e.a("name"))}),C}}]),e}(ht.widget.FormPane),he={alphaTest:ht.Style.alphaTest,brightness:!1,blend:!1,color:void 0,image:void 0,light:!0,reverseCull:!1,reverseFlip:!1,reverseColor:ht.Color.reverse,transparentMask:ht.Style["transparent.mask"],uvOffset:0,uvScale:1,discardSelectable:!0,opacity:1,transparent:!1,autoSort:!0},Xe=function(C){function e(l){R(this,e);var d=$(this,C.call(this));d.editor=l;var N=d._tabView=d.initTabView(),T=d.initButtons();return d.setConfig({title:de("editor.batchInfo"),closable:!0,draggable:!0,width:415,height:485,contentPadding:6,resizeMode:"wh",maximizable:!0,content:N,buttons:T,buttonsAlign:"right"}),d.setModal(!1),d}return Y(e,C),e.prototype.initTabView=function(){var C=this,e=new ht.widget.TabView,l=this._commonView=this.initCommonView(),d=this._commonTab=e.add(de("editor.common"),l,!0),N=this._advanceView=this.initAdvanceView(),T=this._advanceTab=e.add(de("editor.advance"),N),M=e.getTabModel().sm();return M.ms(function(){var e=M.ld();e===d?C.parseBatchInfo(JSON.parse(N.getValue())):e===T&&N.setValue(JSON.stringify(l.data.getAttrObject(),function(C,e){return void 0===e?null:e},4))}),e},e.prototype.initCommonView=function(){var C=new I(this.editor,"batchInfo","data");C.setLabelVPadding(0),C.getValue=function(C){return C(this.data)},C.setValue=function(C,e,l){C(this.data,l?l():e)},(C.data=new ht.Data).onPropertyChanged=function(e){return C.updateProperties()};var e=[];return C.addLabelRange(e,de("editor.alphatest"),Ne("a","alphaTest"),Te("a","alphaTest"),0,1,.01,"number"),C.addNameRow(e,"alphaTest","a"),e=[],C.addLabelCheckBox(e,de("editor.brightness"),Ne("a","brightness"),Te("a","brightness")),C.addNameRow(e,"brightness","a"),e=[],C.addLabelCheckBox(e,de("editor.blend"),Ne("a","blend"),Te("a","blend")),C.addNameRow(e,"blend","a"),e=[],C.addLabelColor(e,de("editor.color"),Ne("a","color"),Te("a","color")),C.addNameRow(e,"color","a"),e=[],C.addLabelImage(e,de("editor.image"),Ne("a","image"),Te("a","image")),C.addNameRow(e,"image","a"),e=[],C.addLabelCheckBox(e,de("editor.light"),Ne("a","light"),Te("a","light")),C.addNameRow(e,"light","a"),e=[],C.addLabelCheckBox(e,de("editor.reversecull"),Ne("a","reverseCull"),Te("a","reverseCull")),C.addNameRow(e,"reverseCull","a"),e=[],C.addLabelCheckBox(e,de("editor.reverseflip"),Ne("a","reverseFlip"),Te("a","reverseFlip")),C.addNameRow(e,"reverseFlip","a"),e=[],C.addLabelColor(e,de("editor.reversecolor"),Ne("a","reverseColor"),Te("a","reverseColor")),C.addNameRow(e,"reverseColor","a"),e=[],C.addLabelCheckBox(e,de("editor.transparentmask"),Ne("a","transparentMask"),Te("a","transparentMask")),C.addNameRow(e,"transparentMask","a"),e=[],C.addLabelRange(e,de("editor.uvoffset"),Ne("a","uvOffset"),Te("a","uvOffset"),void 0,void 0,1,"number"),C.addNameRow(e,"uvOffset","a"),e=[],C.addLabelRange(e,de("editor.uvscale"),Ne("a","uvScale"),Te("a","uvScale"),void 0,void 0,1,"number"),C.addNameRow(e,"uvScale","a"),e=[],C.addLabelCheckBox(e,de("editor.discardSelectable"),Ne("a","discardSelectable"),Te("a","discardSelectable")),C.addNameRow(e,"discardSelectable","a"),e=[],C.addLabelRange(e,de("editor.opacity"),Ne("a","opacity"),Te("a","opacity"),0,1,.01,"number"),C.addNameRow(e,"opacity","a"),e=[],C.addLabelCheckBox(e,de("editor.transparent"),Ne("a","transparent"),Te("a","transparent")),C.addNameRow(e,"transparent","a"),e=[],C.addLabelCheckBox(e,de("editor.autoSort"),Ne("a","autoSort"),Te("a","autoSort")),C.addNameRow(e,"autoSort","a"),C},e.prototype.initAdvanceView=function(){return Me({value:"",language:"json",theme:Q.config.codeEditorTheme,readOnly:!1,minimap:{enabled:!1}})},e.prototype.initButtons=function(){var C=this,e=[];return e.push({label:de("editor.ok"),action:function(){C._tabView.getTabModel().sm().ld()===C._advanceTab&&C.parseBatchInfo(JSON.parse(C._advanceView.getValue())),C.handleComplete(C.toBatchInfo()),C.hide()}}),e.push({label:de("editor.cancel"),action:function(){C.hide()}}),e},e.prototype.toBatchInfo=function(){var C=_e(this._commonView.data.getAttrObject());for(var e in he){var l=he[e];(C[e]===l||void 0===l&&null===C[e])&&delete C[e]}return C},e.prototype.parseBatchInfo=function(C){C=_e(C);for(var e in he)C.hasOwnProperty(e)||(C[e]=he[e]);this._commonView.data.setAttrObject(C)},e.prototype.handleComplete=function(C){console.info(C)},e.prototype.show=function(){for(var e,l=arguments.length,d=Array(l),N=0;N<l;N++)d[N]=arguments[N];(e=C.prototype.show).call.apply(e,[this].concat(d)),this._commonView.filterProperties()},e.prototype.hide=function(){this._commonView.data.setAttrObject({}),this._tabView.getTabModel().sm().ss(this._commonTab),C.prototype.hide.call(this)},e}(ht.widget.Dialog),Je=Q.getString,te=function(){function N(C){var e=this;R(this,N),this.params=C,this._eventNotifier=new ht.Notifier,this._clones=[],this.modelDialogs={},this.$38$=C.$38$;var l=ht.Default.getClass(hteditor.config.serviceClass||g);this.$39$=new l(this.handleServiceEvent.bind(this),this),ht.Default.handleModelLoaded=function(C,l){e.inspector&&e.inspector.updateProperties()};var d=this.serializer=new ht.JSONSerializer;d.isSerializable=function(C){return e.scene.sm().contains(C)};var T=this.serializer.getProperties;d.getProperties=function(C){var e=T.call(d,C);return hteditor.config.cloneTag||delete e.tag,e},this.editable=!0}return N.prototype.addEventListener=function(){hteditor.Editor.prototype.addEventListener.apply(this,arguments)},N.prototype.removeEventListener=function(C,e){hteditor.Editor.prototype.removeEventListener.apply(this,arguments)},N.prototype.fireEvent=function(C,e){hteditor.Editor.prototype.fireEvent.apply(this,arguments)},N.prototype.handleServiceEvent=function(N){if("connected"===N.type)this.init&&(this.init(),this.init=null);else if("fileChanged"===N.type){var T=N.path;if(X(T)){var M=this.scene,_=M.getTextureMap();_[T]&&M.deleteTexture(T),M.invalidateAll(),this.gv.invalidateAll()}C(T)?this.requestScenes():e(T)?(this.requestModels(),this.scene.invalidateAll(),this.gv.invalidateAll()):l(T)?this.requestSymbols():d(T)&&this.requestAssets()}else"download"===N.type?this.downloadFile(N.path):"confirm"===N.type&&this.requestImport(N.path);this.fireEvent(N.type,N)},N.prototype.downloadFile=function(C){hteditor.Editor.prototype.downloadFile.apply(this,arguments)},N.prototype.requestImport=function(C){hteditor.Editor.prototype.requestImport.apply(this,arguments)},N.prototype.beginTransaction=function(){this.dm.beginTransaction()},N.prototype.endTransaction=function(){this.dm.endTransaction()},N.prototype.init=function(){var C=this;this.menus=[],this.dm=new ht.DataModel,this.gv=new u(this),this.rulerView=new v(this,this.gv),this.eventView=new hteditor.EventView(this),this.scene=new V(this),this.functionView=new hteditor.FunctionView(this),this.fontView=new hteditor.FontView(this),this.objectView=new hteditor.ObjectView(this),this.mainToolbar=new k(this),this.fireEvent("mainToolbarCreated"),this.rightToolbar=new j(this),this.fireEvent("rightToolbarCreated"),this.topBorderPane=new ht.widget.BorderPane,this.topBorderPane.setCenterView(this.mainToolbar),this.topBorderPane.setRightView(this.rightToolbar),this.topBorderPane.setHeight(28),this.rightToolbar.onSumWidthChanged=function(){C.topBorderPane.setRightWidth(C.rightToolbar.getSumWidth())},this.resetInteractionState(),this.mainTabView=new ht.widget.TabView,this.scenes=new W(this),this.models=new w(this),this.symbols=new n(this),this.assets=new E(this),this.leftTopTabView=new ht.widget.TabView,J(this.leftTopTabView,Je("editor.scenes"),this.scenes,!0),J(this.leftTopTabView,Je("editor.models"),this.models),J(this.leftTopTabView,Je("editor.symbols"),this.symbols),J(this.leftTopTabView,Je("editor.assets"),this.assets),this.treePane=new le(this),this.dataView=new i(this),this.rightBottomTabView=new ht.widget.TabView,J(this.rightBottomTabView,Je("editor.list"),this.treePane,!0),J(this.rightBottomTabView,Je("editor.data"),this.dataView),Q.config.batchEditable&&(this.batchView=new Ke(this),J(this.rightBottomTabView,Je("editor.batch"),this.batchView));var e=this.rightBottomTabView.getTabModel().sm();e.ms(function(){var l=e.ld();C.dataView.visible=(l?l.getView():null)===C.dataView}),this.alignPane=new s(this),this.rightTopBorderPane=new ht.widget.BorderPane,this.rightTopBorderPane.setTopView(this.alignPane),this.rightTopBorderPane.setCenterView(this.inspectorPane),this.rightTopBorderPane.setTopHeight(ht.Default.widgetHeaderHeight+6),this.centerSplitView=new ht.widget.SplitView(this.rulerView,this.scene,"v"),this.leftSplitView=new ht.widget.SplitView(this.leftTopTabView,this.centerSplitView,"h",260),this.rightSplitView=new ht.widget.SplitView(this.rightTopBorderPane,this.rightBottomTabView,"v",-300),this.mainSplitView=new ht.widget.SplitView(this.leftSplitView,this.rightSplitView,"h",-360),this.mainPane=new ht.widget.BorderPane,this.mainPane.setTopView(this.topBorderPane),this.mainPane.setCenterView(this.mainSplitView),hteditor.layoutMainView(this.mainPane,this.$38$),this.$38$&&this.$38$.addEventListener("keydown",this.handleKeydown.bind(this),!1),this.dnd=new hteditor.DND(this),this.dndFromOutside=new hteditor.DNDFromOutside(this,this.$38$),this.requestScenes(),this.requestModels(),this.requestSymbols(),this.requestAssets(),this.dm.addDataModelChangeListener(this.handleDataModelChange,this),this.dm.addPropertyChangeListener(this.handleDataModelPropertyChange,this),this.dm.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this.sm.ms(this.handleSelectionChange,this),this.scene.addPropertyChangeListener(this.handleScenelPropertyChange,this),this.scene.mi(this.handleSceneInteractive,this),this.gv.addInteractorListener(this.handleInteractor,this),this.updateInspector(),this.fireEvent("editor3dCreated"),this.dm.enableHistoryManager(hteditor.config.maxUndoRedoSteps),this.initSID();var l=this.params.open||t("hteditor")||hteditor.config.open;l&&(hteditor.isJSON(l)?this._pendingOpenJSON=l:"newscene"===l&&this.newScene()),this.reset()},N.prototype.initSID=function(){var C=window.location.href.match("sid=([0-9a-z-]*)");C&&(this.sid=C[1])},N.prototype.handleDataModelPropertyChange=function(C){this.inspector&&this.inspector.global&&this.inspector.$34$(C),this.dataView.$66$(C);var e=this.scene,l=C.property,d=C.newValue;if(null!=d)if("a:sceneEditHelperDisabled"===l)e.setEditHelperDisabled(d),this.rightToolbar.iv();else if("a:sceneGridEnabled"===l)e.setGridVisible(d),e.setOriginAxisVisible(d),this.gv.getEditInteractor().gridEnabled=d,this.rightToolbar.iv();else if("a:sceneGridBlockCount"===l)e.setGridSize(d);else if("a:sceneGridBlockSize"===l)e.setGridGap(d),this.gv.setEditStyle("gridBlockSize",d);else if("a:sceneGridColor"===l){var N=ht.Default.toColorData(d);e.setGridColor([N[0]/255,N[1]/255,N[2]/255,1]),this.gv.setEditStyle("gridThickColor",d),this.gv.setEditStyle("gridLightColor","rgba("+N[0]+", "+N[1]+", "+N[2]+", 0.4)")}else if("a:sceneNear"===l)e.setNear(d);else if("a:sceneFar"===l)e.setFar(d);else if("a:sceneBloom"===l)e.setPostProcessingValue("Bloom","enable",d);else if("a:sceneBloomStrength"===l)e.setPostProcessingValue("Bloom","strength",d);else if("a:sceneBloomThreshold"===l)e.setPostProcessingValue("Bloom","threshold",d);else if("a:sceneBloomRadius"===l)e.setPostProcessingValue("Bloom","radius",d);else if("a:sceneDof"===l)e.setPostProcessingValue("Dof","enable",d);else if("a:sceneDofAperture"===l)e.setPostProcessingValue("Dof","aperture",d);else if("a:sceneDofImage"===l)e.setPostProcessingValue("Dof","image",d);else if("a:sceneHighlightMode"===l)e.setHighlightMode(d);else if("a:sceneHighlightWidth"===l)e.setHighlightWidth(d);else if("a:sceneHighlightColor"===l)e.setHighlightColor(d);else if("a:sceneDashEnable"===l)e.setDashDisabled(!d);else if("a:sceneHeadlightEnable"===l)e.setHeadlightDisabled(!d);else if("a:sceneHeadlightRange"===l)e.setHeadlightRange(d);else if("a:sceneHeadlightColor"===l)e.setHeadlightColor(d);else if("a:sceneHeadlightIntensity"===l)e.setHeadlightIntensity(d);else if("a:sceneHeadlightAmbientIntensity"===l)e.setHeadlightAmbientIntensity(d);else if("a:sceneFogEnable"===l)e.setFogDisabled(!d);else if("a:sceneFogColor"===l)e.setFogColor(d);else if("a:sceneFogNear"===l)e.setFogNear(d);else if("a:sceneFogFar"===l)e.setFogFar(d);else if("a:sceneBatchBrightnessDisabled"===l)e.setBatchBrightnessDisabled(d);else if("a:sceneBatchBlendDisabled"===l)e.setBatchBlendDisabled(d);else if("a:sceneBatchColorDisabled"===l)e.setBatchColorDisabled(d);else if("a:sceneShadowEnabled"===l)d?e.enableShadow():e.disableShadow();else if("a:sceneShadowDegreeX"===l)e.setShadowDegreeX(d);else if("a:sceneShadowDegreeZ"===l)e.setShadowDegreeZ(d);else if("a:sceneShadowIntensity"===l)e.setShadowIntensity(d);else if("a:sceneShadowQuality"===l)e.setShadowQuality(d);else if("a:sceneShadowType"===l)e.setShadowType(d);else if("a:sceneShadowRadius"===l)e.setShadowRadius(d);else if("a:sceneShadowBias"===l)e.setShadowBias(d);else if("a:sceneBatchInfoMap"===l){e.setBatchInfoMap(d);var T=this.batchView;T&&(T.parseBatchInfoMap(d),T.updateProperties())}else"a:sceneOrthographic"===l&&this._setSceneOrtho(d)},N.prototype._setSceneOrtho=function(C){var e=this.scene,l=this.__updateEye__;l||(l=this.__updateEye__=function(){var C=new ht.Math.Vector3,l=new ht.Math.Vector3,d=new ht.Math.Vector3;return function(N){if(N){C.fromArray(e.getCenter()),l.fromArray(e.getEye()),l.sub(C);var T=[0,1,0];"right"===N?T=[1,0,0]:"front"===N&&(T=[0,0,1]),d.fromArray(T).setLength(l.length()).add(C),e.setEye(d.toArray())}}}());var d=this.__defaultInteractor__;if(!d)for(var N=e.getInteractors(),T=0,M=N.length;T<M;T++){var _=N.get(0);if(_ instanceof ht.graph3d.DefaultInteractor){d=this.__defaultInteractor__=_;break}}var K=this.__orthoPanInteractor__;K||(K=this.__orthoPanInteractor__=new IC(e)),e.setOrtho(!!C),C?(e.setInteractors([K]),l(C)):e.setInteractors([d])},N.prototype.handleScenelPropertyChange=function(C){this.inspector&&this.inspector.global&&this.inspector.$34$(C),this._sceneInteracting||this.dataView.$66$(C)},N.prototype.handleSceneInteractive=function(C){this._sceneInteracting="betweenRotate"===C.kind||"betweenPan"===C.kind,this._sceneInteracting||this.dataView.$66$(C)},N.prototype.handleDataModelChange=function(C){this.inspector&&this.inspector.global&&this.inspector.updateProperties(),this.dataView.$66$(C)},N.prototype.handleDataPropertyChange=function(C){var e=C.data;if("parent"===C.property&&e instanceof ht.Node&&!ht.Default.isIsolating()){var l=e.getParent();l instanceof ht.Block&&(l=null),(!l||l instanceof ht.Node)&&e.setHost(l)}this.inspector&&!this.inspector.global&&this.inspector.data===e&&this.inspector.$34$(C),this.dataView.$66$(C)},N.prototype.handleSelectionChange=function(){this.updateInspector()},N.prototype.handleInteractor=function(C){"selectPoint"===C.kind&&(this.currentPoint=void 0===C.x?null:{x:C.x,y:C.y,e:C.e},this.updateInspector())},N.prototype.updateInspector=function(){this.inspector=null;var C=this.ld;if(C){var e=C.s("shape3d")
;C instanceof ht.Block?this.inspector=this.blockInspector:C instanceof ht.Polyline?this.inspector=this.polylineInspector:C instanceof ht.Shape?"cylinder"===e?this.inspector=this.pipelineInspector:C.getThickness()>0?this.inspector=this.wallInspector:this.inspector=this.floorInspector:C instanceof ht.Node?e?hteditor.isJSON(e)?this.inspector=this.modelInspector:"billboard"===e||"plane"===e?this.inspector=this.billboardInspector:"cube"===e?this.inspector=this.cubeInspector:"cone"===e?this.inspector=this.coneInspector:"cylinder"===e?this.inspector=this.cylinderInspector:"roundRect"===e?this.inspector=this.roundRectInspector:"sphere"===e?this.inspector=this.sphereInspector:"torus"===e?this.inspector=this.torusInspector:"triangle"===e&&(this.inspector=this.triangleInspector):this.inspector=this.cubeInspector:C instanceof ht.Edge&&(this.inspector=this.edgeInspector),this.inspector||(this.inspector=this.dataInspector)}else this.inspector=this.sceneInspector;this.inspector&&(this.inspector.data=C,this.inspector.filterPropertiesLater()),this.rightTopBorderPane.setCenterView(this.inspector)},N.prototype.reset=function(C){C||(this.url=null);var e=this.dm;e.disableHistoryManager(),e.setPostProcessingData(void 0),e.setName(void 0),e.setBackground(void 0),e.setHierarchicalRendering(!0),e.setLayers(void 0),e.setAttrObject(void 0),e.setEnvmap(void 0),e.clear();var l=this.gv;l.setZoom(1),l.tx(0),l.ty(0);var d=this.scene;d.setEye(Q.config.sceneEye),d.setCenter(Q.config.sceneCenter),e.a("sceneNear",Q.config.sceneNear),e.a("sceneFar",Q.config.sceneFar),e.a("connectActionType",Q.config.sceneConnectActionType),e.a("sceneEditHelperDisabled",Q.config.sceneEditHelperDisabled),e.a("sceneGridEnabled",Q.config.sceneGridEnabled),e.a("sceneGridBlockCount",Q.config.sceneGridBlockCount),e.a("sceneGridBlockSize",Q.config.sceneGridBlockSize),e.a("sceneGridColor",Q.config.sceneGridColor),e.a("sceneBatchBrightnessDisabled",Q.config.sceneBatchBrightnessDisabled),e.a("sceneBatchBlendDisabled",Q.config.sceneBatchBlendDisabled),e.a("sceneBatchColorDisabled",Q.config.sceneBatchColorDisabled),e.a("sceneHighlightMode",Q.config.sceneHighlightMode),e.a("sceneHighlightColor",Q.config.sceneHighlightColor),e.a("sceneHighlightWidth",Q.config.sceneHighlightWidth),e.a("sceneDashEnable",Q.config.sceneDashEnable),e.a("sceneHeadlightEnable",Q.config.sceneHeadlightEnable),e.a("sceneHeadlightRange",Q.config.sceneHeadlightRange),e.a("sceneHeadlightColor",Q.config.sceneHeadlightColor),e.a("sceneHeadlightIntensity",Q.config.sceneHeadlightIntensity),e.a("sceneHeadlightAmbientIntensity",Q.config.sceneHeadlightAmbientIntensity),e.a("sceneFogEnable",Q.config.sceneFogEnable),e.a("sceneFogColor",Q.config.sceneFogColor),e.a("sceneFogNear",Q.config.sceneFogNear),e.a("sceneFogFar",Q.config.sceneFogFar),e.a("sceneShadowEnabled",Q.config.sceneShadowEnabled),e.a("sceneShadowDegreeX",Q.config.sceneShadowDegreeX),e.a("sceneShadowDegreeZ",Q.config.sceneShadowDegreeZ),e.a("sceneShadowIntensity",Q.config.sceneShadowIntensity),e.a("sceneShadowQuality",Q.config.sceneShadowQuality),e.a("sceneShadowType",Q.config.sceneShadowType),e.a("sceneShadowRadius",Q.config.sceneShadowRadius),e.a("sceneShadowBias",Q.config.sceneShadowBias),e.a("sceneDof",Q.config.sceneDof),e.a("sceneDofAperture",Q.config.sceneDofAperture),e.a("sceneDofImage",Q.config.sceneDofImage),e.a("sceneBloom",Q.config.sceneBloom),e.a("sceneBloomStrength",Q.config.sceneBloomStrength),e.a("sceneBloomThreshold",Q.config.sceneBloomThreshold),e.a("sceneBloomRadius",Q.config.sceneBloomRadius),e.a("sceneOrthographic",Q.config.sceneOrthographic),this.batchView&&this.batchView.clearBatchInfo(),e.enableHistoryManager(),e.clearHistoryManager()},N.prototype.getModelDialog=function(C){var e=this.modelDialogs[C];if(!e){var l=hteditor.config.modelDialogClasses?hteditor.config.modelDialogClasses[C]:null;l||(l=GC),e=this.modelDialogs[C]=new l(this)}return e},N.prototype.open=function(C,e){var l=this;if(ht.Default.isString(C)&&(C=this.getFileNode(C)),C&&!C.$33$){var d=C.url;"scene"===C.fileType?this.newScene(d):"model"===C.fileType&&ht.Default.xhrLoad(d,function(C){C=ht.Default.parse(C),l.getModelDialog(C.modelType).open(d,C)})}},N.prototype.newOBJModel=function(){this.getModelDialog("obj").open()},N.prototype.newScene=function(C){C?(this.opened=!1,this.url=C,this.reload()):(this.reset(),this.fireEvent("sceneViewCreated",{sceneView:this}))},N.prototype.readForOld3dEditorFormat=function(C){var e=this.dm,l=C.scene;if(l&&(l.near&&e.a("sceneNear",l.near),l.far&&e.a("sceneFar",l.far),null!=l.shadow&&l.shadowParams)){e.a("sceneShadowEnabled",l.shadow);var d=l.shadowParams;for(var N in d){var T=d[N];null!=T&&e.a("sceneShadow"+N.charAt(0).toUpperCase()+N.substr(1),T)}}var M=e.getPostProcessingData();if(M){e.setPostProcessingData(void 0);var _=M.bloom;_&&(null!=_.enable&&e.a("sceneBloom",_.enable),null!=_.strength&&e.a("sceneBloomStrength",_.strength),null!=_.threshold&&e.a("sceneBloomThreshold",_.threshold),null!=_.radius&&e.a("sceneBloomRadius",_.radius));var K=M.dof;K&&(null!=K.enable&&e.a("sceneDof",K.enable),null!=K.aperture&&e.a("sceneDofAperture",K.aperture),null!=K.image&&e.a("sceneDofImage",K.image))}},N.prototype.reload=function(){var C=this,e=this.url;if(e){this.fireEvent(this.opened?"SceneViewReloading":"SceneViewOpening",{sceneView:this,url:e});var l=this.scene;this.reset(!0),this.dm.disableHistoryManager(),l.deserialize(e,{setId:Q.config.setId,finishFunc:function(l,d){C.gv.fitContent(!0),C.readForOld3dEditorFormat(l);var N=l.scene;N&&(N.eye&&C.scene.setEye(N.eye),N.center&&C.scene.setCenter(N.center)),d.setPostProcessingData(void 0),C.dm.enableHistoryManager(),C.dm.clearHistoryManager(),C.fireEvent(C.opened?"SceneViewReloaded":"SceneViewOpened",{sceneView:C,url:e}),C.opened=!0},disableOnPreDeserialize:!0,disableOnPostDeserialize:!0})}},N.prototype.save=function(){var C=this;if(this.url)this.saveImpl(this.url);else{var e=this.scenes.currentDir,l=Je("editor.inputnewscenename"),d=function(l,d){if("ok"===d){var N=hteditor.isJSON(l)?hteditor.trimExtension(l):l,T=e+"/"+N+".json",M=!1;if(C.scenes.dataModel.each(function(C){C.url===T&&(M=!0)}),M){var _=[{label:Je("editor.ok"),action:function(){K.hide()}}],K=new ht.widget.Dialog({title:Je("editor.filenameconflict"),contentPadding:20,width:300,draggable:!0,content:"<p>"+T+"</p>",buttons:_});K.show()}else C.saveImpl(T)}},N={name:void 0,scene:this.scene};this.fireEvent("sceneNewNameInputing",N),N.name?d(N.name,"ok"):hteditor.getInput(l,"",{nullable:!1,trim:!0,maxLength:hteditor.config.maxFileNameLength},d)}},N.prototype.saveImpl=function(C){var e=this;if(C){this.url=C;var l={url:C,scene:this.scene};if(this.fireEvent("sceneSaving",l),l.preventDefault)return!1;l={path:l.url,content:this.serialize()},this.request("upload",l,function(d){!0===d&&(e.fireEvent("sceneSaved",l),l={path:C.substr(0,C.length-5)+".png",content:e.scene.toImage(e.dm.getBackground())},e.request("upload",l,function(l){!0===l&&e.selectFileNode(C)}))})}},N.prototype.preview=function(){var C=this.dm.a("previewURL")||"scene.html";this.url&&-1===C.indexOf("?")&&(C+="?tag="+encodeURI(this.url));var e={url:C};this.fireEvent("sceneViewPreviewing",e),window.open(e.url,e.url),e={path:"previews/scene.json",content:this.serialize()},this.request("upload",e,function(C){})},N.prototype.deserialize=function(C){this.scene.deserialize(C,function(C,e,l){})},N.prototype.serialize=function(){return ht.Default.stringify(this.toJSON())},N.prototype.toJSON=function(){var C=this.dm,e=C.toJSON(),l={},d=ht.Default.clone(this.scene.getEye());d.join(",")!==Q.config.sceneEye.join(",")&&(l.eye=d);var N=ht.Default.clone(this.scene.getCenter());N.join(",")!==Q.config.sceneCenter.join(",")&&(l.center=N),ht.Default.isEmptyObject(l)||(e.scene=l);var T=this.scene.getBatchInfoMap();return ht.Default.isEmptyObject(T)||(e.a.sceneBatchInfoMap=T),C.a("sceneNear")===Q.config.sceneNear&&delete e.a.sceneNear,C.a("sceneFar")===Q.config.sceneFar&&delete e.a.sceneFar,C.a("sceneEditHelperDisabled")===Q.config.sceneEditHelperDisabled&&delete e.a.sceneEditHelperDisabled,C.a("sceneGridEnabled")===Q.config.sceneGridEnabled&&delete e.a.sceneGridEnabled,C.a("sceneGridBlockCount")===Q.config.sceneGridBlockCount&&delete e.a.sceneGridBlockCount,C.a("sceneGridBlockSize")===Q.config.sceneGridBlockSize&&delete e.a.sceneGridBlockSize,C.a("sceneGridColor")===Q.config.sceneGridColor&&delete e.a.sceneGridColor,C.a("sceneBatchBrightnessDisabled")===Q.config.sceneBatchBrightnessDisabled&&delete e.a.sceneBatchBrightnessDisabled,C.a("sceneBatchBlendDisabled")===Q.config.sceneBatchBlendDisabled&&delete e.a.sceneBatchBlendDisabled,C.a("sceneBatchColorDisabled")===Q.config.sceneBatchColorDisabled&&delete e.a.sceneBatchColorDisabled,C.a("sceneHighlightMode")===Q.config.sceneHighlightMode&&delete e.a.sceneHighlightMode,C.a("sceneHighlightColor")===Q.config.sceneHighlightColor&&delete e.a.sceneHighlightColor,C.a("sceneHighlightWidth")===Q.config.sceneHighlightWidth&&delete e.a.sceneHighlightWidth,C.a("sceneDashEnable")===Q.config.sceneDashEnable&&delete e.a.sceneDashEnable,C.a("sceneHeadlightEnable")===Q.config.sceneHeadlightEnable&&delete e.a.sceneHeadlightEnable,C.a("sceneHeadlightRange")===Q.config.sceneHeadlightRange&&delete e.a.sceneHeadlightRange,C.a("sceneHeadlightColor")===Q.config.sceneHeadlightColor&&delete e.a.sceneHeadlightColor,C.a("sceneHeadlightIntensity")===Q.config.sceneHeadlightIntensity&&delete e.a.sceneHeadlightIntensity,C.a("sceneHeadlightAmbientIntensity")===Q.config.sceneHeadlightAmbientIntensity&&delete e.a.sceneHeadlightAmbientIntensity,C.a("sceneFogEnable")===Q.config.sceneFogEnable&&delete e.a.sceneFogEnable,C.a("sceneFogColor")===Q.config.sceneFogColor&&delete e.a.sceneFogColor,C.a("sceneFogNear")===Q.config.sceneFogNear&&delete e.a.sceneFogNear,C.a("sceneFogFar")===Q.config.sceneFogFar&&delete e.a.sceneFogFar,C.a("sceneFogMode")===Q.config.sceneFogMode&&delete e.a.sceneFogMode,C.a("sceneFogDensity")===Q.config.sceneFogDensity&&delete e.a.sceneFogDensity,C.a("sceneShadowEnabled")===Q.config.sceneShadowEnabled&&delete e.a.sceneShadowEnabled,C.a("sceneShadowDegreeX")===Q.config.sceneShadowDegreeX&&delete e.a.sceneShadowDegreeX,C.a("sceneShadowDegreeZ")===Q.config.sceneShadowDegreeZ&&delete e.a.sceneShadowDegreeZ,C.a("sceneShadowIntensity")===Q.config.sceneShadowIntensity&&delete e.a.sceneShadowIntensity,C.a("sceneShadowQuality")===Q.config.sceneShadowQuality&&delete e.a.sceneShadowQuality,C.a("sceneShadowType")===Q.config.sceneShadowType&&delete e.a.sceneShadowType,C.a("sceneShadowRadius")===Q.config.sceneShadowRadius&&delete e.a.sceneShadowRadius,C.a("sceneShadowBias")===Q.config.sceneShadowBias&&delete e.a.sceneShadowBias,C.a("sceneDof")===Q.config.sceneDof&&delete e.a.sceneDof,C.a("sceneDofAperture")===Q.config.sceneDofAperture&&delete e.a.sceneDofAperture,C.a("sceneDofImage")===Q.config.sceneDofImage&&delete e.a.sceneDofImage,C.a("sceneBloom")===Q.config.sceneBloom&&delete e.a.sceneBloom,C.a("sceneBloomStrength")===Q.config.sceneBloomStrength&&delete e.a.sceneBloomStrength,C.a("sceneBloomThreshold")===Q.config.sceneBloomThreshold&&delete e.a.sceneBloomThreshold,C.a("sceneBloomRadius")===Q.config.sceneBloomRadius&&delete e.a.sceneBloomRadius,e},N.prototype.$3$=function(){return this._interactionState},N.prototype.$4$=function(C,e){var l=this;if(this._interactionState!==C){this._interactionState=C,this.pointsEditingMode=!1;var d=[];this.gv.getInteractors().each(function(e){e.keep?e.interactiveDisabled="edit"!==C:d.push(e)}),d.forEach(function(C){C.tearDown(),l.gv.getInteractors().remove(C)}),"edit"!==C&&(e.setUp(),this.gv.getInteractors().add(e)),this.gv.invalidateSelection(),this.rulerView.validateCanvas(),this.mainToolbar.iv()}},N.prototype.request=function(C,e,l,d){var N=this;l=l||A,d?setTimeout(function(){N.$39$.request(C,e,l)},d):this.$39$.request(C,e,l)},N.prototype.requestScenes=function(){var e=this;this._requestingScenes||(this.request("explore","/scenes",function(l){e._requestingScenes=!1,e.scenes.parse(l),e._pendingOpenJSON&&C(e._pendingOpenJSON)&&(e.scenes.dataModel.getDataById(e._pendingOpenJSON)?(e.open(e._pendingOpenJSON),e.selectFileNode(e._pendingOpenJSON)):Q.config.newIfFailToOpen&&(e.newScene(),e.url=e._pendingOpenJSON,e.save()),delete e._pendingOpenJSON),e._pendingSelectURL&&C(e._pendingSelectURL)&&e.selectFileNode(e._pendingSelectURL)},hteditor.config.requestDelay),this._requestingScenes=!0)},N.prototype.requestSymbols=function(){hteditor.Editor.prototype.requestSymbols.apply(this,arguments)},N.prototype.requestModels=function(){hteditor.Editor.prototype.requestModels.apply(this,arguments)},N.prototype.requestAssets=function(){hteditor.Editor.prototype.requestAssets.apply(this,arguments)},N.prototype.requestBase64=function(C,e){this.request("source",{url:C,encoding:"base64",prefix:"data:;base64,"},e)},N.prototype.copy=function(){if(this.ld){this.serializer.dm=this.scene.dm();var C=this.serializer.toJSON();delete C.p,delete C.a,this._cloneJSON=ht.Default.stringify(C)}},N.prototype.paste=function(){if(this._cloneJSON){var C=this.serializer.deserialize(this._cloneJSON);this.scene.sm().ss(C)}},N.prototype.hasCopyInfo=function(){return!!this._cloneJSON},N.prototype.undo=function(){hteditor.Editor.prototype.undo.apply(this,arguments)},N.prototype.redo=function(){hteditor.Editor.prototype.redo.apply(this,arguments)},N.prototype.renameFile=function(){hteditor.Editor.prototype.renameFile.apply(this,arguments)},N.prototype.getFileNode=function(){return hteditor.Editor.prototype.getFileNode.apply(this,arguments)},N.prototype.moveFile=function(){hteditor.Editor.prototype.moveFile.apply(this,arguments)},N.prototype.removeFiles=function(){hteditor.Editor.prototype.removeFiles.apply(this,arguments)},N.prototype.locate=function(){hteditor.Editor.prototype.locate.apply(this,arguments)},N.prototype.newFolder=function(){hteditor.Editor.prototype.newFolder.apply(this,arguments)},N.prototype.toggleLeft=function(){"normal"===this.leftSplitView.getStatus()?this.leftSplitView.setStatus("cl"):this.leftSplitView.setStatus("normal")},N.prototype.toggleRight=function(){"normal"===this.mainSplitView.getStatus()?this.mainSplitView.setStatus("cr"):this.mainSplitView.setStatus("normal")},N.prototype.fitSelection=function(){var C=this.dm.sm().getSelection();0===C.length&&(C=null),this.zoomToFit(C)},N.prototype.$48$=function(C){hteditor.Editor.prototype.$48$.apply(this,arguments)},N.prototype.$47$=function(C){hteditor.Editor.prototype.$47$.apply(this,arguments)},N.prototype.handleKeydown=function(C){hteditor.Editor.prototype.handleKeydown.apply(this,arguments)},N.prototype.selectFileNode=function(C){hteditor.Editor.prototype.selectFileNode.apply(this,arguments)},N.prototype.dropLocalFileOnDir=function(C,e){hteditor.Editor.prototype.dropLocalFileOnDir.apply(this,arguments)},N.prototype.uploadLocalFile=function(C,e){hteditor.Editor.prototype.uploadLocalFile.apply(this,arguments)},N.prototype.zoomIn=function(){this.gv&&this.gv.zoomIn(Q.config.animate),this.scene&&this.scene.zoomIn(Q.config.animate)},N.prototype.zoomOut=function(){this.gv&&this.gv.zoomOut(Q.config.animate),this.scene&&this.scene.zoomOut(Q.config.animate)},N.prototype.zoomToFit=function(C){this.scene.flyTo(C,{animation:Q.config.animate});var e=this.gv;if(!C)return void e.fitContent(Q.config.animate,Q.config.fitPadding);var l;C.each(function(C){l=ht.Default.unionRect(l,e.getDataUIBounds(C))}),ht.Default.grow(l,20,20),e.fitRect(l,Q.config.animate)},N.prototype.zoomReset=function(){this.gv&&this.gv.zoomReset(Q.config.animate),this.scene&&this.scene.isResettable()&&this.scene.reset()},N.prototype.saveImage=function(){hteditor.Editor.prototype.saveImage.apply(this,arguments)},N.prototype.createSceneItem=function(C,e,l,d){var N=this,T=function(){return N.$3$()===C},M=hteditor.createItem(C,e,l,T);return M.action=function(){N.$4$(C,d)},M},N.prototype.resetInteractionState=function(){this.$4$("edit")},N.prototype.isRulerEnabled=function(){return this.rulerView.isRulerEnabled()},N.prototype.setRulerEnabled=function(C){this.rulerView.setRulerEnabled(C)},N.prototype.toggleRulerEnabled=function(){this.setRulerEnabled(!this.isRulerEnabled())},N.prototype.block=function(){if(this.editable){var C=this.dm.sm().getSelection();if(C.length){this.beginTransaction();var e=new ht.Block;C.forEach(function(C){C.setParent(e)}),this.dm.add(e),this.endTransaction()}}},N.prototype.unblock=function(){var C=this;if(this.editable){this.beginTransaction();var e=[];this.sm.toSelection().each(function(l){if(l instanceof ht.Block&&!(l instanceof ht.RefGraph)){var d=l.getParent();l.getChildren().toArray().forEach(function(C){C.setParent(d),e.push(C)}),C.dm.remove(l)}}),e.length&&this.sm.ss(e),this.endTransaction()}},N.prototype.bringToFront=function(){},N.prototype.sendToBack=function(){},N.prototype.bringForward=function(){},N.prototype.sendBackward=function(){},m(N,[{key:"url",get:function(){return this._url},set:function(C){this._url=C,this.dataView.updateUrl()}},{key:"explorer",get:function(){return this.leftTopTabView.getCurrentTab().getView()}},{key:"dir",get:function(){return this.explorer?this.explorer.tree.getSelectionModel().getLastData():null}},{key:"file",get:function(){return this.explorer?this.explorer.getFileListView().getSelectionModel().getLastData():null}},{key:"ld",get:function(){return this.sm.ld()}},{key:"sm",get:function(){return this.dm.sm()}},{key:"editInteractor",get:function(){return this.gv.getEditInteractor()}},{key:"pointsEditingMode",get:function(){return this.editInteractor.pointsEditingMode},set:function(C){this.editInteractor.pointsEditingMode=C}},{key:"anchorVisible",get:function(){return this.editInteractor.getStyle("anchorVisible")},set:function(C){this.editInteractor.setStyle("anchorVisible",C)}},{key:"sceneInspector",get:function(){return this._sceneInspector||(this._sceneInspector=new b(this)),this._sceneInspector}},{key:"dataInspector",get:function(){return this._dataInspector||(this._dataInspector=new S(this)),this._dataInspector}},{key:"cubeInspector",get:function(){return this._cubeInspector||(this._cubeInspector=new _C(this)),this._cubeInspector}},{key:"coneInspector",get:function(){return this._coneInspector||(this._coneInspector=new KC(this)),this._coneInspector}},{key:"cylinderInspector",get:function(){return this._cylinderInspector||(this._cylinderInspector=new RC(this)),this._cylinderInspector}},{key:"roundRectInspector",get:function(){return this._roundRectInspector||(this._roundRectInspector=new mC(this)),this._roundRectInspector}},{key:"sphereInspector",get:function(){return this._sphereInspector||(this._sphereInspector=new gC(this)),this._sphereInspector}},{key:"torusInspector",get:function(){return this._torusInspector||(this._torusInspector=new WC(this)),this._torusInspector}},{key:"triangleInspector",get:function(){return this._triangleInspector||(this._triangleInspector=new wC(this)),this._triangleInspector}},{key:"modelInspector",get:function(){return this._modelInspector||(this._modelInspector=new EC(this)),this._modelInspector}},{key:"billboardInspector",get:function(){return this._billboardInspector||(this._billboardInspector=new yC(this)),this._billboardInspector}},{key:"wallInspector",get:function(){return this._wallInspector||(this._wallInspector=new cC(this)),this._wallInspector}},{key:"floorInspector",get:function(){return this._floorInspector||(this._floorInspector=new fC(this)),this._floorInspector}},{key:"pipelineInspector",get:function(){return this._pipelineInspector||(this._pipelineInspector=new pC(this)),this._pipelineInspector}},{key:"polylineInspector",get:function(){return this._polylineInspector||(this._polylineInspector=new jC(this)),this._polylineInspector}},{key:"edgeInspector",get:function(){return this._edgeInspector||(this._edgeInspector=new OC(this)),this._edgeInspector}},{key:"blockInspector",get:function(){return this._blockInspector||(this._blockInspector=new SC(this)),this._blockInspector}},{key:"selection",get:function(){var C=this,e=[];return this.gv&&this.gv.each(function(l){C.gv.isSelected(l)&&e.push(l)}),e}}]),N}();return Q.version="0.3.9",Q.config.logEditorInfo&&console.log("HT 3D Editor v0.3.9 powered by HT for Web v"+ht.Default.getVersion()+" from www.hightopo.com"),Q.createEditor3d=function(C){if(window.location.host.indexOf("hightopo")>=0){var e="https:"==document.location.protocol?" https://":" http://";document.write(unescape("%3Cdiv style='display:none'%3E%3Cspan id='cnzz_stat_icon_1000279011'%3E%3C/span%3E%3Cscript src='"+e+"s23.cnzz.com/z_stat.php%3Fid%3D1000279011%26show%3Dpic' type='text/javascript'%3E%3C/script%3E%3C/div%3E")),document.body.style.margin="0px",document.body.style.padding="0px"}C&&(ht.Default.isString(C)?C={container:C}:C.tagName&&C.appendChild&&(C={container:C})),C=C||{};var l=void 0,d=void 0===C.container?Q.config.container:C.container;return null===d?l=null:d?ht.Default.isString(d)?l=document.getElementById(d):d.length?(l=ht.Default.createDiv(),l.style.left=d[0]+"px",l.style.top=d[1]+"px",l.style.width=d[2]+"px",l.style.height=d[3]+"px",document.body.appendChild(l)):l=d:l=document.body,C.$38$=l,new te(C)},Q.config.valueTypes||(Q.config.valueTypes={}),Q.config.valueTypes.HighlightEnum={type:"enum",values:[0,1,2],i18nLabels:["editor.none","editor.selected","editor.hover"]},Q}();